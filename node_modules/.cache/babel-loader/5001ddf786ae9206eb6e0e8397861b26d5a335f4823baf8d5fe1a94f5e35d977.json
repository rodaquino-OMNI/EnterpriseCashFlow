{"ast":null,"code":"var _s = $RefreshSig$();\n// src/hooks/useFinancialCalculator.js\nimport { useState, useCallback, useRef, useEffect } from 'react';\nexport function useFinancialCalculator() {\n  _s();\n  const [isCalculating, setIsCalculating] = useState(false);\n  const [calculationError, setCalculationError] = useState(null);\n  const workerRef = useRef(null);\n  const calculate = useCallback(async (periodsInputDataRaw, periodTypeLabel) => {\n    setIsCalculating(true);\n    setCalculationError(null);\n    return new Promise((resolve, reject) => {\n      try {\n        if (workerRef.current) {\n          workerRef.current.terminate();\n          console.log(\"Previous worker terminated.\");\n        }\n\n        // Ensure the URL is correct relative to your public/output directory\n        // For Vite/Create React App, placing worker in `public` and using `new Worker('/financialCalculator.worker.js')`\n        // or using `new URL(...)` as you did is common.\n        const workerUrl = new URL('../workers/financialCalculator.worker.js', import.meta.url);\n        workerRef.current = new Worker(workerUrl, {\n          type: 'module'\n        });\n        console.log(\"New worker created from:\", workerUrl.href);\n        const timeoutDuration = 30000; // 30 seconds\n        const timeoutId = setTimeout(() => {\n          var _workerRef$current;\n          (_workerRef$current = workerRef.current) === null || _workerRef$current === void 0 ? void 0 : _workerRef$current.terminate();\n          workerRef.current = null;\n          const err = new Error(`Timeout: Cálculo demorou mais que ${timeoutDuration / 1000} segundos.`);\n          console.error(err);\n          setCalculationError(err);\n          setIsCalculating(false);\n          reject(err);\n        }, timeoutDuration);\n        workerRef.current.onmessage = event => {\n          var _workerRef$current2;\n          clearTimeout(timeoutId);\n          const {\n            success,\n            data,\n            error: workerError,\n            stack\n          } = event.data;\n          if (success) {\n            resolve(data);\n          } else {\n            const err = new Error(workerError || 'Erro desconhecido no cálculo do worker.');\n            console.error(\"Worker reported error:\", workerError, stack);\n            setCalculationError(err);\n            reject(err);\n          }\n          setIsCalculating(false);\n          (_workerRef$current2 = workerRef.current) === null || _workerRef$current2 === void 0 ? void 0 : _workerRef$current2.terminate();\n          workerRef.current = null;\n        };\n        workerRef.current.onerror = errorEvent => {\n          var _workerRef$current3;\n          clearTimeout(timeoutId);\n          console.error('Error from worker instance:', errorEvent.message, errorEvent);\n          const err = new Error(`Erro no worker de cálculo: ${errorEvent.message || 'Verifique o console do worker.'}`);\n          setCalculationError(err);\n          setIsCalculating(false);\n          (_workerRef$current3 = workerRef.current) === null || _workerRef$current3 === void 0 ? void 0 : _workerRef$current3.terminate();\n          workerRef.current = null;\n          reject(err);\n        };\n        console.log(\"Posting message to worker:\", {\n          periodsInputDataRaw,\n          periodTypeLabel\n        });\n        workerRef.current.postMessage({\n          periodsInputDataRaw,\n          periodTypeLabel\n        });\n      } catch (err) {\n        console.error('Error setting up or posting to worker:', err);\n        setCalculationError(err);\n        setIsCalculating(false);\n        reject(err);\n      }\n    });\n  }, []);\n  const cancelCalculation = useCallback(() => {\n    if (workerRef.current) {\n      workerRef.current.terminate();\n      workerRef.current = null;\n      console.log(\"Calculation worker terminated by cancel.\");\n    }\n    setIsCalculating(false);\n    // setCalculationError(new Error(\"Cálculo cancelado pelo usuário.\")); // Optional\n  }, []);\n  useEffect(() => {\n    // Cleanup worker on component unmount\n    return () => {\n      if (workerRef.current) {\n        workerRef.current.terminate();\n        workerRef.current = null;\n        console.log(\"Calculation worker terminated on component unmount.\");\n      }\n    };\n  }, []);\n  return {\n    calculate,\n    cancelCalculation,\n    isCalculating,\n    calculationError\n  };\n}\n_s(useFinancialCalculator, \"QUYRy2RvVckLXBfAXDOumpRFak8=\");","map":{"version":3,"names":["useState","useCallback","useRef","useEffect","useFinancialCalculator","_s","isCalculating","setIsCalculating","calculationError","setCalculationError","workerRef","calculate","periodsInputDataRaw","periodTypeLabel","Promise","resolve","reject","current","terminate","console","log","workerUrl","URL","import","meta","url","Worker","type","href","timeoutDuration","timeoutId","setTimeout","_workerRef$current","err","Error","error","onmessage","event","_workerRef$current2","clearTimeout","success","data","workerError","stack","onerror","errorEvent","_workerRef$current3","message","postMessage","cancelCalculation"],"sources":["/Users/rodrigo/Git Repositories/EnterpriseCashFlow/src/hooks/useFinancialCalculator.js"],"sourcesContent":["// src/hooks/useFinancialCalculator.js\nimport { useState, useCallback, useRef, useEffect } from 'react';\n\nexport function useFinancialCalculator() {\n  const [isCalculating, setIsCalculating] = useState(false);\n  const [calculationError, setCalculationError] = useState(null);\n  const workerRef = useRef(null);\n\n  const calculate = useCallback(async (periodsInputDataRaw, periodTypeLabel) => {\n    setIsCalculating(true);\n    setCalculationError(null);\n\n    return new Promise((resolve, reject) => {\n      try {\n        if (workerRef.current) {\n          workerRef.current.terminate();\n          console.log(\"Previous worker terminated.\");\n        }\n\n        // Ensure the URL is correct relative to your public/output directory\n        // For Vite/Create React App, placing worker in `public` and using `new Worker('/financialCalculator.worker.js')`\n        // or using `new URL(...)` as you did is common.\n        const workerUrl = new URL('../workers/financialCalculator.worker.js', import.meta.url);\n        workerRef.current = new Worker(workerUrl, { type: 'module' });\n        console.log(\"New worker created from:\", workerUrl.href);\n\n        const timeoutDuration = 30000; // 30 seconds\n        const timeoutId = setTimeout(() => {\n          workerRef.current?.terminate();\n          workerRef.current = null;\n          const err = new Error(`Timeout: Cálculo demorou mais que ${timeoutDuration / 1000} segundos.`);\n          console.error(err);\n          setCalculationError(err);\n          setIsCalculating(false);\n          reject(err);\n        }, timeoutDuration);\n\n        workerRef.current.onmessage = (event) => {\n          clearTimeout(timeoutId);\n          const { success, data, error: workerError, stack } = event.data;\n          \n          if (success) {\n            resolve(data);\n          } else {\n            const err = new Error(workerError || 'Erro desconhecido no cálculo do worker.');\n            console.error(\"Worker reported error:\", workerError, stack);\n            setCalculationError(err);\n            reject(err);\n          }\n          \n          setIsCalculating(false);\n          workerRef.current?.terminate();\n          workerRef.current = null;\n        };\n\n        workerRef.current.onerror = (errorEvent) => {\n          clearTimeout(timeoutId);\n          console.error('Error from worker instance:', errorEvent.message, errorEvent);\n          const err = new Error(`Erro no worker de cálculo: ${errorEvent.message || 'Verifique o console do worker.'}`);\n          setCalculationError(err);\n          setIsCalculating(false);\n          workerRef.current?.terminate();\n          workerRef.current = null;\n          reject(err);\n        };\n\n        console.log(\"Posting message to worker:\", { periodsInputDataRaw, periodTypeLabel });\n        workerRef.current.postMessage({\n          periodsInputDataRaw,\n          periodTypeLabel\n        });\n      } catch (err) {\n        console.error('Error setting up or posting to worker:', err);\n        setCalculationError(err);\n        setIsCalculating(false);\n        reject(err);\n      }\n    });\n\n  }, []);\n\n  const cancelCalculation = useCallback(() => {\n    if (workerRef.current) {\n      workerRef.current.terminate();\n      workerRef.current = null;\n      console.log(\"Calculation worker terminated by cancel.\");\n    }\n    setIsCalculating(false);\n    // setCalculationError(new Error(\"Cálculo cancelado pelo usuário.\")); // Optional\n  }, []);\n\n  useEffect(() => {\n    // Cleanup worker on component unmount\n    return () => {\n      if (workerRef.current) {\n        workerRef.current.terminate();\n        workerRef.current = null;\n        console.log(\"Calculation worker terminated on component unmount.\");\n      }\n    };\n  }, []);\n\n  return {\n    calculate,\n    cancelCalculation,\n    isCalculating,\n    calculationError,\n  };\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}