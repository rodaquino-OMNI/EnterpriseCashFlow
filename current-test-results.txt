
> enterprise-cash-flow@2.0.0 test
> react-scripts test --coverage --watchAll=false --verbose

FAIL src/__tests__/workers/financialCalculator.worker.test.js
  Financial Calculator Worker
    Basic Worker Functionality
      ✕ should handle successful calculation messages (14 ms)
      ✕ should handle calculation errors gracefully (1 ms)
    Advanced Financial Calculations
      ✕ should handle NPV calculation message (1 ms)
      ✕ should handle IRR calculation message
      ✕ should handle payback period calculation
      ✕ should handle break-even analysis (1 ms)
      ✕ should handle cash flow projections (1 ms)
    Performance and Large Dataset Handling
      ✕ should handle large dataset calculations efficiently
      ✕ should batch process multiple calculation types (1 ms)
    Error Handling and Validation
      ✕ should validate NPV inputs
      ✕ should handle unknown calculation types
      ✕ should handle thread safety for concurrent calculations
    Memory Management
      ✕ should clean up resources after calculation

  ● Financial Calculator Worker › Basic Worker Functionality › should handle successful calculation messages

    TypeError: mockWorkerScope.onmessage is not a function

      52 |       };
      53 |
    > 54 |       mockWorkerScope.onmessage({ data: messageData });
         |                       ^
      55 |
      56 |       // Verify response
      57 |       expect(mockPostMessage).toHaveBeenCalledWith({

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:54:23)

  ● Financial Calculator Worker › Basic Worker Functionality › should handle calculation errors gracefully

    TypeError: mockWorkerScope.onmessage is not a function

      80 |       };
      81 |
    > 82 |       mockWorkerScope.onmessage({ data: messageData });
         |                       ^
      83 |
      84 |       // Verify error response
      85 |       expect(mockPostMessage).toHaveBeenCalledWith({

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:82:23)

  ● Financial Calculator Worker › Advanced Financial Calculations › should handle NPV calculation message

    TypeError: mockWorkerScope.onmessage is not a function

      103 |       };
      104 |
    > 105 |       mockWorkerScope.onmessage({ data: messageData });
          |                       ^
      106 |
      107 |       // Verify NPV calculation
      108 |       expect(mockPostMessage).toHaveBeenCalledWith(

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:105:23)

  ● Financial Calculator Worker › Advanced Financial Calculations › should handle IRR calculation message

    TypeError: mockWorkerScope.onmessage is not a function

      126 |       };
      127 |
    > 128 |       mockWorkerScope.onmessage({ data: messageData });
          |                       ^
      129 |
      130 |       // Verify IRR calculation
      131 |       expect(mockPostMessage).toHaveBeenCalledWith(

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:128:23)

  ● Financial Calculator Worker › Advanced Financial Calculations › should handle payback period calculation

    TypeError: mockWorkerScope.onmessage is not a function

      150 |       };
      151 |
    > 152 |       mockWorkerScope.onmessage({ data: messageData });
          |                       ^
      153 |
      154 |       // Verify payback calculation
      155 |       expect(mockPostMessage).toHaveBeenCalledWith(

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:152:23)

  ● Financial Calculator Worker › Advanced Financial Calculations › should handle break-even analysis

    TypeError: mockWorkerScope.onmessage is not a function

      175 |       };
      176 |
    > 177 |       mockWorkerScope.onmessage({ data: messageData });
          |                       ^
      178 |
      179 |       // Verify break-even calculation
      180 |       expect(mockPostMessage).toHaveBeenCalledWith(

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:177:23)

  ● Financial Calculator Worker › Advanced Financial Calculations › should handle cash flow projections

    TypeError: mockWorkerScope.onmessage is not a function

      202 |       };
      203 |
    > 204 |       mockWorkerScope.onmessage({ data: messageData });
          |                       ^
      205 |
      206 |       // Verify projection calculation
      207 |       expect(mockPostMessage).toHaveBeenCalledWith(

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:204:23)

  ● Financial Calculator Worker › Performance and Large Dataset Handling › should handle large dataset calculations efficiently

    TypeError: mockWorkerScope.onmessage is not a function

      235 |       const startTime = Date.now();
      236 |
    > 237 |       mockWorkerScope.onmessage({
          |                       ^
      238 |         data: {
      239 |           periodsInputDataRaw: largeDataset,
      240 |           periodTypeLabel: 'MONTHLY',

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:237:23)

  ● Financial Calculator Worker › Performance and Large Dataset Handling › should batch process multiple calculation types

    TypeError: mockWorkerScope.onmessage is not a function

      285 |       };
      286 |
    > 287 |       mockWorkerScope.onmessage({ data: messageData });
          |                       ^
      288 |
      289 |       expect(mockPostMessage).toHaveBeenCalledWith(
      290 |         expect.objectContaining({

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:287:23)

  ● Financial Calculator Worker › Error Handling and Validation › should validate NPV inputs

    TypeError: mockWorkerScope.onmessage is not a function

      325 |       invalidMessages.forEach((messageData) => {
      326 |         mockPostMessage.mockClear();
    > 327 |         mockWorkerScope.onmessage({ data: messageData });
          |                         ^
      328 |
      329 |         expect(mockPostMessage).toHaveBeenCalledWith(
      330 |           expect.objectContaining({

      at forEach (src/__tests__/workers/financialCalculator.worker.test.js:327:25)
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:325:23)

  ● Financial Calculator Worker › Error Handling and Validation › should handle unknown calculation types

    TypeError: mockWorkerScope.onmessage is not a function

      344 |       };
      345 |
    > 346 |       mockWorkerScope.onmessage({ data: messageData });
          |                       ^
      347 |
      348 |       expect(mockPostMessage).toHaveBeenCalledWith(
      349 |         expect.objectContaining({

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:346:23)

  ● Financial Calculator Worker › Error Handling and Validation › should handle thread safety for concurrent calculations

    TypeError: mockWorkerScope.onmessage is not a function

      373 |       // Send multiple messages quickly
      374 |       messages.forEach((msg) => {
    > 375 |         mockWorkerScope.onmessage({ data: msg });
          |                         ^
      376 |       });
      377 |
      378 |       // Verify both calculations completed

      at forEach (src/__tests__/workers/financialCalculator.worker.test.js:375:25)
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:374:16)

  ● Financial Calculator Worker › Memory Management › should clean up resources after calculation

    TypeError: mockWorkerScope.onmessage is not a function

      401 |       };
      402 |
    > 403 |       mockWorkerScope.onmessage({ data: largeCalculation });
          |                       ^
      404 |
      405 |       // Verify calculation completed
      406 |       expect(mockPostMessage).toHaveBeenCalledWith(

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:403:23)

FAIL src/utils/__tests__/calculations.test.js
  Financial Calculations Engine
    calculateIncomeStatement
      ✕ should calculate income statement with all provided values (10 ms)
      ✓ should calculate COGS from gross margin percentage (1 ms)
      ✓ should handle zero revenue gracefully (1 ms)
      ✓ should apply default depreciation rate when not provided
      ✓ should ensure decimal precision for financial values (1 ms)
    calculateCashFlow
      ✓ should calculate operating cash flow with working capital changes (1 ms)
      ✕ should handle first period without previous data
      ✓ should calculate free cash flow with default capex (1 ms)
      ✓ should calculate cash conversion rate (1 ms)
      ✓ should handle custom capex and financing values
    calculateWorkingCapitalMetrics
      ✓ should calculate DSO from accounts receivable value (1 ms)
      ✓ should calculate DIO from inventory value (1 ms)
      ✓ should calculate DPO from accounts payable value
      ✓ should calculate cash conversion cycle correctly (1 ms)
      ✓ should derive values from days when provided (1 ms)
      ✓ should use default values when no data provided (1 ms)
    calculateFinancialRatios
      ✓ should calculate liquidity ratios (1 ms)
      ✓ should calculate leverage ratios (1 ms)
      ✓ should calculate profitability ratios
      ✓ should calculate efficiency ratios
      ✓ should handle edge cases gracefully (1 ms)
    calculateBalanceSheet
      ✕ should estimate balance sheet components (1 ms)
      ✕ should calculate balance sheet check
      ✓ should handle missing data with estimates
    processFinancialData
      ✓ should process multiple periods correctly (2 ms)
      ✓ should calculate period-over-period changes (2 ms)
      ✓ should handle different period types (1 ms)
      ✓ should validate data before processing (19 ms)
      ✓ should enrich data with trends and analytics (1 ms)
    Edge Cases and Error Handling
      ✓ should handle division by zero gracefully
      ✓ should maintain precision for large numbers (1 ms)
      ✓ should handle missing optional fields
      ✓ should round all monetary values to 2 decimal places (2 ms)

  ● Financial Calculations Engine › calculateIncomeStatement › should calculate income statement with all provided values

    expect(received).toEqual(expected) // deep equality

    - Expected  -  3
    + Received  + 78

      Object {
    +   "auditTrail": Object {
    +     "calculationSteps": Array [
    +       Object {
    +         "formula": "data.revenue",
    +         "step": "revenue",
    +         "value": 1000000,
    +       },
    +       Object {
    +         "formula": "data.cogs",
    +         "source": "input",
    +         "step": "cogs",
    +         "value": 600000,
    +       },
    +       Object {
    +         "formula": "revenue - cogs = 1000000 - 600000",
    +         "metric": "grossProfit",
    +         "value": 400000,
    +       },
    +       Object {
    +         "formula": "(grossProfit / revenue) * 100 = (400000 / 1000000) * 100",
    +         "metric": "grossMarginPercent",
    +         "value": 40,
    +       },
    +       Object {
    +         "formula": "grossProfit - operatingExpenses = 400000 - 200000",
    +         "metric": "ebitda",
    +         "source": "calculated",
    +         "value": 200000,
    +       },
    +       Object {
    +         "formula": "ebitda - depreciation = 200000 - 50000",
    +         "metric": "ebit",
    +         "value": 150000,
    +       },
    +       Object {
    +         "formula": "ebit + netFinancialResult = 150000 + -20000",
    +         "metric": "ebt",
    +         "value": 130000,
    +       },
    +       Object {
    +         "detail": "IRPJ: 19500 base + 0 surtax",
    +         "formula": "IRPJ (19500) + CSLL (11700)",
    +         "metric": "taxes",
    +         "value": 31200,
    +       },
    +       Object {
    +         "formula": "ebt - taxes = 130000 - 31200",
    +         "metric": "netIncome",
    +         "value": 98800,
    +       },
    +     ],
    +     "originalValues": Object {
    +       "cogs": 600000,
    +       "depreciation": 50000,
    +       "financialExpenses": 30000,
    +       "financialRevenue": 10000,
    +       "operatingExpenses": 200000,
    +       "revenue": 1000000,
    +     },
    +     "overrides": null,
    +     "system": "EnterpriseCashFlow",
    +     "timestamp": "2025-11-04T01:42:45.008Z",
    +     "validationResults": Object {
    +       "errors": Array [],
    +       "warnings": Array [],
    +     },
    +     "version": "1.0",
    +   },
        "cogs": 600000,
        "depreciation": 50000,
        "ebit": 150000,
        "ebitMargin": 15,
        "ebitda": 200000,
        "ebitdaMargin": 20,
        "ebt": 130000,
    +   "effectiveTaxRate": 24,
        "grossMarginPercent": 40,
        "grossProfit": 400000,
        "netFinancialResult": -20000,
    -   "netIncome": 85800,
    -   "netMargin": 8.58,
    +   "netIncome": 98800,
    +   "netMargin": 9.88,
        "operatingExpenses": 200000,
        "revenue": 1000000,
    -   "taxes": 44200,
    +   "taxBreakdown": Object {
    +     "csll": 11700,
    +     "irpj": 19500,
    +     "irpjBase": 19500,
    +     "irpjSurtax": 0,
    +   },
    +   "taxes": 31200,
      }

      25 |       const result = calculateIncomeStatement(input);
      26 |
    > 27 |       expect(result).toEqual({
         |                      ^
      28 |         revenue: 1000000,
      29 |         cogs: 600000,
      30 |         grossProfit: 400000,

      at Object.<anonymous> (src/utils/__tests__/calculations.test.js:27:22)

  ● Financial Calculations Engine › calculateCashFlow › should handle first period without previous data

    expect(received).toBe(expected) // Object.is equality

    Expected: 120000
    Received: -50000

      136 |       const result = calculateCashFlow(currentPeriod, null);
      137 |
    > 138 |       expect(result.operatingCashFlow).toBe(120000); // Net income + depreciation
          |                                        ^
      139 |       expect(result.workingCapitalChange).toBe(0);
      140 |     });
      141 |

      at Object.<anonymous> (src/utils/__tests__/calculations.test.js:138:40)

  ● Financial Calculations Engine › calculateBalanceSheet › should estimate balance sheet components

    expect(received).toBe(expected) // Object.is equality

    Expected: 410000
    Received: 400000

      358 |       expect(result.currentAssets).toBeGreaterThan(0);
      359 |       expect(result.nonCurrentAssets).toBeGreaterThan(0);
    > 360 |       expect(result.totalAssets).toBe(result.currentAssets + result.nonCurrentAssets);
          |                                  ^
      361 |       expect(result.currentLiabilities).toBe(130000); // AP (80000) + Short-term debt (50000)
      362 |       expect(result.totalLiabilitiesEquity).toBe(result.totalAssets);
      363 |     });

      at Object.<anonymous> (src/utils/__tests__/calculations.test.js:360:34)

  ● Financial Calculations Engine › calculateBalanceSheet › should calculate balance sheet check

    expect(received).toBeLessThan(expected)

    Expected: < 0.01
    Received:   NaN

      367 |
      368 |       const balanceCheck = Math.abs(result.totalAssets - result.totalLiabilitiesEquity);
    > 369 |       expect(balanceCheck).toBeLessThan(0.01); // Should balance
          |                            ^
      370 |     });
      371 |
      372 |     it('should handle missing data with estimates', () => {

      at Object.<anonymous> (src/utils/__tests__/calculations.test.js:369:28)

  console.log
    Calling OpenAI API with model: gpt-4-turbo

      at callOpenAI (src/utils/aiProviders.js:261:11)

  console.log
    Prompt length: 11 characters

      at callOpenAI (src/utils/aiProviders.js:262:11)

  console.error
    Failed to initialize worker: Error: Worker failed to load
        at mockConstructor.<anonymous> (/home/user/EnterpriseCashFlow/src/__tests__/services/financial/FinancialCalculationService.test.js:78:15)
        at /home/user/EnterpriseCashFlow/node_modules/jest-mock/build/index.js:438:43
        at mockConstructor.<anonymous> (/home/user/EnterpriseCashFlow/node_modules/jest-mock/build/index.js:457:13)
        at new mockConstructor (/home/user/EnterpriseCashFlow/node_modules/jest-mock/build/index.js:170:19)
        at FinancialCalculationService.initialize (/home/user/EnterpriseCashFlow/src/services/financial/FinancialCalculationService.js:24:21)
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/__tests__/services/financial/FinancialCalculationService.test.js:81:28)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12)

      49 |       this.isInitialized = true;
      50 |     } catch (error) {
    > 51 |       console.error('Failed to initialize worker:', error);
         |               ^
      52 |       throw error;
      53 |     }
      54 |   }

      at FinancialCalculationService.initialize (src/services/financial/FinancialCalculationService.js:51:15)
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:81:28)

FAIL src/utils/__tests__/calculations.comprehensive.test.js
  Financial Calculations - Comprehensive Tests
    calculateIncomeStatement
      Revenue and COGS calculations
        ✓ should calculate COGS from gross margin percentage (3 ms)
        ✓ should use provided COGS when available (1 ms)
        ✓ should handle zero revenue gracefully (2 ms)
        ✓ should handle negative margins correctly (5 ms)
      EBITDA and EBIT calculations
        ✓ should calculate EBITDA and margins correctly (1 ms)
        ✓ should use default depreciation rate when not provided (1 ms)
      Tax calculations
        ✕ should calculate taxes on positive income (2 ms)
        ✓ should not apply taxes on negative income (1 ms)
      Financial result calculations
        ✓ should calculate net financial result correctly (1 ms)
      Edge cases
        ✓ should handle all zero values (1 ms)
        ✓ should handle very large numbers
        ✓ should handle decimal precision correctly
    calculateCashFlow
      Operating cash flow calculations
        ✕ should calculate OCF for first period (no WC change) (1 ms)
        ✓ should calculate OCF with working capital changes
        ✓ should handle decreasing working capital (cash inflow)
      Investing and free cash flow
        ✕ should calculate investing cash flow with provided capex (1 ms)
        ✓ should use default capex rate when not provided
      Financing cash flow
        ✕ should calculate financing cash flow correctly
        ✓ should handle debt repayment and dividend payments
      Cash conversion metrics
        ✕ should calculate cash conversion rate correctly
        ✕ should handle negative net income (1 ms)
    calculateWorkingCapitalMetrics
      Days calculations
        ✓ should calculate DSO from AR value (1 ms)
        ✓ should calculate AR value from DSO days
        ✓ should use default DSO when neither provided
        ✓ should calculate DIO and inventory correctly
        ✓ should calculate DPO and payables correctly
      Cash conversion cycle
        ✓ should calculate positive CCC (1 ms)
        ✕ should handle negative CCC (good cash management)
      Working capital calculations
        ✓ should calculate working capital value and percentage
        ✓ should handle quarterly periods correctly
      Edge cases
        ✕ should handle zero revenue (1 ms)
        ✓ should handle missing income statement (1 ms)
    calculateFinancialRatios
      Liquidity ratios
        ✓ should calculate current ratio correctly
        ✓ should calculate quick ratio excluding inventory
        ✓ should calculate cash ratio
        ✓ should handle zero current liabilities
      Leverage ratios
        ✓ should calculate debt ratios correctly (1 ms)
        ✓ should handle missing total liabilities
      Profitability ratios
        ✓ should calculate ROE, ROA, and ROIC (1 ms)
        ✓ should handle negative profits
      Efficiency ratios
        ✓ should calculate asset turnover (1 ms)
        ✓ should handle high asset turnover
    calculateBalanceSheet
      Asset calculations
        ✕ should estimate cash and current assets (1 ms)
        ✕ should calculate non-current assets to balance
        ✕ should use revenue-based estimation when total assets not provided (1 ms)
      Liability calculations
        ✕ should calculate current liabilities (1 ms)
        ✓ should balance with appropriate debt/equity ratio
      Balance sheet equation
        ✓ should ensure assets = liabilities + equity
        ✓ should calculate current ratio
      Edge cases
        ✕ should handle missing working capital data (1 ms)
        ✕ should handle negative net cash flow (1 ms)
    processFinancialData
      Multi-period processing
        ✓ should process multiple periods correctly (1 ms)
        ✓ should calculate trends for periods after the first (1 ms)
        ✓ should handle working capital changes between periods (1 ms)
      Data validation
        ✓ should reject negative revenue (15 ms)
        ✓ should reject invalid gross margin percentages
        ✓ should accept gross margin of 0% (1 ms)
        ✓ should accept gross margin of 100%
      Period type handling
        ✓ should handle monthly periods (1 ms)
        ✓ should handle yearly periods (1 ms)
        ✓ should default to 30 days for unknown period types
      Complex scenarios
        ✓ should handle turnaround scenario (loss to profit) (1 ms)
        ✓ should handle high growth scenario (1 ms)
        ✓ should handle seasonal business (1 ms)
      Performance considerations
        ✓ should handle large number of periods efficiently (11 ms)
    Calculation precision and rounding
      ✓ should maintain 2 decimal precision throughout calculations (2 ms)
      ✓ should handle currency calculations without floating point errors

  ● Financial Calculations - Comprehensive Tests › calculateIncomeStatement › Tax calculations › should calculate taxes on positive income

    expect(received).toBe(expected) // Object.is equality

    Expected: 95200
    Received: 65200

      110 |         
      111 |         expect(result.ebt).toBeGreaterThan(0);
    > 112 |         expect(result.taxes).toBe(Math.round(result.ebt * 0.34 * 100) / 100);
          |                              ^
      113 |       });
      114 |
      115 |       it('should not apply taxes on negative income', () => {

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:112:30)

  ● Financial Calculations - Comprehensive Tests › calculateCashFlow › Operating cash flow calculations › should calculate OCF for first period (no WC change)

    expect(received).toBe(expected) // Object.is equality

    Expected: 120000
    Received: -50000

      205 |         const result = calculateCashFlow(basePeriod, null);
      206 |         
    > 207 |         expect(result.operatingCashFlow).toBe(120000); // NI + Depreciation
          |                                          ^
      208 |         expect(result.workingCapitalChange).toBe(0);
      209 |       });
      210 |

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:207:42)

  ● Financial Calculations - Comprehensive Tests › calculateCashFlow › Investing and free cash flow › should calculate investing cash flow with provided capex

    expect(received).toBe(expected) // Object.is equality

    Expected: 70000
    Received: -100000

      250 |         expect(result.capex).toBe(50000);
      251 |         expect(result.investingCashFlow).toBe(-50000);
    > 252 |         expect(result.freeCashFlow).toBe(70000); // 120k - 50k
          |                                     ^
      253 |       });
      254 |
      255 |       it('should use default capex rate when not provided', () => {

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:252:37)

  ● Financial Calculations - Comprehensive Tests › calculateCashFlow › Financing cash flow › should calculate financing cash flow correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 190000
    Received: 20000

      278 |         
      279 |         expect(result.financingCashFlow).toBe(120000); // 100k + 50k - 30k
    > 280 |         expect(result.netCashFlow).toBe(190000); // 120k - 50k + 120k
          |                                    ^
      281 |       });
      282 |
      283 |       it('should handle debt repayment and dividend payments', () => {

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:280:36)

  ● Financial Calculations - Comprehensive Tests › calculateCashFlow › Cash conversion metrics › should calculate cash conversion rate correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 120
    Received: -50

      299 |         const result = calculateCashFlow(basePeriod, null);
      300 |         
    > 301 |         expect(result.cashConversionRate).toBe(120); // (120k / 100k) * 100
          |                                           ^
      302 |       });
      303 |
      304 |       it('should handle negative net income', () => {

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:301:43)

  ● Financial Calculations - Comprehensive Tests › calculateCashFlow › Cash conversion metrics › should handle negative net income

    expect(received).toBe(expected) // Object.is equality

    Expected: -30000
    Received: -200000

      313 |         const result = calculateCashFlow(lossmaking, null);
      314 |         
    > 315 |         expect(result.operatingCashFlow).toBe(-30000); // -50k + 20k
          |                                          ^
      316 |         expect(result.cashConversionRate).toBe(60); // (-30k / -50k) * 100
      317 |       });
      318 |     });

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:315:42)

  ● Financial Calculations - Comprehensive Tests › calculateWorkingCapitalMetrics › Cash conversion cycle › should handle negative CCC (good cash management)

    expect(received).toBeLessThan(expected)

    Expected: < 0
    Received:   16438.35

      411 |         
      412 |         expect(result.cashConversionCycle).toBe(-10); // 30 + 20 - 60
    > 413 |         expect(result.workingCapitalValue).toBeLessThan(0); // Negative WC is good!
          |                                            ^
      414 |       });
      415 |     });
      416 |

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:413:44)

  ● Financial Calculations - Comprehensive Tests › calculateWorkingCapitalMetrics › Edge cases › should handle zero revenue

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 45

      458 |         
      459 |         expect(result.accountsReceivableValue).toBe(0);
    > 460 |         expect(result.dso).toBe(0);
          |                            ^
      461 |         expect(result.workingCapitalValue).toBe(0);
      462 |       });
      463 |

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:460:28)

  ● Financial Calculations - Comprehensive Tests › calculateBalanceSheet › Asset calculations › should estimate cash and current assets

    expect(received).toBe(expected) // Object.is equality

    Expected: 100000
    Received: 0

      626 |         const result = calculateBalanceSheet(baseData);
      627 |         
    > 628 |         expect(result.cash).toBe(100000); // Max of 10% revenue or net cash flow
          |                             ^
      629 |         expect(result.accountsReceivable).toBe(150000);
      630 |         expect(result.inventory).toBe(100000);
      631 |         expect(result.currentAssets).toBe(350000); // 100k + 150k + 100k

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:628:29)

  ● Financial Calculations - Comprehensive Tests › calculateBalanceSheet › Asset calculations › should calculate non-current assets to balance

    expect(received).toBe(expected) // Object.is equality

    Expected: 800000
    Received: 400000

      635 |         const result = calculateBalanceSheet(baseData);
      636 |         
    > 637 |         expect(result.totalAssets).toBe(800000);
          |                                    ^
      638 |         expect(result.nonCurrentAssets).toBe(450000); // 800k - 350k
      639 |       });
      640 |

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:637:36)

  ● Financial Calculations - Comprehensive Tests › calculateBalanceSheet › Asset calculations › should use revenue-based estimation when total assets not provided

    expect(received).toBe(expected) // Object.is equality

    Expected: 800000
    Received: 400000

      649 |         const result = calculateBalanceSheet(data);
      650 |         
    > 651 |         expect(result.totalAssets).toBe(800000); // 80% of revenue
          |                                    ^
      652 |       });
      653 |     });
      654 |

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:651:36)

  ● Financial Calculations - Comprehensive Tests › calculateBalanceSheet › Liability calculations › should calculate current liabilities

    expect(received).toBe(expected) // Object.is equality

    Expected: 130000
    Received: 150000

      659 |         expect(result.accountsPayable).toBe(80000);
      660 |         expect(result.shortTermDebt).toBe(50000); // 5% of revenue
    > 661 |         expect(result.currentLiabilities).toBe(130000); // 80k + 50k
          |                                           ^
      662 |       });
      663 |
      664 |       it('should balance with appropriate debt/equity ratio', () => {

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:661:43)

  ● Financial Calculations - Comprehensive Tests › calculateBalanceSheet › Edge cases › should handle missing working capital data

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 96000

      705 |         const result = calculateBalanceSheet(data);
      706 |         
    > 707 |         expect(result.accountsReceivable).toBe(0);
          |                                           ^
      708 |         expect(result.inventory).toBe(0);
      709 |         expect(result.accountsPayable).toBe(0);
      710 |         expect(result.currentAssets).toBeGreaterThan(0); // At least cash

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:707:43)

  ● Financial Calculations - Comprehensive Tests › calculateBalanceSheet › Edge cases › should handle negative net cash flow

    expect(received).toBe(expected) // Object.is equality

    Expected: 100000
    Received: 0

      721 |         const result = calculateBalanceSheet(data);
      722 |         
    > 723 |         expect(result.cash).toBe(100000); // Uses 10% of revenue minimum
          |                             ^
      724 |       });
      725 |     });
      726 |   });

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:723:29)

  console.error
    Error: Uncaught [TypeError: Cannot destructure property 'id' of '((cov_21d5mi7486(...).s[9]++) , event.data)' as it is undefined.]
        at reportException (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
        at Timeout.task [as _onTimeout] (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/browser/Window.js:521:9)
        at listOnTimeout (node:internal/timers:588:17)
        at processTimers (node:internal/timers:523:7) TypeError: Cannot destructure property 'id' of '((cov_21d5mi7486(...).s[9]++) , event.data)' as it is undefined.
        at MockWorker.onmessage (/home/user/EnterpriseCashFlow/src/services/financial/FinancialCalculationService.js:27:17)
        at /home/user/EnterpriseCashFlow/src/__tests__/services/financial/FinancialCalculationService.test.js:18:14
        at Timeout.task [as _onTimeout] (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/browser/Window.js:516:19)
        at listOnTimeout (node:internal/timers:588:17)
        at processTimers (node:internal/timers:523:7)

      at VirtualConsole.<anonymous> (node_modules/jsdom/lib/jsdom/virtual-console.js:29:45)
      at reportException (node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:70:28)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:521:9)

  console.error
    Financial analysis failed for profitability: Error: API Error
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/services/ai/__tests__/AIService.test.js:245:47)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12)

      112 |       return result;
      113 |     } catch (error) {
    > 114 |       console.error(`Financial analysis failed for ${analysisType}:`, error);
          |               ^
      115 |       throw new Error(`Analysis failed: ${error.message}`);
      116 |     }
      117 |   }

      at AIService.analyzeFinancial (src/services/ai/AIService.js:114:15)
      at Object.<anonymous> (src/services/ai/__tests__/AIService.test.js:247:7)

  console.error
    Data extraction failed: Error: Extraction failed
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/services/ai/__tests__/AIService.test.js:314:50)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12)

      141 |       return result;
      142 |     } catch (error) {
    > 143 |       console.error('Data extraction failed:', error);
          |               ^
      144 |       return {
      145 |         success: false,
      146 |         data: [],

      at AIService.extractData (src/services/ai/AIService.js:143:15)
      at Object.<anonymous> (src/services/ai/__tests__/AIService.test.js:316:22)

  console.error
    Insight generation failed: Error: Generation failed
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/services/ai/__tests__/AIService.test.js:363:47)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12)

      189 |       };
      190 |     } catch (error) {
    > 191 |       console.error('Insight generation failed:', error);
          |               ^
      192 |       throw new Error(`Insight generation failed: ${error.message}`);
      193 |     }
      194 |   }

      at AIService.generateInsights (src/services/ai/AIService.js:191:15)
      at Object.<anonymous> (src/services/ai/__tests__/AIService.test.js:365:7)

  console.error
    Financial analysis failed for liquidity: Error: Analysis 2 failed
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/services/ai/__tests__/AIService.test.js:413:32)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12)

      112 |       return result;
      113 |     } catch (error) {
    > 114 |       console.error(`Financial analysis failed for ${analysisType}:`, error);
          |               ^
      115 |       throw new Error(`Analysis failed: ${error.message}`);
      116 |     }
      117 |   }

      at AIService.analyzeFinancial (src/services/ai/AIService.js:114:15)
      at src/services/ai/AIService.js:210:27
          at async Promise.all (index 1)
      at AIService.batchAnalyze (src/services/ai/AIService.js:207:5)
      at Object.<anonymous> (src/services/ai/__tests__/AIService.test.js:415:22)

  console.error
    Excel Export error: Error: Invalid data format
        at ExcelExportService.export (/home/user/EnterpriseCashFlow/src/services/export/ExcelExportService.js:73:15)
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/services/export/__tests__/ExcelExportService.test.js:148:34)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12)

      230 |    */
      231 |   handleError(error, context = 'Export') {
    > 232 |     console.error(`${context} error:`, error);
          |             ^
      233 |     
      234 |     return {
      235 |       success: false,

      at ExcelExportService.handleError (src/services/export/BaseExportService.js:232:13)
      at ExcelExportService.export (src/services/export/ExcelExportService.js:132:19)
      at Object.<anonymous> (src/services/export/__tests__/ExcelExportService.test.js:148:34)

  console.error
    Excel Export error: Error: Failed to create workbook
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/services/export/__tests__/ExcelExportService.test.js:249:15)
        at /home/user/EnterpriseCashFlow/node_modules/jest-mock/build/index.js:449:39
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/node_modules/jest-mock/build/index.js:457:13)
        at Object.book_new (/home/user/EnterpriseCashFlow/node_modules/jest-mock/build/index.js:170:19)
        at ExcelExportService.export (/home/user/EnterpriseCashFlow/src/services/export/ExcelExportService.js:80:35)
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/services/export/__tests__/ExcelExportService.test.js:265:34)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12)

      230 |    */
      231 |   handleError(error, context = 'Export') {
    > 232 |     console.error(`${context} error:`, error);
          |             ^
      233 |     
      234 |     return {
      235 |       success: false,

      at ExcelExportService.handleError (src/services/export/BaseExportService.js:232:13)
      at ExcelExportService.export (src/services/export/ExcelExportService.js:132:19)
      at Object.<anonymous> (src/services/export/__tests__/ExcelExportService.test.js:265:34)

  console.error
    Excel Export error: Error: Missing required fields; Invalid data structure
        at ExcelExportService.export (/home/user/EnterpriseCashFlow/src/services/export/ExcelExportService.js:73:15)
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/services/export/__tests__/ExcelExportService.test.js:274:34)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12)

      230 |    */
      231 |   handleError(error, context = 'Export') {
    > 232 |     console.error(`${context} error:`, error);
          |             ^
      233 |     
      234 |     return {
      235 |       success: false,

      at ExcelExportService.handleError (src/services/export/BaseExportService.js:232:13)
      at ExcelExportService.export (src/services/export/ExcelExportService.js:132:19)
      at Object.<anonymous> (src/services/export/__tests__/ExcelExportService.test.js:274:34)

FAIL src/services/export/__tests__/ExcelExportService.test.js
  ExcelExportService
    constructor
      ✓ should create service with default options (2 ms)
      ✓ should create service with custom options (1 ms)
      ✓ should have predefined styles (2 ms)
      ✓ should have correct currency format
      ✓ should have correct percentage format
    export
      ✓ should export data successfully with single sheet (2 ms)
      ✓ should export data with multiple sheets (1 ms)
      ✕ should throw error on validation failure (172 ms)
      ✓ should set workbook properties (1 ms)
      ✓ should use default sheet name when not provided (1 ms)
      ✓ should merge export options with defaults
    style configuration
      ✓ should have header style with correct properties
      ✓ should have border configuration in header style (1 ms)
      ✓ should have correct date format
      ✓ should have correct number formats (1 ms)
    error handling
      ✕ should handle workbook creation errors (5 ms)
      ✕ should handle invalid data gracefully (3 ms)
    options handling
      ✓ should respect includeFormulas option (1 ms)
      ✓ should respect autoFilter option
      ✓ should respect freezePanes option
      ✓ should merge custom formatting options

  ● ExcelExportService › export › should throw error on validation failure

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"error": {"context": "Excel Export", "message": "Invalid data format", "timestamp": "2025-11-04T01:42:45.427Z"}, "success": false}

      146 |       }));
      147 |
    > 148 |       await expect(service.export(validData)).rejects.toThrow('Invalid data format');
          |             ^
      149 |     });
      150 |
      151 |     it('should set workbook properties', async () => {

      at expect (node_modules/expect/build/index.js:178:15)
      at Object.<anonymous> (src/services/export/__tests__/ExcelExportService.test.js:148:13)

  ● ExcelExportService › error handling › should handle workbook creation errors

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"error": {"context": "Excel Export", "message": "Failed to create workbook", "timestamp": "2025-11-04T01:42:45.440Z"}, "success": false}

      263 |       };
      264 |
    > 265 |       await expect(service.export(validData)).rejects.toThrow('Failed to create workbook');
          |             ^
      266 |     });
      267 |
      268 |     it('should handle invalid data gracefully', async () => {

      at expect (node_modules/expect/build/index.js:178:15)
      at Object.<anonymous> (src/services/export/__tests__/ExcelExportService.test.js:265:13)

  ● ExcelExportService › error handling › should handle invalid data gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"error": {"context": "Excel Export", "message": "Missing required fields; Invalid data structure", "timestamp": "2025-11-04T01:42:45.443Z"}, "success": false}

      272 |       }));
      273 |
    > 274 |       await expect(service.export({})).rejects.toThrow('Missing required fields; Invalid data structure');
          |             ^
      275 |     });
      276 |   });
      277 |

      at expect (node_modules/expect/build/index.js:178:15)
      at Object.<anonymous> (src/services/export/__tests__/ExcelExportService.test.js:274:13)

FAIL src/services/ai/__tests__/AIService.test.js
  AIService
    constructor
      ✓ should create service with default config (3 ms)
      ✓ should create service with custom config (1 ms)
      ✓ should initialize providers when provided in config (2 ms)
    initializeProviders
      ✓ should initialize multiple providers (1 ms)
      ✓ should handle provider initialization errors gracefully
    setProvider
      ✓ should set current provider (1 ms)
      ✓ should throw error if provider not initialized (41 ms)
    getCurrentProvider
      ✓ should return current provider instance
      ✓ should throw error if no provider available (2 ms)
    analyzeFinancial
      ✓ should perform financial analysis successfully (3 ms)
      ✓ should use cache when available (1 ms)
      ✓ should skip cache when requested
      ✓ should handle analysis errors (131 ms)
      ✓ should use custom temperature and maxTokens (1 ms)
    extractData
      ✓ should extract data from document successfully (1 ms)
      ✓ should handle extraction errors gracefully (4 ms)
    generateInsights
      ✓ should generate insights successfully (1 ms)
      ✓ should handle insight generation errors (2 ms)
    batchAnalyze
      ✓ should analyze multiple types successfully
      ✓ should handle partial failures in batch analysis (4 ms)
    categorizeInsight
      ✓ should categorize risk insights (1 ms)
      ✓ should categorize opportunity insights
      ✓ should categorize efficiency insights (1 ms)
      ✕ should categorize growth insights (2 ms)
      ✓ should categorize cost insights
      ✓ should return general for uncategorized insights (1 ms)
    prioritizeInsight
      ✕ should identify high priority insights
      ✓ should identify medium priority insights
      ✓ should identify low priority insights (1 ms)
    cache management
      ✓ should clear cache
      ✓ should expire cached items after timeout (151 ms)
    healthCheck
      ✓ should check health of all providers (1 ms)
      ✓ should handle provider health check failures

  ● AIService › categorizeInsight › should categorize growth insights

    expect(received).toBe(expected) // Object.is equality

    Expected: "growth"
    Received: "opportunity"

      444 |     it('should categorize growth insights', () => {
      445 |       const service = new AIService();
    > 446 |       expect(service.categorizeInsight('Significant growth potential')).toBe('growth');
          |                                                                         ^
      447 |       expect(service.categorizeInsight('Oportunidade de crescimento')).toBe('growth');
      448 |     });
      449 |

      at Object.<anonymous> (src/services/ai/__tests__/AIService.test.js:446:73)

  ● AIService › prioritizeInsight › should identify high priority insights

    expect(received).toBe(expected) // Object.is equality

    Expected: "high"
    Received: "low"

      464 |       const service = new AIService();
      465 |       expect(service.prioritizeInsight('This is critical and urgent')).toBe('high');
    > 466 |       expect(service.prioritizeInsight('Ação imediata necessária')).toBe('high');
          |                                                                     ^
      467 |     });
      468 |
      469 |     it('should identify medium priority insights', () => {

      at Object.<anonymous> (src/services/ai/__tests__/AIService.test.js:466:69)

FAIL src/utils/__tests__/financialValidators.test.js
  FinancialConstraintValidator
    getTolerance
      ✓ should return tolerance based on percentage of amount (2 ms)
      ✓ should return minimum absolute tolerance for small amounts
      ✓ should handle null amount (1 ms)
      ✓ should handle undefined amount
      ✓ should handle NaN amount
      ✓ should respect custom absolute minimum tolerance
      ✓ should handle negative amounts correctly
      ✓ should handle zero amount (1 ms)
    validatePLConstraints
      ✓ should validate correct P&L with no errors (1 ms)
      ✓ should detect gross profit equation violation (18 ms)
      ✓ should detect EBITDA equation violation (1 ms)
      ✓ should detect EBIT equation violation (1 ms)
      ✓ should detect PBT equation violation (1 ms)
      ✓ should detect net profit equation violation (1 ms)
      ✓ should warn when COGS exceeds revenue (1 ms)
      ✓ should not validate when values are null
      ✓ should not validate when values are undefined
      ✓ should handle missing optional fields (netInterestExpenseIncome) (8 ms)
    validateBalanceSheetConstraints
      ✓ should validate correct balance sheet with no errors
      ✓ should warn on material balance sheet imbalance (1 ms)
      ✓ should error when current assets exceed total assets
      ✓ should error when current liabilities exceed total liabilities (1 ms)
      ✓ should not error when total assets is zero
      ✓ should not error when total liabilities is zero
      ✓ should handle small imbalance within tolerance
    validateCashFlowConstraints
      ✓ should validate correct cash flow with no errors
      ✓ should detect DFC internal calculation error
      ✓ should warn on material cash override reconciliation difference
      ✓ should provide info when override matches calculated value
      ✓ should handle null cash reconciliation difference (1 ms)
      ✓ should handle undefined cash reconciliation difference
      ✓ should handle zero cash reconciliation difference
      ✕ should handle missing optional fields (2 ms)
    validateAllStatements
      ✓ should validate all statements and return combined results (1 ms)
      ✓ should detect equity bridge warning when provided with previous period (1 ms)
      ✓ should return isValid=false when there are errors (1 ms)
      ✓ should not check equity bridge when previous is not provided
      ✓ should not check equity bridge when equity is missing (1 ms)
  OverrideValidator
    extractOverrides
      ✓ should extract all override fields (1 ms)
      ✓ should ignore null override values
      ✓ should ignore undefined override values
      ✓ should ignore empty string override values (1 ms)
      ✓ should ignore NaN override values
      ✓ should convert string numbers to numbers
      ✓ should ignore fields without override_ prefix (1 ms)
      ✓ should return empty object when no overrides present
    validateOverrideConsistency
      ✓ should validate consistent overrides with no errors
      ✓ should detect inconsistent P&L overrides (1 ms)
      ✓ should warn about excessive overrides
      ✕ should handle null revenue (1 ms)
      ✕ should handle undefined revenue (1 ms)
      ✕ should handle empty string revenue
      ✓ should handle string revenue
      ✓ should not check consistency when only one override present
      ✓ should not warn about 7 or fewer overrides (1 ms)
      ✓ should handle zero revenue correctly

  ● FinancialConstraintValidator › validateCashFlowConstraints › should handle missing optional fields

    expect(received).toHaveLength(expected)

    Expected length: 0
    Received length: 1
    Received array:  [{"fields": ["netCashFlowBeforeFinancing", "cashFlowFromFinancing", "netChangeInCash"], "message": "ERRO INTERNO DFC: Variação Líquida de Caixa Armazenada (R$ 50.000,00) não confere com soma de seus componentes (FCL+FCF = R$ 70.000,00).", "severity": "critical", "type": "DFC_NET_CHANGE_CALC_ERROR"}]

      471 |
      472 |       const result = FinancialConstraintValidator.validateCashFlowConstraints(data);
    > 473 |       expect(result.errors).toHaveLength(0);
          |                             ^
      474 |     });
      475 |   });
      476 |

      at Object.<anonymous> (src/utils/__tests__/financialValidators.test.js:473:29)

  ● OverrideValidator › validateOverrideConsistency › should handle null revenue

    expect(received).toHaveLength(expected)

    Expected length: 0
    Received length: 1
    Received array:  [{"message": "Overrides de CPV (R$ 550.000,00) e Lucro Bruto (R$ 450.000,00) são matematicamente inconsistentes com a Receita (R$ 0,00).", "severity": "error", "type": "PL_OVERRIDE_INCONSISTENT"}]

      814 |
      815 |       const result = OverrideValidator.validateOverrideConsistency(periodInput);
    > 816 |       expect(result.errors).toHaveLength(0);
          |                             ^
      817 |     });
      818 |
      819 |     it('should handle undefined revenue', () => {

      at Object.<anonymous> (src/utils/__tests__/financialValidators.test.js:816:29)

  ● OverrideValidator › validateOverrideConsistency › should handle undefined revenue

    expect(received).toHaveLength(expected)

    Expected length: 0
    Received length: 1
    Received array:  [{"message": "Overrides de CPV (R$ 550.000,00) e Lucro Bruto (R$ 450.000,00) são matematicamente inconsistentes com a Receita (R$ 0,00).", "severity": "error", "type": "PL_OVERRIDE_INCONSISTENT"}]

      825 |
      826 |       const result = OverrideValidator.validateOverrideConsistency(periodInput);
    > 827 |       expect(result.errors).toHaveLength(0);
          |                             ^
      828 |     });
      829 |
      830 |     it('should handle empty string revenue', () => {

      at Object.<anonymous> (src/utils/__tests__/financialValidators.test.js:827:29)

  ● OverrideValidator › validateOverrideConsistency › should handle empty string revenue

    expect(received).toHaveLength(expected)

    Expected length: 0
    Received length: 1
    Received array:  [{"message": "Overrides de CPV (R$ 550.000,00) e Lucro Bruto (R$ 450.000,00) são matematicamente inconsistentes com a Receita (R$ 0,00).", "severity": "error", "type": "PL_OVERRIDE_INCONSISTENT"}]

      836 |
      837 |       const result = OverrideValidator.validateOverrideConsistency(periodInput);
    > 838 |       expect(result.errors).toHaveLength(0);
          |                             ^
      839 |     });
      840 |
      841 |     it('should handle string revenue', () => {

      at Object.<anonymous> (src/utils/__tests__/financialValidators.test.js:838:29)

PASS src/utils/__tests__/dataValidation.test.js
  Data Validation Utilities
    validateBalanceSheetInternalConsistency
      ✓ should return null when balance sheet is consistent (1 ms)
      ✓ should return critical error for significant differences (16 ms)
      ✓ should return warning for minor differences (1 ms)
      ✓ should handle zero assets edge case
    validateInventoryLevels
      ✓ should return null for normal inventory levels (1 ms)
      ✓ should return critical error for extremely high inventory days
      ✓ should return warning for very low inventory days
      ✓ should check inventory to revenue ratio
      ✓ should handle zero revenue edge case
    validateRealisticBusinessMetrics
      ✓ should return empty array for healthy metrics (7 ms)
      ✓ should detect insolvency risk (1 ms)
      ✓ should not flag insolvency if only one metric is negative
      ✓ should handle missing data gracefully
    validateCashFlowPatterns
      ✓ should return null for healthy cash flow patterns
      ✓ should detect concerning negative cash flow pattern
      ✓ should handle edge case of all negative cash flows (1 ms)
    validateWorkingCapitalEfficiency
      ✓ should return null for normal working capital cycle
      ✓ should flag very long cash cycle (1 ms)
      ✓ should celebrate very negative (good) cash cycle
      ✓ should handle zero working capital days (1 ms)
    validateBalanceSheetConsistency
      ✓ should return null when balance sheet balances
      ✓ should detect calculation inconsistency (1 ms)
      ✓ should flag material imbalances
      ✓ should allow immaterial differences (1 ms)
    runAllValidations
      ✓ should handle empty data gracefully
      ✓ should aggregate all validation results (1 ms)
      ✓ should categorize by severity correctly (1 ms)
    validateFinancialData
      ✓ should handle empty data (1 ms)
      ✓ should focus on latest period for critical issues (1 ms)
      ✓ should consolidate warnings across periods (1 ms)
      ✓ should analyze trends when multiple periods exist (1 ms)
      ✓ should calculate summary correctly (1 ms)
      ✓ should detect liquidity crisis
    Edge cases and error handling
      ✓ should handle undefined values gracefully
      ✓ should handle NaN values
      ✓ should handle extremely large numbers
      ✓ should handle negative equity scenarios (1 ms)

FAIL src/services/storage/__tests__/StorageManager.test.js
  StorageManager
    constructor
      ✓ should create storage manager with default config (4 ms)
      ✓ should create storage manager with custom config (3 ms)
      ✓ should initialize all storage services (3 ms)
    initialize
      ✓ should initialize all services successfully (4 ms)
      ✓ should initialize encryption when enabled with key (2 ms)
      ✓ should not initialize encryption without key (3 ms)
      ✓ should initialize auto-save when enabled (2 ms)
      ✓ should not initialize auto-save when disabled (2 ms)
      ✓ should not initialize twice (2 ms)
      ✓ should throw error on initialization failure (43 ms)
    getStorage
      ✓ should return localStorage for preferences (2 ms)
      ✓ should return localStorage for session data (3 ms)
      ✓ should return indexedDB for projects (2 ms)
      ✓ should return secure storage when encryption enabled (2 ms)
      ✓ should throw error if not initialized (9 ms)
    project management
      saveProject
        ✓ should save project successfully (3 ms)
        ✓ should trigger auto-save after saving (3 ms)
      getProject
        ✓ should retrieve project by ID (7 ms)
        ✓ should return null for non-existent project (3 ms)
      getProjects
        ✓ should retrieve all projects (2 ms)
        ✓ should retrieve projects with options (3 ms)
      deleteProject
        ✓ should delete project and associated data (2 ms)
        ✕ should delete associated scenarios and reports (3 ms)
    scenario management
      saveScenario
        ✓ should save scenario successfully (4 ms)
        ✓ should update project scenario list (2 ms)
        ✓ should trigger auto-save after saving (2 ms)
      getScenario
        ✓ should retrieve scenario by ID (2 ms)
      getScenarios
        ✓ should retrieve all scenarios (2 ms)
        ✓ should retrieve scenarios by projectId (6 ms)
      deleteScenario
        ✓ should delete scenario (1 ms)
        ✓ should handle deletion of non-existent scenario (2 ms)
    report management
      saveReport
        ✓ should save report successfully (2 ms)
        ✓ should update project report list (1 ms)
    error handling
      ✓ should handle storage errors gracefully (2 ms)

  ● StorageManager › project management › deleteProject › should delete associated scenarios and reports

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "scenarios", "scen-1"
    Received: "projects", "proj-1"

    Number of calls: 1

      279 |         await manager.deleteProject('proj-1');
      280 |
    > 281 |         expect(mockIndexedDB.remove).toHaveBeenCalledWith('scenarios', 'scen-1');
          |                                      ^
      282 |         expect(mockIndexedDB.remove).toHaveBeenCalledWith('reports', 'rep-1');
      283 |       });
      284 |     });

      at Object.<anonymous> (src/services/storage/__tests__/StorageManager.test.js:281:38)

PASS src/utils/__tests__/formatters.test.js
  Formatter Utilities
    formatCurrency
      ✓ should format basic currency values correctly (16 ms)
      ✓ should handle symbol parameter (1 ms)
      ✓ should abbreviate large numbers when requested (1 ms)
      ✓ should handle precision option (1 ms)
      ✓ should not abbreviate when abbreviate is false (1 ms)
      ✓ should handle negative values
      ✓ should handle null and undefined values (4 ms)
      ✓ should handle string numbers (1 ms)
      ✓ should handle very large numbers
      ✓ should handle edge cases for abbreviation thresholds (1 ms)
    formatCurrencyWithSign
      ✓ should format positive values normally (1 ms)
      ✓ should format negative values with sign before symbol
      ✓ should handle symbol parameter (1 ms)
      ✓ should handle null and undefined values
      ✓ should handle zero (1 ms)
    formatPercentage
      ✓ should format basic percentage values (1 ms)
      ✓ should handle multiplyBy100 parameter
      ✓ should handle negative percentages (1 ms)
      ✓ should handle decimal precision (1 ms)
      ✓ should handle null and undefined values
      ✓ should handle large percentages (1 ms)
    formatDays
      ✓ should format whole number days without decimals (1 ms)
      ✓ should format decimal days with one decimal place (1 ms)
      ✓ should round to nearest decimal
      ✓ should handle negative days
      ✓ should handle null and undefined values (1 ms)
      ✓ should handle zero days (1 ms)
      ✓ should handle very large numbers
    getMovementClass
      ✓ should return green class for positive values (1 ms)
      ✓ should return red class for negative values (1 ms)
      ✓ should return neutral class for zero or invalid values (1 ms)
      ✓ should handle string numbers (4 ms)
    getMovementIndicator
      ✓ should return up arrow for positive values
      ✓ should return down arrow for negative values (1 ms)
      ✓ should return empty string for zero or invalid values
    formatMovement
      ✓ should format currency movements by default (1 ms)
      ✓ should format percentage points (1 ms)
      ✓ should format days movements
      ✓ should format percentage changes (1 ms)
      ✓ should handle isPercentContext parameter
      ✓ should handle null and undefined values (1 ms)
      ✓ should handle edge cases
    Locale-specific formatting
      ✓ should use Brazilian Portuguese number formatting (1 ms)
    Edge cases and special scenarios
      ✓ should handle very small numbers (1 ms)
      ✓ should handle infinity (1 ms)
      ✓ should handle scientific notation
      ✓ should maintain precision for financial calculations (1 ms)

PASS src/__tests__/utils/financialFormulas.test.js
  Financial Formulas
    NPV (Net Present Value)
      ✓ should calculate positive NPV for profitable investment (1 ms)
      ✓ should calculate negative NPV for unprofitable investment
      ✓ should handle zero discount rate (1 ms)
    IRR (Internal Rate of Return)
      ✓ should calculate IRR for typical investment
      ✓ should handle multiple sign changes in cash flows (1 ms)
      ✓ should fail for impossible IRR (1 ms)
      ✓ should converge quickly for well-behaved cash flows
    Payback Period
      ✓ should calculate exact payback period (1 ms)
      ✓ should handle payback in first period (1 ms)
      ✓ should handle no payback scenario (5 ms)
      ✓ should provide cumulative cash flows
    Break-even Analysis
      ✓ should calculate break-even for positive contribution margin (1 ms)
      ✓ should handle zero contribution margin
      ✓ should handle negative contribution margin
      ✓ should calculate margin of safety (1 ms)
    Cash Flow Projections
      ✓ should project cash flows with constant growth
      ✓ should calculate present values with discount rate (1 ms)
      ✓ should calculate terminal value when valid
      ✓ should handle zero growth rate
      ✓ should handle negative growth rate (1 ms)
    Edge Cases and Validation
      ✓ should handle very large numbers
      ✓ should handle very small discount rates
      ✓ should handle zero cash flows (1 ms)
    Real-world Scenarios
      ✓ should evaluate a typical capital investment project
      ✓ should analyze a manufacturing break-even scenario (1 ms)

PASS src/__tests__/utils/financialCalculations.comprehensive.test.js
  DEFECT #2: safeDivide Function - Comprehensive Edge Case Testing
    NaN handling
      ✓ should return 0 when denominator is NaN (6 ms)
      ✓ should return 0 when numerator is NaN
      ✓ should return 0 when both numerator and denominator are NaN
    Infinity handling
      ✓ should return 0 when numerator is Infinity
      ✓ should return 0 when numerator is -Infinity
      ✓ should return 0 when denominator is Infinity (1 ms)
      ✓ should return 0 when result would be Infinity
    Null and undefined handling
      ✓ should return 0 when numerator is null
      ✓ should return 0 when numerator is undefined
      ✓ should return 0 when denominator is null (1 ms)
      ✓ should return 0 when denominator is undefined
    Zero handling
      ✓ should return 0 when denominator is zero
      ✓ should return 0 when denominator is negative zero
      ✓ should return 0 when numerator is zero
    Near-zero handling (Number.EPSILON)
      ✓ should return 0 when denominator is smaller than Number.EPSILON
      ✓ should handle denominator exactly at Number.EPSILON
    Unsafe result handling
      ✓ should return 0 when result exceeds MAX_SAFE_INTEGER
      ✓ should return 0 when result is below -MAX_SAFE_INTEGER (1 ms)
      ✓ should return 0 for very large division result
    Valid cases
      ✓ should handle normal positive division (1 ms)
      ✓ should handle normal negative division
      ✓ should handle decimal results
      ✓ should handle very small numbers
  DEFECT #1: Balance Sheet Estimation - Asset Turnover Approach
    Asset turnover calculation
      ✓ should use asset turnover ratio instead of revenue * 0.8 (1 ms)
      ✓ should calculate fixed assets as 40% of estimated total assets
      ✓ should allow custom asset turnover ratio (1 ms)
      ✓ should validate balance sheet equation A = L + E
    Edge cases
      ✓ should handle zero revenue (1 ms)
      ✓ should handle very high revenue
  DEFECT #3: Brazilian Tax Calculation - IRPJ + CSLL
    IRPJ calculation
      ✓ should calculate 15% IRPJ for profit below R$ 240k/year
      ✓ should calculate 15% + 10% surtax for profit above R$ 240k/year (1 ms)
      ✓ should handle monthly threshold of R$ 20k/month
      ✓ should handle quarterly periods
    CSLL calculation
      ✓ should always calculate 9% CSLL on profit (1 ms)
    Edge cases
      ✓ should return 0 for zero profit
      ✓ should return 0 for negative profit (no tax on losses)
      ✓ should handle very large profit (1 ms)
    Integration with income statement
      ✓ should replace flat 34% tax with progressive IRPJ + CSLL (1 ms)
  DEFECT #4: Cash Flow Working Capital - First Period Calculation
    First period working capital change
      ✓ should calculate first period WC change as cash outflow to establish WC
      ✓ should treat first period WC as cash investment (1 ms)
    Subsequent period working capital change
      ✓ should calculate WC change as delta from previous period
    Edge cases
      ✓ should handle zero working capital in first period
      ✓ should handle negative working capital change (cash inflow) (1 ms)
  DEFECT #5: Audit Trail System
    Audit trail creation
      ✓ should create audit trail for calculations (1 ms)
      ✓ should track calculation steps (4 ms)
      ✓ should track overrides applied (1 ms)
      ✓ should track validation results
    Audit trail storage
      ✓ should store audit trail with calculation results (1 ms)
      ✓ should include calculation chain in audit trail
    Audit trail querying
      ✓ should allow querying calculation history (1 ms)
      ✓ should allow querying override history
  Integration Tests - Complete Financial Processing
    ✓ should process multi-period data with all fixes applied (2 ms)
    ✓ should handle edge cases across all calculations (1 ms)

FAIL src/services/export/__tests__/ExportService.test.js
  ExportService
    Export Formats
      ✓ should provide available export formats (4 ms)
    Data Validation
      ✓ should validate export data (1 ms)
      ✕ should detect invalid data (1 ms)
      ✓ should warn about large data (80 ms)
    Templates
      ✓ should load default templates (2 ms)
      ✓ should filter templates by category
      ✓ should create custom template (1 ms)
      ✓ should clone existing template (1 ms)
    Branding
      ✓ should provide default branding (1 ms)
      ✕ should update branding configuration (3 ms)
    Export Statistics
      ✓ should track export statistics (1 ms)
      ✓ should update statistics after export (1 ms)
    Export Preview
      ✓ should generate preview URL (1 ms)
    Cross-browser Compatibility
      ✓ should handle missing Blob constructor (1 ms)
      ✕ should handle missing URL API (15 ms)
  ExportService Integration
    ✓ should export financial report with charts
    ✓ should handle batch export with multiple formats (1 ms)

  ● ExportService › Data Validation › should detect invalid data

    TypeError: Cannot read properties of null (reading 'charts')

      322 |     // Format-specific validation
      323 |     if (format === ExportFormat.PDF) {
    > 324 |       if (data.charts && !Array.isArray(data.charts)) {
          |                ^
      325 |         errors.push('Charts must be an array');
      326 |       }
      327 |     } else if (format === ExportFormat.EXCEL) {

      at ExportService.validateData (src/services/export/ExportService.js:324:16)
      at Object.<anonymous> (src/services/export/__tests__/ExportService.test.js:56:36)

  ● ExportService › Branding › should update branding configuration

    expect(received).toBe(expected) // Object.is equality

    Expected: "#ff0000"
    Received: "#007bff"

      138 |       const updated = exportService.getBranding();
      139 |       
    > 140 |       expect(updated.colors.primary).toBe('#ff0000');
          |                                      ^
      141 |       expect(updated.watermark.text).toBe('CONFIDENTIAL');
      142 |     });
      143 |   });

      at Object.<anonymous> (src/services/export/__tests__/ExportService.test.js:140:38)

  ● ExportService › Cross-browser Compatibility › should handle missing URL API

    expect(received).not.toThrow()

    Error name:    "TypeError"
    Error message: "Cannot read properties of undefined (reading 'createObjectURL')"

          264 |    */
          265 |   download(blob, fileName) {
        > 266 |     const url = URL.createObjectURL(blob);
              |                     ^
          267 |     const link = document.createElement('a');
          268 |     link.href = url;
          269 |     link.download = fileName;

      at ExportService.download (src/services/export/ExportService.js:266:21)
      at src/services/export/__tests__/ExportService.test.js:209:28
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:83:11)
      at Object.toThrow (node_modules/expect/build/index.js:382:21)
      at Object.<anonymous> (src/services/export/__tests__/ExportService.test.js:209:74)
      at Object.<anonymous> (src/services/export/__tests__/ExportService.test.js:209:74)

  console.warn
    Request failed, retrying... (2 attempts left)

      75 |     } catch (error) {
      76 |       if (retries > 0 && this.isRetryableError(error)) {
    > 77 |         console.warn(`Request failed, retrying... (${retries} attempts left)`);
         |                 ^
      78 |         await this.delay(this.retryDelay * (this.maxRetries - retries + 1));
      79 |         return this.executeWithRetry(requestFn, retries - 1);
      80 |       }

      at TestProvider.executeWithRetry (src/services/ai/providers/BaseProvider.js:77:17)
      at Object.<anonymous> (src/services/ai/providers/__tests__/BaseProvider.test.js:141:22)

  console.warn
    Request failed, retrying... (2 attempts left)

      75 |     } catch (error) {
      76 |       if (retries > 0 && this.isRetryableError(error)) {
    > 77 |         console.warn(`Request failed, retrying... (${retries} attempts left)`);
         |                 ^
      78 |         await this.delay(this.retryDelay * (this.maxRetries - retries + 1));
      79 |         return this.executeWithRetry(requestFn, retries - 1);
      80 |       }

      at TestProvider.executeWithRetry (src/services/ai/providers/BaseProvider.js:77:17)
      at Object.<anonymous> (src/services/ai/providers/__tests__/BaseProvider.test.js:170:7)

  console.warn
    Request failed, retrying... (1 attempts left)

      75 |     } catch (error) {
      76 |       if (retries > 0 && this.isRetryableError(error)) {
    > 77 |         console.warn(`Request failed, retrying... (${retries} attempts left)`);
         |                 ^
      78 |         await this.delay(this.retryDelay * (this.maxRetries - retries + 1));
      79 |         return this.executeWithRetry(requestFn, retries - 1);
      80 |       }

      at TestProvider.executeWithRetry (src/services/ai/providers/BaseProvider.js:77:17)
      at Object.<anonymous> (src/services/ai/providers/__tests__/BaseProvider.test.js:170:7)

  console.warn
    Request failed, retrying... (3 attempts left)

      75 |     } catch (error) {
      76 |       if (retries > 0 && this.isRetryableError(error)) {
    > 77 |         console.warn(`Request failed, retrying... (${retries} attempts left)`);
         |                 ^
      78 |         await this.delay(this.retryDelay * (this.maxRetries - retries + 1));
      79 |         return this.executeWithRetry(requestFn, retries - 1);
      80 |       }

      at TestProvider.executeWithRetry (src/services/ai/providers/BaseProvider.js:77:17)
      at Object.<anonymous> (src/services/ai/providers/__tests__/BaseProvider.test.js:196:7)

  console.warn
    Request failed, retrying... (2 attempts left)

      75 |     } catch (error) {
      76 |       if (retries > 0 && this.isRetryableError(error)) {
    > 77 |         console.warn(`Request failed, retrying... (${retries} attempts left)`);
         |                 ^
      78 |         await this.delay(this.retryDelay * (this.maxRetries - retries + 1));
      79 |         return this.executeWithRetry(requestFn, retries - 1);
      80 |       }

      at TestProvider.executeWithRetry (src/services/ai/providers/BaseProvider.js:77:17)
      at Object.<anonymous> (src/services/ai/providers/__tests__/BaseProvider.test.js:196:7)

FAIL src/__tests__/utils/customMatchers.js
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:175:18)
      at node_modules/@jest/core/build/TestScheduler.js:316:17
      at node_modules/emittery/index.js:260:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:258:23)

PASS src/services/ai/providers/__tests__/BaseProvider.test.js
  BaseProvider
    constructor
      ✓ should create provider with default config (1 ms)
      ✓ should create provider with custom config
      ✓ should store full config (1 ms)
    abstract methods
      ✓ should throw error if getCapabilities not implemented (18 ms)
      ✓ should throw error if complete not implemented (4 ms)
      ✓ should throw error if extractData not implemented (1 ms)
    healthCheck
      ✓ should return true for healthy provider
      ✓ should return false when complete fails (1 ms)
      ✓ should return false when complete returns empty content
    executeWithRetry
      ✓ should execute request successfully on first attempt (1 ms)
      ✓ should retry on retryable error (101 ms)
      ✓ should not retry on non-retryable error
      ✓ should throw error after max retries exceeded (35 ms)
      ✓ should increase delay between retries (6 ms)
    isRetryableError
      ✓ should identify 429 as retryable
      ✓ should identify 500 as retryable (1 ms)
      ✓ should identify 502 as retryable
      ✓ should identify 503 as retryable
      ✓ should identify 504 as retryable
      ✓ should identify AbortError as retryable (1 ms)
      ✓ should identify timeout errors as retryable
      ✓ should identify ECONNRESET as retryable
      ✓ should not identify 400 as retryable (1 ms)
      ✓ should not identify 401 as retryable
      ✓ should not identify 404 as retryable
    createAbortController
      ✓ should create abort controller with timeout (1 ms)
      ✓ should abort after timeout (51 ms)
    delay
      ✓ should delay for specified milliseconds (101 ms)
    parseErrorMessage
      ✓ should parse error with response and json error
      ✓ should parse error with response and message field (1 ms)
      ✓ should use statusText when json parsing fails
      ✓ should handle response without statusText
      ✓ should parse plain error message (1 ms)
      ✓ should return unknown error for error without message
    validateApiKey
      ✓ should not throw for valid API key
      ✓ should throw for missing API key
      ✓ should throw for empty API key (1 ms)
      ✓ should throw for whitespace-only API key (1 ms)

FAIL src/__tests__/utils/accessibilityUtils.js
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:175:18)
      at node_modules/@jest/core/build/TestScheduler.js:316:17
      at node_modules/emittery/index.js:260:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:258:23)

FAIL src/__tests__/utils/testDataFactories.js
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:175:18)
      at node_modules/@jest/core/build/TestScheduler.js:316:17
      at node_modules/emittery/index.js:260:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:258:23)

FAIL src/__tests__/utils/testDataFactories.comprehensive.js
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:175:18)
      at node_modules/@jest/core/build/TestScheduler.js:316:17
      at node_modules/emittery/index.js:260:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:258:23)

  console.error
    Warning: `ReactDOMTestUtils.act` is deprecated in favor of `React.act`. Import `act` from `react` instead of `react-dom/test-utils`. See https://react.dev/warnings/react-dom-test-utils for more info.

      50 |   describe('File Validation', () => {
      51 |     it('should validate PDF file type', async () => {
    > 52 |       const { result } = renderHook(() => usePdfParser());
         |                                    ^
      53 |       
      54 |       const invalidFile = new File(['content'], 'test.txt', { type: 'text/plain' });
      55 |

      at printWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:71:30)
      at error (node_modules/react-dom/cjs/react-dom-test-utils.development.js:45:7)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1736:7)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at renderHook (node_modules/@testing-library/react/dist/pure.js:293:7)
      at Object.<anonymous> (src/__tests__/integration/pdfParser.integration.test.js:52:36)

  console.error
    Warning: `ReactDOMTestUtils.act` is deprecated in favor of `React.act`. Import `act` from `react` instead of `react-dom/test-utils`. See https://react.dev/warnings/react-dom-test-utils for more info.

      40 |   describe('Worksheet Detection', () => {
      41 |     it('should find worksheet with financial headers', async () => {
    > 42 |       const { result } = renderHook(() => useExcelParser(mockExcelJS));
         |                                    ^
      43 |       
      44 |       // Setup mock data
      45 |       mockExcelJS.mockWorksheet.getRow.mockImplementation((rowNum) => {

      at printWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:71:30)
      at error (node_modules/react-dom/cjs/react-dom-test-utils.development.js:45:7)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1736:7)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at renderHook (node_modules/@testing-library/react/dist/pure.js:293:7)
      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:42:36)

  console.error
    Warning: `ReactDOMTestUtils.act` is deprecated in favor of `React.act`. Import `act` from `react` instead of `react-dom/test-utils`. See https://react.dev/warnings/react-dom-test-utils for more info.

      91 |   describe('Provider Configuration', () => {
      92 |     it('should initialize with default provider', () => {
    > 93 |       const { result } = renderHook(() => useAiService());
         |                                    ^
      94 |       
      95 |       expect(result.current.selectedProviderKey).toBe('gemini');
      96 |       expect(result.current.currentProviderConfig).toBeDefined();

      at printWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:71:30)
      at error (node_modules/react-dom/cjs/react-dom-test-utils.development.js:45:7)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1736:7)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at renderHook (node_modules/@testing-library/react/dist/pure.js:293:7)
      at Object.<anonymous> (src/__tests__/integration/aiService.integration.test.js:93:36)

  console.error
    Erro ao analisar PDF: TypeError: Cannot read properties of undefined (reading '5')
        at forEach (/home/user/EnterpriseCashFlow/src/hooks/usePdfParser.js:64:46)
        at Array.forEach (<anonymous>)
        at Object.extractTextFromPdf (/home/user/EnterpriseCashFlow/src/hooks/usePdfParser.js:63:27)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at /home/user/EnterpriseCashFlow/src/__tests__/integration/pdfParser.integration.test.js:90:25

      94 |       return { text: fullText.trim(), pageCount: numPages };
      95 |     } catch (err) {
    > 96 |       console.error("Erro ao analisar PDF:", err);
         |               ^
      97 |       setParsingError(err);
      98 |       setIsParsing(false);
      99 |       throw err;

      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:96:15)
      at src/__tests__/integration/pdfParser.integration.test.js:90:25

  console.error
    Erro ao analisar PDF: Error: Biblioteca PDF.js não disponível. Verifique a conexão de internet.
        at Object.extractTextFromPdf (/home/user/EnterpriseCashFlow/src/hooks/usePdfParser.js:35:15)
        at /home/user/EnterpriseCashFlow/src/__tests__/integration/pdfParser.integration.test.js:110:32
        at /home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/act-compat.js:64:24
        at act (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2512:16)
        at actWithWarning (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
        at /home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/act-compat.js:63:25
        at /home/user/EnterpriseCashFlow/src/__tests__/integration/pdfParser.integration.test.js:109:18
        at Object.toThrow (/home/user/EnterpriseCashFlow/node_modules/expect/build/index.js:267:58)
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/__tests__/integration/pdfParser.integration.test.js:112:18)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12)

      94 |       return { text: fullText.trim(), pageCount: numPages };
      95 |     } catch (err) {
    > 96 |       console.error("Erro ao analisar PDF:", err);
         |               ^
      97 |       setParsingError(err);
      98 |       setIsParsing(false);
      99 |       throw err;

      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:96:15)
      at src/__tests__/integration/pdfParser.integration.test.js:110:32
      at node_modules/@testing-library/react/dist/act-compat.js:64:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at src/__tests__/integration/pdfParser.integration.test.js:109:18
      at Object.toThrow (node_modules/expect/build/index.js:267:58)
      at Object.<anonymous> (src/__tests__/integration/pdfParser.integration.test.js:112:18)

  console.error
    Erro ao analisar PDF: TypeError: Cannot read properties of undefined (reading '5')
        at forEach (/home/user/EnterpriseCashFlow/src/hooks/usePdfParser.js:64:46)
        at Array.forEach (<anonymous>)
        at Object.extractTextFromPdf (/home/user/EnterpriseCashFlow/src/hooks/usePdfParser.js:63:27)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at /home/user/EnterpriseCashFlow/src/__tests__/integration/pdfParser.integration.test.js:126:9

      94 |       return { text: fullText.trim(), pageCount: numPages };
      95 |     } catch (err) {
    > 96 |       console.error("Erro ao analisar PDF:", err);
         |               ^
      97 |       setParsingError(err);
      98 |       setIsParsing(false);
      99 |       throw err;

      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:96:15)
      at src/__tests__/integration/pdfParser.integration.test.js:126:9

  console.error
    Erro ao analisar PDF: TypeError: Cannot read properties of undefined (reading '5')
        at forEach (/home/user/EnterpriseCashFlow/src/hooks/usePdfParser.js:64:46)
        at Array.forEach (<anonymous>)
        at Object.extractTextFromPdf (/home/user/EnterpriseCashFlow/src/hooks/usePdfParser.js:63:27)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at /home/user/EnterpriseCashFlow/src/__tests__/integration/pdfParser.integration.test.js:150:25

      94 |       return { text: fullText.trim(), pageCount: numPages };
      95 |     } catch (err) {
    > 96 |       console.error("Erro ao analisar PDF:", err);
         |               ^
      97 |       setParsingError(err);
      98 |       setIsParsing(false);
      99 |       throw err;

      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:96:15)
      at src/__tests__/integration/pdfParser.integration.test.js:150:25

  console.error
    Erro ao analisar PDF: TypeError: Cannot read properties of undefined (reading '5')
        at forEach (/home/user/EnterpriseCashFlow/src/hooks/usePdfParser.js:64:46)
        at Array.forEach (<anonymous>)
        at Object.extractTextFromPdf (/home/user/EnterpriseCashFlow/src/hooks/usePdfParser.js:63:27)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at /home/user/EnterpriseCashFlow/src/__tests__/integration/pdfParser.integration.test.js:174:25

      94 |       return { text: fullText.trim(), pageCount: numPages };
      95 |     } catch (err) {
    > 96 |       console.error("Erro ao analisar PDF:", err);
         |               ^
      97 |       setParsingError(err);
      98 |       setIsParsing(false);
      99 |       throw err;

      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:96:15)
      at src/__tests__/integration/pdfParser.integration.test.js:174:25

  console.error
    Erro ao analisar PDF: TypeError: Cannot read properties of undefined (reading '5')
        at forEach (/home/user/EnterpriseCashFlow/src/hooks/usePdfParser.js:64:46)
        at Array.forEach (<anonymous>)
        at Object.extractTextFromPdf (/home/user/EnterpriseCashFlow/src/hooks/usePdfParser.js:63:27)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at /home/user/EnterpriseCashFlow/src/__tests__/integration/pdfParser.integration.test.js:204:25

      94 |       return { text: fullText.trim(), pageCount: numPages };
      95 |     } catch (err) {
    > 96 |       console.error("Erro ao analisar PDF:", err);
         |               ^
      97 |       setParsingError(err);
      98 |       setIsParsing(false);
      99 |       throw err;

      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:96:15)
      at src/__tests__/integration/pdfParser.integration.test.js:204:25

  console.error
    Erro ao analisar PDF: TypeError: Cannot read properties of undefined (reading '5')
        at forEach (/home/user/EnterpriseCashFlow/src/hooks/usePdfParser.js:64:46)
        at Array.forEach (<anonymous>)
        at Object.extractTextFromPdf (/home/user/EnterpriseCashFlow/src/hooks/usePdfParser.js:63:27)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at /home/user/EnterpriseCashFlow/src/__tests__/integration/pdfParser.integration.test.js:232:25

      94 |       return { text: fullText.trim(), pageCount: numPages };
      95 |     } catch (err) {
    > 96 |       console.error("Erro ao analisar PDF:", err);
         |               ^
      97 |       setParsingError(err);
      98 |       setIsParsing(false);
      99 |       throw err;

      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:96:15)
      at src/__tests__/integration/pdfParser.integration.test.js:232:25

  console.error
    Erro ao analisar PDF: Error: Invalid PDF structure
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/__tests__/integration/pdfParser.integration.test.js:250:33)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12)

      94 |       return { text: fullText.trim(), pageCount: numPages };
      95 |     } catch (err) {
    > 96 |       console.error("Erro ao analisar PDF:", err);
         |               ^
      97 |       setParsingError(err);
      98 |       setIsParsing(false);
      99 |       throw err;

      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:96:15)
      at src/__tests__/integration/pdfParser.integration.test.js:255:11

  console.error
    Erro ao analisar PDF: TypeError: Cannot read properties of undefined (reading '5')
        at forEach (/home/user/EnterpriseCashFlow/src/hooks/usePdfParser.js:64:46)
        at Array.forEach (<anonymous>)
        at Object.extractTextFromPdf (/home/user/EnterpriseCashFlow/src/hooks/usePdfParser.js:63:27)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at /home/user/EnterpriseCashFlow/src/__tests__/integration/pdfParser.integration.test.js:285:11

      94 |       return { text: fullText.trim(), pageCount: numPages };
      95 |     } catch (err) {
    > 96 |       console.error("Erro ao analisar PDF:", err);
         |               ^
      97 |       setParsingError(err);
      98 |       setIsParsing(false);
      99 |       throw err;

      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:96:15)
      at src/__tests__/integration/pdfParser.integration.test.js:285:11

  console.error
    Erro ao analisar PDF: Error: Erro ao ler o arquivo PDF.
        at Object.onerror (/home/user/EnterpriseCashFlow/src/hooks/usePdfParser.js:42:39)
        at /home/user/EnterpriseCashFlow/src/__tests__/integration/pdfParser.integration.test.js:297:33
        at Timeout.task [as _onTimeout] (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/browser/Window.js:516:19)
        at listOnTimeout (node:internal/timers:588:17)
        at processTimers (node:internal/timers:523:7)

      94 |       return { text: fullText.trim(), pageCount: numPages };
      95 |     } catch (err) {
    > 96 |       console.error("Erro ao analisar PDF:", err);
         |               ^
      97 |       setParsingError(err);
      98 |       setIsParsing(false);
      99 |       throw err;

      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:96:15)
      at src/__tests__/integration/pdfParser.integration.test.js:305:11

  console.log
    [AI-1762220566751] Starting analysis: executive_summary with provider: invalid-provider

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.error
    Warning: You called act(async () => ...) without await. This could lead to unexpected testing behaviour, interleaving multiple act calls and mixing their scopes. You should - await act(async () => ...);

      at printWarning (node_modules/react/cjs/react.development.js:209:30)
      at error (node_modules/react/cjs/react.development.js:183:7)
      at node_modules/react/cjs/react.development.js:2564:15

  console.error
    [AI-1762220566751] Provider configuration error: Provedor AI não configurado ou inválido: invalid-provider

      73 |     if (!currentProviderConfig) {
      74 |       const err = new Error(`Provedor AI não configurado ou inválido: ${selectedProviderKey}`);
    > 75 |       console.error(`[${callId}] Provider configuration error:`, err.message);
         |               ^
      76 |       setError(err); // Set Error object
      77 |       throw err; // Re-throw for the caller to also handle if needed
      78 |     }

      at Object.callAiAnalysis (src/hooks/useAiService.js:75:15)
      at src/__tests__/integration/aiService.integration.test.js:116:32
      at node_modules/@testing-library/react/dist/act-compat.js:64:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at src/__tests__/integration/aiService.integration.test.js:115:18
      at Object.toThrow (node_modules/expect/build/index.js:267:58)
      at Object.<anonymous> (src/__tests__/integration/aiService.integration.test.js:121:18)

FAIL src/__tests__/integration/pdfParser.integration.test.js (5.054 s)
  PDF Parser Integration Tests
    File Validation
      ✕ should validate PDF file type (138 ms)
      ✓ should handle null or undefined file (3 ms)
      ✕ should accept valid PDF files (11 ms)
    PDF.js Library Integration
      ✓ should check for PDF.js availability (6 ms)
      ✕ should use PDF.js to load document (4 ms)
    Text Extraction
      ✕ should extract text from all pages (4 ms)
      ✕ should preserve text structure and spacing (3 ms)
      ✕ should handle PDFs with many pages (3 ms)
      ✕ should handle empty pages (5 ms)
    Error Handling
      ✕ should handle PDF loading errors (4 ms)
      ✕ should handle page extraction errors (9 ms)
      ✓ should handle file reading errors (5 ms)
    Loading State Management
      ✕ should manage isParsing state correctly (4 ms)
      ✕ should reset error state on new extraction (1 ms)
    Financial Data Extraction Scenarios
      ✕ should extract Brazilian financial statements (1 ms)
      ✕ should extract financial tables and preserve structure (1 ms)

  ● PDF Parser Integration Tests › File Validation › should validate PDF file type

    expect(received).toBeTruthy()

    Received: null

      60 |       }).rejects.toThrow('Arquivo inválido');
      61 |
    > 62 |       expect(result.current.parsingError).toBeTruthy();
         |                                           ^
      63 |       expect(result.current.parsingError.message).toContain('PDF válido');
      64 |     });
      65 |

      at Object.<anonymous> (src/__tests__/integration/pdfParser.integration.test.js:62:43)

  ● PDF Parser Integration Tests › File Validation › should accept valid PDF files

    TypeError: Cannot read properties of undefined (reading '5')

      62 |         // Group text items by their vertical position to maintain lines
      63 |         textContent.items.forEach(item => {
    > 64 |           const y = Math.round(item.transform[5]); // Vertical position
         |                                              ^
      65 |           
      66 |           if (lastY !== null && Math.abs(y - lastY) > 5) {
      67 |             // New line detected

      at forEach (src/hooks/usePdfParser.js:64:46)
          at Array.forEach (<anonymous>)
      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:63:27)
      at src/__tests__/integration/pdfParser.integration.test.js:90:25

  ● PDF Parser Integration Tests › PDF.js Library Integration › should use PDF.js to load document

    TypeError: Cannot read properties of undefined (reading '5')

      62 |         // Group text items by their vertical position to maintain lines
      63 |         textContent.items.forEach(item => {
    > 64 |           const y = Math.round(item.transform[5]); // Vertical position
         |                                              ^
      65 |           
      66 |           if (lastY !== null && Math.abs(y - lastY) > 5) {
      67 |             // New line detected

      at forEach (src/hooks/usePdfParser.js:64:46)
          at Array.forEach (<anonymous>)
      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:63:27)
      at src/__tests__/integration/pdfParser.integration.test.js:126:9

  ● PDF Parser Integration Tests › Text Extraction › should extract text from all pages

    TypeError: Cannot read properties of undefined (reading '5')

      62 |         // Group text items by their vertical position to maintain lines
      63 |         textContent.items.forEach(item => {
    > 64 |           const y = Math.round(item.transform[5]); // Vertical position
         |                                              ^
      65 |           
      66 |           if (lastY !== null && Math.abs(y - lastY) > 5) {
      67 |             // New line detected

      at forEach (src/hooks/usePdfParser.js:64:46)
          at Array.forEach (<anonymous>)
      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:63:27)
      at src/__tests__/integration/pdfParser.integration.test.js:150:25

  ● PDF Parser Integration Tests › Text Extraction › should preserve text structure and spacing

    TypeError: Cannot read properties of undefined (reading '5')

      62 |         // Group text items by their vertical position to maintain lines
      63 |         textContent.items.forEach(item => {
    > 64 |           const y = Math.round(item.transform[5]); // Vertical position
         |                                              ^
      65 |           
      66 |           if (lastY !== null && Math.abs(y - lastY) > 5) {
      67 |             // New line detected

      at forEach (src/hooks/usePdfParser.js:64:46)
          at Array.forEach (<anonymous>)
      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:63:27)
      at src/__tests__/integration/pdfParser.integration.test.js:174:25

  ● PDF Parser Integration Tests › Text Extraction › should handle PDFs with many pages

    TypeError: Cannot read properties of undefined (reading '5')

      62 |         // Group text items by their vertical position to maintain lines
      63 |         textContent.items.forEach(item => {
    > 64 |           const y = Math.round(item.transform[5]); // Vertical position
         |                                              ^
      65 |           
      66 |           if (lastY !== null && Math.abs(y - lastY) > 5) {
      67 |             // New line detected

      at forEach (src/hooks/usePdfParser.js:64:46)
          at Array.forEach (<anonymous>)
      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:63:27)
      at src/__tests__/integration/pdfParser.integration.test.js:204:25

  ● PDF Parser Integration Tests › Text Extraction › should handle empty pages

    TypeError: Cannot read properties of undefined (reading '5')

      62 |         // Group text items by their vertical position to maintain lines
      63 |         textContent.items.forEach(item => {
    > 64 |           const y = Math.round(item.transform[5]); // Vertical position
         |                                              ^
      65 |           
      66 |           if (lastY !== null && Math.abs(y - lastY) > 5) {
      67 |             // New line detected

      at forEach (src/hooks/usePdfParser.js:64:46)
          at Array.forEach (<anonymous>)
      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:63:27)
      at src/__tests__/integration/pdfParser.integration.test.js:232:25

  ● PDF Parser Integration Tests › Error Handling › should handle PDF loading errors

    expect(received).toBeTruthy()

    Received: null

      257 |       }).rejects.toThrow('Invalid PDF structure');
      258 |
    > 259 |       expect(result.current.parsingError).toBeTruthy();
          |                                           ^
      260 |       expect(result.current.isParsing).toBe(false);
      261 |     });
      262 |

      at Object.<anonymous> (src/__tests__/integration/pdfParser.integration.test.js:259:43)

  ● PDF Parser Integration Tests › Error Handling › should handle page extraction errors

    expect(received).rejects.toThrow(expected)

    Expected substring: "Page extraction failed"
    Received message:   "Cannot read properties of undefined (reading '5')"

          62 |         // Group text items by their vertical position to maintain lines
          63 |         textContent.items.forEach(item => {
        > 64 |           const y = Math.round(item.transform[5]); // Vertical position
             |                                              ^
          65 |           
          66 |           if (lastY !== null && Math.abs(y - lastY) > 5) {
          67 |             // New line detected

      at forEach (src/hooks/usePdfParser.js:64:46)
                at Array.forEach (<anonymous>)
      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:63:27)
      at src/__tests__/integration/pdfParser.integration.test.js:285:11
      at Object.toThrow (node_modules/expect/build/index.js:285:22)
      at Object.<anonymous> (src/__tests__/integration/pdfParser.integration.test.js:287:18)

  ● PDF Parser Integration Tests › Loading State Management › should manage isParsing state correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      336 |
      337 |       // Check loading state immediately
    > 338 |       expect(result.current.isParsing).toBe(true);
          |                                        ^
      339 |
      340 |       // Resolve the document loading
      341 |       resolveDocument(mockDocument);

      at Object.<anonymous> (src/__tests__/integration/pdfParser.integration.test.js:338:40)

  ● PDF Parser Integration Tests › Loading State Management › should reset error state on new extraction

    TypeError: Cannot read properties of null (reading 'parsingError')

      360 |       }
      361 |
    > 362 |       expect(result.current.parsingError).toBeTruthy();
          |                             ^
      363 |
      364 |       // Now try with valid file
      365 |       const validFile = new File(['%PDF-1.4'], 'test.pdf', { type: 'application/pdf' });

      at Object.<anonymous> (src/__tests__/integration/pdfParser.integration.test.js:362:29)

  ● PDF Parser Integration Tests › Financial Data Extraction Scenarios › should extract Brazilian financial statements

    TypeError: Cannot read properties of null (reading 'extractTextFromPdf')

      397 |       let extractedData;
      398 |       await act(async () => {
    > 399 |         extractedData = await result.current.extractTextFromPdf(pdfFile);
          |                                              ^
      400 |       });
      401 |
      402 |       expect(extractedData.text).toContain('DEMONSTRAÇÃO DE RESULTADOS');

      at src/__tests__/integration/pdfParser.integration.test.js:399:46
      at node_modules/@testing-library/react/dist/act-compat.js:64:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at Object.<anonymous> (src/__tests__/integration/pdfParser.integration.test.js:398:16)

  ● PDF Parser Integration Tests › Financial Data Extraction Scenarios › should extract financial tables and preserve structure

    TypeError: Cannot read properties of null (reading 'extractTextFromPdf')

      429 |       let extractedData;
      430 |       await act(async () => {
    > 431 |         extractedData = await result.current.extractTextFromPdf(pdfFile);
          |                                              ^
      432 |       });
      433 |
      434 |       expect(extractedData.text).toContain('Q1 2024');

      at src/__tests__/integration/pdfParser.integration.test.js:431:46
      at node_modules/@testing-library/react/dist/act-compat.js:64:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at Object.<anonymous> (src/__tests__/integration/pdfParser.integration.test.js:430:16)

  console.log
    [AI-1762220566802] Starting analysis: executive_summary with provider: openai

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.warn
    [AI-1762220566802] API key error: Chave API necessária para OpenAI mas não fornecida. Por favor, configure-a na seção "Configuração de IA".

      81 |     if (currentProviderConfig.requiresKey && (!currentApiKey || currentApiKey.trim() === '')) {
      82 |       const errMessage = `Chave API necessária para ${currentProviderConfig.name} mas não fornecida. Por favor, configure-a na seção "Configuração de IA".`;
    > 83 |       console.warn(`[${callId}] API key error:`, errMessage);
         |               ^
      84 |       setError(new Error(errMessage));
      85 |       throw new Error(errMessage); // Throw for consistency
      86 |     }

      at Object.callAiAnalysis (src/hooks/useAiService.js:83:15)
      at src/__tests__/integration/aiService.integration.test.js:131:32
      at node_modules/@testing-library/react/dist/act-compat.js:64:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at src/__tests__/integration/aiService.integration.test.js:130:18
      at Object.toThrow (node_modules/expect/build/index.js:267:58)
      at Object.<anonymous> (src/__tests__/integration/aiService.integration.test.js:138:18)

  console.log
    [AI-1762220566815] Starting analysis: executive_summary with provider: ollama

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566815] Iniciando análise: executive_summary com Ollama (Local)

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.log
    [AI-1762220566815] Raw response type: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:118:15)

  console.log
    [AI-1762220566815] Raw response preview: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:119:15)

  console.error
    [AI-1762220566815] Analysis failed for executive_summary

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)
      at src/__tests__/integration/aiService.integration.test.js:146:20

  console.log
    [AI-1762220566824] Starting analysis: executive_summary with provider: gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566824] Iniciando análise: executive_summary com Google Gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.log
    [AI-1762220566824] Raw response type: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:118:15)

  console.log
    [AI-1762220566824] Raw response preview: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:119:15)

  console.error
    [AI-1762220566824] Analysis failed for executive_summary

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)
      at src/__tests__/integration/aiService.integration.test.js:163:20

  console.log
    [AI-1762220566831] Starting analysis: variance_analysis with provider: gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566831] Iniciando análise: variance_analysis com Google Gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.log
    [AI-1762220566831] Raw response type: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:118:15)

  console.log
    [AI-1762220566831] Raw response preview: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:119:15)

  console.error
    [AI-1762220566831] Analysis failed for variance_analysis

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)
      at src/__tests__/integration/aiService.integration.test.js:181:20

  console.log
    [AI-1762220566837] Starting analysis: financial_data_extraction with provider: gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566837] Iniciando análise: financial_data_extraction com Google Gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.log
    [AI-1762220566837] Raw response type: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:118:15)

  console.log
    [AI-1762220566837] Raw response preview: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:119:15)

  console.error
    [AI-1762220566837] Analysis failed for financial_data_extraction

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)
      at src/__tests__/integration/aiService.integration.test.js:203:20

  console.log
    [AI-1762220566844] Starting analysis: risk_assessment with provider: gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566844] Iniciando análise: risk_assessment com Google Gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.log
    [AI-1762220566844] Raw response type: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:118:15)

  console.log
    [AI-1762220566844] Raw response preview: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:119:15)

  console.error
    [AI-1762220566844] Analysis failed for risk_assessment

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)
      at src/__tests__/integration/aiService.integration.test.js:220:20

  console.log
    [AI-1762220566849] Starting analysis: executive_summary with provider: gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566849] Iniciando análise: executive_summary com Google Gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.error
    [AI-1762220566849] Analysis failed for executive_summary

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)
      at src/__tests__/integration/aiService.integration.test.js:242:11

  console.log
    [AI-1762220566856] Starting analysis: executive_summary with provider: gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566856] Iniciando análise: executive_summary com Google Gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.log
    [AI-1762220566856] Raw response type: string

      at Object.callAiAnalysis (src/hooks/useAiService.js:118:15)

  console.log
    [AI-1762220566856] Raw response preview: Invalid response...

      at Object.callAiAnalysis (src/hooks/useAiService.js:119:15)

  console.error
    [AI-1762220566856] Analysis failed for executive_summary

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)
      at src/__tests__/integration/aiService.integration.test.js:267:11

  console.log
    [AI-1762220566870] Starting analysis: executive_summary with provider: openai

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566870] Iniciando análise: executive_summary com OpenAI

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.error
    [AI-1762220566870] Analysis failed for executive_summary

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)
      at src/__tests__/integration/aiService.integration.test.js:290:11

FAIL src/__tests__/integration/excelParser.integration.test.js (5.122 s)
  Excel Parser Integration Tests
    Worksheet Detection
      ✕ should find worksheet with financial headers (118 ms)
      ✕ should fallback to sheet with "Dados" in name (5 ms)
      ✓ should handle worksheets without proper headers (4 ms)
    Period Detection
      ✕ should detect periods with strict "Período X" pattern (4 ms)
      ✕ should detect periods with loose patterns (P1, P2, etc) (3 ms)
      ✕ should detect periods by column position between Description and Notes (2 ms)
      ✕ should limit detected periods to MAX_PERIODS (2 ms)
    Data Extraction
      ✕ should extract revenue data correctly (5 ms)
      ✕ should handle working capital days fields (5 ms)
      ✕ should handle percentage values correctly (3 ms)
      ✕ should skip grey-filled cells (3 ms)
    Error Handling
      ✓ should handle corrupted Excel files (3 ms)
      ✕ should handle empty worksheets (3 ms)
      ✕ should handle missing required fields (2 ms)
    Data Validation
      ✕ should validate numeric values (2 ms)
      ✕ should handle formula results (3 ms)
    Performance Tests
      ✕ should handle large Excel files efficiently (79 ms)
    Edge Cases
      ✕ should handle merged cells (2 ms)
      ✕ should handle hidden rows and columns (2 ms)
      ✕ should handle special characters in field names (2 ms)

  ● Excel Parser Integration Tests › Worksheet Detection › should find worksheet with financial headers

    expect(received).toBeNull()

    Received: "Nenhum dado financeiro encontrado na planilha."

      57 |       });
      58 |
    > 59 |       expect(result.current.parsingError).toBeNull();
         |                                           ^
      60 |       expect(parsedData).toBeDefined();
      61 |     });
      62 |

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:59:43)

  ● Excel Parser Integration Tests › Worksheet Detection › should fallback to sheet with "Dados" in name

    expect(jest.fn()).not.toHaveBeenCalled()

    Expected number of calls: 0
    Received number of calls: 1

    1: 1

      88 |
      89 |       expect(dataSheet.getRow).toHaveBeenCalled();
    > 90 |       expect(instructionSheet.getRow).not.toHaveBeenCalled();
         |                                           ^
      91 |     });
      92 |
      93 |     it('should handle worksheets without proper headers', async () => {

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:90:43)

  ● Excel Parser Integration Tests › Period Detection › should detect periods with strict "Período X" pattern

    expect(received).toHaveLength(expected)

    Matcher error: received value must have a length property whose value must be a number

    Received has value: null

      129 |       });
      130 |
    > 131 |       expect(parsedData).toHaveLength(4);
          |                          ^
      132 |     });
      133 |
      134 |     it('should detect periods with loose patterns (P1, P2, etc)', async () => {

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:131:26)

  ● Excel Parser Integration Tests › Period Detection › should detect periods with loose patterns (P1, P2, etc)

    expect(received).toHaveLength(expected)

    Matcher error: received value must have a length property whose value must be a number

    Received has value: null

      153 |       });
      154 |
    > 155 |       expect(parsedData).toHaveLength(4);
          |                          ^
      156 |     });
      157 |
      158 |     it('should detect periods by column position between Description and Notes', async () => {

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:155:26)

  ● Excel Parser Integration Tests › Period Detection › should detect periods by column position between Description and Notes

    expect(received).toHaveLength(expected)

    Matcher error: received value must have a length property whose value must be a number

    Received has value: null

      177 |       });
      178 |
    > 179 |       expect(parsedData).toHaveLength(4);
          |                          ^
      180 |     });
      181 |
      182 |     it('should limit detected periods to MAX_PERIODS', async () => {

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:179:26)

  ● Excel Parser Integration Tests › Period Detection › should limit detected periods to MAX_PERIODS

    expect(received).toHaveLength(expected)

    Matcher error: received value must have a length property whose value must be a number

    Received has value: null

      209 |       });
      210 |
    > 211 |       expect(parsedData).toHaveLength(6); // MAX_PERIODS is 6
          |                          ^
      212 |     });
      213 |   });
      214 |

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:211:26)

  ● Excel Parser Integration Tests › Data Extraction › should extract revenue data correctly

    TypeError: Cannot read properties of null (reading '0')

      237 |       });
      238 |
    > 239 |       expect(parsedData[0].revenue).toBe(1000000);
          |                        ^
      240 |       expect(parsedData[1].revenue).toBe(1100000);
      241 |       expect(parsedData[0].grossMarginPercent).toBe(45);
      242 |       expect(parsedData[0].operatingExpenses).toBe(300000);

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:239:24)

  ● Excel Parser Integration Tests › Data Extraction › should handle working capital days fields

    TypeError: Cannot read properties of null (reading '0')

      266 |       });
      267 |
    > 268 |       expect(parsedData[0].accountsReceivableDays).toBe(45);
          |                        ^
      269 |       expect(parsedData[0].inventoryDays).toBe(30);
      270 |       expect(parsedData[0].accountsPayableDays).toBe(60);
      271 |     });

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:268:24)

  ● Excel Parser Integration Tests › Data Extraction › should handle percentage values correctly

    TypeError: Cannot read properties of null (reading '0')

      295 |       });
      296 |
    > 297 |       expect(parsedData[0].grossMarginPercent).toBe(45); // Converted from 0.45
          |                        ^
      298 |     });
      299 |
      300 |     it('should skip grey-filled cells', async () => {

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:297:24)

  ● Excel Parser Integration Tests › Data Extraction › should skip grey-filled cells

    TypeError: Cannot read properties of null (reading '0')

      325 |       });
      326 |
    > 327 |       expect(parsedData[0].revenue).toBeUndefined(); // Grey cell skipped
          |                        ^
      328 |       expect(parsedData[1].revenue).toBe(1100000);
      329 |     });
      330 |   });

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:327:24)

  ● Excel Parser Integration Tests › Error Handling › should handle empty worksheets

    expect(received).toContain(expected) // indexOf

    Expected substring: "dados encontrados"
    Received string:    "Cannot read properties of undefined (reading 'values')"

      359 |       });
      360 |
    > 361 |       expect(result.current.parsingError).toContain('dados encontrados');
          |                                           ^
      362 |     });
      363 |
      364 |     it('should handle missing required fields', async () => {

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:361:43)

  ● Excel Parser Integration Tests › Error Handling › should handle missing required fields

    TypeError: Cannot read properties of null (reading '0')

      385 |       });
      386 |
    > 387 |       expect(parsedData[0].revenue).toBeUndefined();
          |                        ^
      388 |     });
      389 |   });
      390 |

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:387:24)

  ● Excel Parser Integration Tests › Data Validation › should validate numeric values

    TypeError: Cannot read properties of null (reading '0')

      412 |       });
      413 |
    > 414 |       expect(parsedData[0].revenue).toBeUndefined(); // Invalid value skipped
          |                        ^
      415 |     });
      416 |
      417 |     it('should handle formula results', async () => {

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:414:24)

  ● Excel Parser Integration Tests › Data Validation › should handle formula results

    TypeError: Cannot read properties of null (reading '0')

      439 |       });
      440 |
    > 441 |       expect(parsedData[0].revenue).toBe(1000000); // Extracts result from formula
          |                        ^
      442 |     });
      443 |   });
      444 |

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:441:24)

  ● Excel Parser Integration Tests › Performance Tests › should handle large Excel files efficiently

    expect(received).toHaveLength(expected)

    Matcher error: received value must have a length property whose value must be a number

    Received has value: null

      477 |
      478 |       expect(executionTime).toBeLessThan(5000); // Should complete within 5 seconds
    > 479 |       expect(parsedData).toHaveLength(4);
          |                          ^
      480 |     });
      481 |   });
      482 |

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:479:26)

  ● Excel Parser Integration Tests › Edge Cases › should handle merged cells

    expect(received).toHaveLength(expected)

    Matcher error: received value must have a length property whose value must be a number

    Received has value: null

      503 |       });
      504 |
    > 505 |       expect(parsedData).toHaveLength(2);
          |                          ^
      506 |       expect(parsedData[0].revenue).toBe(1000000);
      507 |       expect(parsedData[1].revenue).toBe(1100000);
      508 |     });

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:505:26)

  ● Excel Parser Integration Tests › Edge Cases › should handle hidden rows and columns

    TypeError: Cannot read properties of null (reading '0')

      533 |
      534 |       // Hidden rows should still be processed in this implementation
    > 535 |       expect(parsedData[0].revenue).toBe(1000000);
          |                        ^
      536 |       expect(parsedData[0].operatingExpenses).toBe(300000);
      537 |     });
      538 |

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:535:24)

  ● Excel Parser Integration Tests › Edge Cases › should handle special characters in field names

    TypeError: Cannot read properties of null (reading '0')

      560 |       });
      561 |
    > 562 |       expect(parsedData[0].revenue).toBe(1000000);
          |                        ^
      563 |       expect(parsedData[0].grossMarginPercent).toBe(45);
      564 |       expect(parsedData[0].depreciation).toBe(20000);
      565 |     });

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:562:24)

  console.log
    [AI-1762220566875] Starting analysis: executive_summary with provider: gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566875] Iniciando análise: executive_summary com Google Gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.error
    [AI-1762220566875] Analysis failed for executive_summary

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)
      at src/__tests__/integration/aiService.integration.test.js:313:11

  console.log
    [AI-1762220566881] Starting analysis: executive_summary with provider: gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566881] Iniciando análise: executive_summary com Google Gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.log
    [AI-1762220566881] Raw response type: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:118:15)

  console.log
    [AI-1762220566881] Raw response preview: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:119:15)

  console.error
    [AI-1762220566881] Analysis failed for executive_summary

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)
      at src/__tests__/integration/aiService.integration.test.js:340:9

  console.log
    [AI-1762220566888] Starting analysis: executive_summary with provider: openai

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566888] Iniciando análise: executive_summary com OpenAI

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.log
    [AI-1762220566888] Raw response type: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:118:15)

  console.log
    [AI-1762220566888] Raw response preview: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:119:15)

  console.error
    [AI-1762220566888] Analysis failed for executive_summary

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)
      at src/__tests__/integration/aiService.integration.test.js:361:9

  console.log
    [AI-1762220566894] Starting analysis: executive_summary with provider: openai

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566894] Iniciando análise: executive_summary com OpenAI

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.log
    [AI-1762220566894] Raw response type: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:118:15)

  console.log
    [AI-1762220566894] Raw response preview: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:119:15)

  console.error
    [AI-1762220566894] Analysis failed for executive_summary

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)
      at src/__tests__/integration/aiService.integration.test.js:382:9

  console.log
    [AI-1762220566905] Starting analysis: executive_summary with provider: gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566905] Iniciando análise: executive_summary com Google Gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.log
    [AI-1762220566905] Raw response type: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:118:15)

  console.log
    [AI-1762220566905] Raw response preview: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:119:15)

  console.error
    [AI-1762220566905] Analysis failed for executive_summary

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)
      at src/__tests__/integration/aiService.integration.test.js:406:9

  console.log
    [AI-1762220566911] Starting analysis: executive_summary with provider: gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566911] Iniciando análise: executive_summary com Google Gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.log
    [AI-1762220566911] Raw response type: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:118:15)

  console.log
    [AI-1762220566911] Raw response preview: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:119:15)

  console.error
    [AI-1762220566911] Analysis failed for executive_summary

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)
      at src/__tests__/integration/aiService.integration.test.js:433:9

  console.log
    [AI-1762220566916] Starting analysis: executive_summary with provider: gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566916] Iniciando análise: executive_summary com Google Gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.log
    [AI-1762220566916] Raw response type: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:118:15)

  console.log
    [AI-1762220566916] Raw response preview: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:119:15)

  console.error
    [AI-1762220566916] Analysis failed for executive_summary

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)
      at src/__tests__/integration/aiService.integration.test.js:456:11

  console.log
    [AI-1762220566921] Starting analysis: executive_summary with provider: gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566921] Iniciando análise: executive_summary com Google Gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.log
    [AI-1762220566921] Raw response type: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:118:15)

  console.log
    [AI-1762220566921] Raw response preview: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:119:15)

  console.error
    [AI-1762220566921] Analysis failed for executive_summary

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)
      at src/__tests__/integration/aiService.integration.test.js:476:20

  console.log
    [AI-1762220566925] Starting analysis: executive_summary with provider: gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566925] Iniciando análise: executive_summary com Google Gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.log
    [AI-1762220566925] Raw response type: string

      at Object.callAiAnalysis (src/hooks/useAiService.js:118:15)

  console.log
    [AI-1762220566925] Raw response preview: {"summary":"Partial analysis"}...

      at Object.callAiAnalysis (src/hooks/useAiService.js:119:15)

  console.error
    [AI-1762220566925] Analysis failed for executive_summary

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)
      at src/__tests__/integration/aiService.integration.test.js:504:20

  console.log
    [AI-1762220566930] Starting analysis: executive_summary with provider: gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566930] Iniciando análise: executive_summary com Google Gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.log
    [AI-1762220566932] Starting analysis: variance_analysis with provider: gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566932] Iniciando análise: variance_analysis com Google Gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.log
    [AI-1762220566933] Starting analysis: risk_assessment with provider: gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566933] Iniciando análise: risk_assessment com Google Gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.log
    [AI-1762220566930] Raw response type: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:118:15)

  console.log
    [AI-1762220566930] Raw response preview: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:119:15)

  console.error
    [AI-1762220566930] Analysis failed for executive_summary

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)

  console.log
    [AI-1762220566932] Raw response type: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:118:15)

  console.log
    [AI-1762220566932] Raw response preview: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:119:15)

  console.error
    [AI-1762220566932] Analysis failed for variance_analysis

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)

  console.log
    [AI-1762220566933] Raw response type: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:118:15)

  console.log
    [AI-1762220566933] Raw response preview: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:119:15)

  console.error
    [AI-1762220566933] Analysis failed for risk_assessment

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)

  console.log
    [AI-1762220566942] Starting analysis: executive_summary with provider: gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:71:13)

  console.log
    [AI-1762220566942] Iniciando análise: executive_summary com Google Gemini

      at Object.callAiAnalysis (src/hooks/useAiService.js:90:13)

  console.log
    [AI-1762220566942] Raw response type: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:118:15)

  console.log
    [AI-1762220566942] Raw response preview: undefined

      at Object.callAiAnalysis (src/hooks/useAiService.js:119:15)

  console.error
    [AI-1762220566942] Analysis failed for executive_summary

      151 |         console.error(`[${callId}] ERROR during analysis ${analysisType} with ${currentProviderConfig.name}:`, err);
      152 |       } else {
    > 153 |         console.error(`[${callId}] Analysis failed for ${analysisType}`);
          |                 ^
      154 |       }
      155 |       
      156 |       // Create user-friendly error message without exposing system internals

      at Object.callAiAnalysis (src/hooks/useAiService.js:153:17)
      at src/__tests__/integration/aiService.integration.test.js:556:20

(node:2587) PromiseRejectionHandledWarning: Promise rejection was handled asynchronously (rejection id: 8)
(Use `node --trace-warnings ...` to show where the warning was created)
(node:2587) PromiseRejectionHandledWarning: Promise rejection was handled asynchronously (rejection id: 9)
(node:2587) PromiseRejectionHandledWarning: Promise rejection was handled asynchronously (rejection id: 10)
FAIL src/__tests__/integration/aiService.integration.test.js (5.221 s)
  AI Service Integration Tests
    Provider Configuration
      ✓ should initialize with default provider (120 ms)
      ✓ should allow provider switching (4 ms)
      ✓ should handle invalid provider gracefully (52 ms)
    API Key Validation
      ✓ should require API key for providers that need it (12 ms)
      ✕ should not require API key for local providers (10 ms)
    Analysis Types
      ✕ should handle executive summary analysis (6 ms)
      ✕ should handle variance analysis (6 ms)
      ✕ should handle financial data extraction from PDF (7 ms)
      ✕ should handle risk assessment analysis (6 ms)
    Error Handling
      ✓ should handle API errors gracefully (7 ms)
      ✓ should handle malformed API responses (13 ms)
      ✓ should handle rate limiting (5 ms)
      ✓ should reset error state (6 ms)
    Request Options
      ✕ should apply temperature settings correctly (6 ms)
      ✕ should respect max tokens limit (6 ms)
      ✕ should use provider-specific model when specified (11 ms)
    Analysis History
      ✕ should track analysis history (6 ms)
      ✕ should provide provider insights (5 ms)
    Multi-Provider Support
      ✕ should format requests correctly for different providers (5 ms)
    Response Validation
      ✕ should validate and standardize AI responses (4 ms)
      ✕ should handle responses with missing fields (4 ms)
    Performance and Optimization
      ✕ should handle concurrent requests (11 ms)
      ✕ should handle large financial datasets (7 ms)

  ● AI Service Integration Tests › API Key Validation › should not require API key for local providers

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:146:20

  ● AI Service Integration Tests › Analysis Types › should handle executive summary analysis

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:163:20

  ● AI Service Integration Tests › Analysis Types › should handle variance analysis

    Falha na análise variance_analysis. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:181:20

  ● AI Service Integration Tests › Analysis Types › should handle financial data extraction from PDF

    Falha na análise financial_data_extraction. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:203:20

  ● AI Service Integration Tests › Analysis Types › should handle risk assessment analysis

    Falha na análise risk_assessment. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:220:20

  ● AI Service Integration Tests › Request Options › should apply temperature settings correctly

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:340:9

  ● AI Service Integration Tests › Request Options › should respect max tokens limit

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:361:9

  ● AI Service Integration Tests › Request Options › should use provider-specific model when specified

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:382:9

  ● AI Service Integration Tests › Analysis History › should track analysis history

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:406:9

  ● AI Service Integration Tests › Analysis History › should provide provider insights

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:433:9

  ● AI Service Integration Tests › Multi-Provider Support › should format requests correctly for different providers

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:456:11

  ● AI Service Integration Tests › Response Validation › should validate and standardize AI responses

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:476:20

  ● AI Service Integration Tests › Response Validation › should handle responses with missing fields

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:504:20

  ● AI Service Integration Tests › Performance and Optimization › should handle concurrent requests

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)

  ● AI Service Integration Tests › Performance and Optimization › should handle concurrent requests

    Falha na análise variance_analysis. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)

  ● AI Service Integration Tests › Performance and Optimization › should handle concurrent requests

    Falha na análise risk_assessment. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)

  ● AI Service Integration Tests › Performance and Optimization › should handle concurrent requests

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)

  ● AI Service Integration Tests › Performance and Optimization › should handle large financial datasets

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:556:20

  console.log
    Income Statement Calculation Performance: {
      avg: 0.02325286999999207,
      min: 0.018779999999878783,
      max: 0.18575499999997191,
      p50: 0.019368000000213215,
      p95: 0.031930000000102154,
      p99: 0.18575499999997191
    }

      at Object.<anonymous> (src/__tests__/performance/benchmarks.test.js:62:15)

  console.log
    Cash Flow Calculation Performance: {
      avg: 0.008361960000011095,
      min: 0.006999999999834472,
      max: 0.05661000000009153,
      p50: 0.007262999999966269,
      p95: 0.013232000000016342,
      p99: 0.05661000000009153
    }

      at Object.<anonymous> (src/__tests__/performance/benchmarks.test.js:96:15)

  console.error
    Warning: `ReactDOMTestUtils.act` is deprecated in favor of `React.act`. Import `act` from `react` instead of `react-dom/test-utils`. See https://react.dev/warnings/react-dom-test-utils for more info.

      42 |   describe('Rendering', () => {
      43 |     it('should render upload area and instructions', () => {
    > 44 |       render(<ExcelUploader {...defaultProps} />);
         |             ^
      45 |       
      46 |       expect(screen.getByText(/entrada de dados via excel/i)).toBeInTheDocument();
      47 |       expect(screen.getByText(/carregar planilha excel/i)).toBeInTheDocument();

      at printWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:71:30)
      at error (node_modules/react-dom/cjs/react-dom-test-utils.development.js:45:7)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1736:7)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/components/__tests__/ExcelUploader.test.js:44:13)

  console.error
    Warning: Failed prop type: Invalid prop `periodType` of value `MONTHLY` supplied to `ManualDataEntry`, expected one of ["anos","trimestres","meses"].
        at ManualDataEntry (/home/user/EnterpriseCashFlow/src/components/InputPanel/ManualDataEntry.jsx:25:3)

      32 |   describe('Rendering', () => {
      33 |     it('should render basic component structure', () => {
    > 34 |       render(<ManualDataEntry {...defaultProps} />);
         |              ^
      35 |       
      36 |       expect(screen.getByText('Entrada Manual de Dados - Modo Adaptativo')).toBeInTheDocument();
      37 |       expect(screen.getByLabelText(/Número de Períodos/i)).toBeInTheDocument();

      at printWarning (node_modules/react/cjs/react-jsx-dev-runtime.development.js:87:30)
      at error (node_modules/react/cjs/react-jsx-dev-runtime.development.js:61:7)
      at checkPropTypes (node_modules/react/cjs/react-jsx-dev-runtime.development.js:631:11)
      at validatePropTypes (node_modules/react/cjs/react-jsx-dev-runtime.development.js:1164:7)
      at jsxWithValidation (node_modules/react/cjs/react-jsx-dev-runtime.development.js:1303:7)
      at Object.<anonymous> (src/components/__tests__/ManualDataEntry.test.js:34:14)

  console.error
    Warning: `ReactDOMTestUtils.act` is deprecated in favor of `React.act`. Import `act` from `react` instead of `react-dom/test-utils`. See https://react.dev/warnings/react-dom-test-utils for more info.

      32 |   describe('Rendering', () => {
      33 |     it('should render basic component structure', () => {
    > 34 |       render(<ManualDataEntry {...defaultProps} />);
         |             ^
      35 |       
      36 |       expect(screen.getByText('Entrada Manual de Dados - Modo Adaptativo')).toBeInTheDocument();
      37 |       expect(screen.getByLabelText(/Número de Períodos/i)).toBeInTheDocument();

      at printWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:71:30)
      at error (node_modules/react-dom/cjs/react-dom-test-utils.development.js:45:7)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1736:7)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/components/__tests__/ManualDataEntry.test.js:34:13)

  console.log
    Multi-Period Processing Performance (12 periods): {
      avg: 0.7144922099999917,
      min: 0.6217489999999088,
      max: 3.5587490000002617,
      p50: 0.6659879999999703,
      p95: 0.8948199999999815,
      p99: 3.5587490000002617
    }

      at Object.<anonymous> (src/__tests__/performance/benchmarks.test.js:109:15)

  console.log
    Processing 100 periods took 5.59ms

      at Object.<anonymous> (src/__tests__/performance/benchmarks.test.js:124:15)

  console.log
    Financial Ratios Calculation Performance: {
      avg: 0.013767859999982193,
      min: 0.012772000000040862,
      max: 0.030635000000074797,
      p50: 0.013095000000021173,
      p95: 0.02036099999986618,
      p99: 0.030635000000074797
    }

      at Object.<anonymous> (src/__tests__/performance/benchmarks.test.js:152:15)

  console.log
    Financial Data Validation Performance: {
      avg: 0.030553310000000236,
      min: 0.026977999999871827,
      max: 0.04991599999993923,
      p50: 0.02740500000004431,
      p95: 0.04773399999999128,
      p99: 0.04991599999993923
    }

      at Object.<anonymous> (src/__tests__/performance/benchmarks.test.js:181:15)

  console.log
    All Validations Performance: {
      avg: 0.592947540000041,
      min: 0.5052310000000944,
      max: 0.9881220000002031,
      p50: 0.5726349999999911,
      p95: 0.7558880000001409,
      p99: 0.9881220000002031
    }

      at Object.<anonymous> (src/__tests__/performance/benchmarks.test.js:209:15)

  console.error
    Warning: `ReactDOMTestUtils.act` is deprecated in favor of `React.act`. Import `act` from `react` instead of `react-dom/test-utils`. See https://react.dev/warnings/react-dom-test-utils for more info.

      246 |       };
      247 |
    > 248 |       const { result } = renderHook(() => useExcelParser(mockExcelJS));
          |                                    ^
      249 |       
      250 |       const buffer = new ArrayBuffer(1024);
      251 |       

      at printWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:71:30)
      at error (node_modules/react-dom/cjs/react-dom-test-utils.development.js:45:7)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1736:7)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at renderHook (node_modules/@testing-library/react/dist/pure.js:293:7)
      at Object.<anonymous> (src/__tests__/performance/benchmarks.test.js:248:36)

  console.error
    Warning: An update to TestComponent inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
        at TestComponent (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:281:5)

      23 |    */
      24 |   const parseExcelData = useCallback(async (buffer) => {
    > 25 |     setIsParsing(true);
         |     ^
      26 |     setParsingError(null);
      27 |     
      28 |     try {

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at setIsParsing (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at Object.parseExcelData (src/hooks/useExcelParser.js:25:5)
      at Object.<anonymous> (src/__tests__/performance/benchmarks.test.js:253:28)

  console.error
    Warning: An update to TestComponent inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
        at TestComponent (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:281:5)

      24 |   const parseExcelData = useCallback(async (buffer) => {
      25 |     setIsParsing(true);
    > 26 |     setParsingError(null);
         |     ^
      27 |     
      28 |     try {
      29 |       let workbook;

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at setParsingError (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at Object.parseExcelData (src/hooks/useExcelParser.js:26:5)
      at Object.<anonymous> (src/__tests__/performance/benchmarks.test.js:253:28)

  console.error
    Warning: An update to TestComponent inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
        at TestComponent (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:281:5)

      73 |       return periodsData;
      74 |     } catch (error) {
    > 75 |       setParsingError(error.message);
         |       ^
      76 |       setIsParsing(false);
      77 |       return null;
      78 |     }

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at setParsingError (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at Object.parseExcelData (src/hooks/useExcelParser.js:75:7)
      at Object.<anonymous> (src/__tests__/performance/benchmarks.test.js:253:7)

  console.error
    Warning: An update to TestComponent inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
        at TestComponent (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:281:5)

      74 |     } catch (error) {
      75 |       setParsingError(error.message);
    > 76 |       setIsParsing(false);
         |       ^
      77 |       return null;
      78 |     }
      79 |   }, [excelJS]);

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at setIsParsing (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at Object.parseExcelData (src/hooks/useExcelParser.js:76:7)
      at Object.<anonymous> (src/__tests__/performance/benchmarks.test.js:253:7)

  console.log
    Excel parsing (100 rows) took 44.97ms

      at Object.<anonymous> (src/__tests__/performance/benchmarks.test.js:257:15)

  console.log
    Memory profiling not available in this environment

      at Object.<anonymous> (src/__tests__/performance/benchmarks.test.js:266:17)

  console.log
    Concurrent processing of 10 datasets took 7.04ms

      at Object.<anonymous> (src/__tests__/performance/benchmarks.test.js:314:15)

  console.log
    Performance Profile: {
      incomeStatement: {
        avg: 0.016183967999998005,
        min: 0.014067999999952008,
        max: 0.07692999999972017,
        p50: 0.014962000000195985,
        p95: 0.024535000000014406,
        p99: 0.03555899999992107
      },
      cashFlow: {
        avg: 0.00909544499999265,
        min: 0.004600999999638589,
        max: 3.2981869999998707,
        p50: 0.00483299999996234,
        p95: 0.008628999999928055,
        p99: 0.01630399999976362
      },
      workingCapital: {
        avg: 0.00848698499999773,
        min: 0.007018000000243774,
        max: 0.025716000000102213,
        p50: 0.007265000000188593,
        p95: 0.013588000000254397,
        p99: 0.01958599999989019
      },
      ratios: [],
      validation: []
    }

      at Object.<anonymous> (src/__tests__/performance/benchmarks.test.js:353:15)

  console.log
    SME quarterly processing + validation took 0.42ms

      at Object.<anonymous> (src/__tests__/performance/benchmarks.test.js:380:15)

  console.log
    Enterprise monthly processing (24 months) + validation took 1.54ms

      at Object.<anonymous> (src/__tests__/performance/benchmarks.test.js:406:15)

PASS src/__tests__/performance/benchmarks.test.js
  Performance Benchmarks
    Financial Calculations Performance
      ✓ should calculate income statement within performance targets (77 ms)
      ✓ should calculate cash flow within performance targets (3 ms)
      ✓ should process multiple periods within performance targets (84 ms)
      ✓ should handle large datasets efficiently (10 ms)
      ✓ should calculate complex financial ratios efficiently (3 ms)
    Data Validation Performance
      ✓ should validate financial data efficiently (6 ms)
      ✓ should run all validations efficiently (85 ms)
    Excel Processing Performance
      ✓ should parse Excel data efficiently (63 ms)
    Memory Usage Tests
      ✓ should not leak memory when processing large datasets (1 ms)
    Concurrent Processing Performance
      ✓ should handle concurrent calculations efficiently (9 ms)
    Optimization Opportunities
      ✓ should identify performance bottlenecks (40 ms)
    Real-world Scenario Performance
      ✓ should handle typical SME quarterly data efficiently (1 ms)
      ✓ should handle large enterprise monthly data efficiently (3 ms)

FAIL src/components/__tests__/ExcelUploader.test.js (5.87 s)
  ExcelUploader Component
    Rendering
      ✓ should render upload area and instructions (128 ms)
      ✓ should show loading state when ExcelJS is loading (8 ms)
      ✓ should show error state when ExcelJS fails to load (5 ms)
    File Upload
      ✕ should handle file selection via input (105 ms)
      ✕ should clear input after file selection (46 ms)
      ✕ should disable upload when loading (41 ms)
      ✕ should disable upload when ExcelJS is loading (36 ms)
      ✕ should accept Excel file types (39 ms)
    Template Download
      ✓ should call template download handler when download button is clicked (29 ms)
      ✓ should disable template download when ExcelJS is loading (5 ms)
      ✕ should disable template download when processing (5 ms)
    Error Handling
      ✓ should display ExcelJS loading error (7 ms)
      ✓ should not show error when ExcelJS loads successfully (4 ms)
    Component Integration
      ✓ should render ExcelTemplateSelector component (4 ms)
      ✓ should pass correct props to template selector (3 ms)
    Accessibility
      ✕ should have accessible file input (47 ms)
      ✓ should have proper button labels (5 ms)
    Loading States
      ✓ should show processing state when isLoading is true (3 ms)
      ✓ should show library loading state when isExcelJsLoading is true (3 ms)
    Props Validation
      ✓ should handle different period types (4 ms)
      ✓ should handle different numbers of periods (2 ms)

  ● ExcelUploader Component › File Upload › should handle file selection via input

    TestingLibraryElementError: Unable to find an accessible element with the role "button" and name `/carregar planilha excel/i`

    Here are the accessible roles:

      heading:

      Name "Entrada de Dados via Excel (Upload Adaptativo)":
      [36m<h2[39m
        [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
      [36m/>[39m

      Name "Ou Carregue seu Arquivo Preenchido:":
      [36m<h3[39m
        [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
      [36m/>[39m

      --------------------------------------------------
      button:

      Name "Baixar Modelo Excel":
      [36m<button[39m
        [33mdata-testid[39m=[32m"template-download-button"[39m
      [36m/>[39m

      --------------------------------------------------

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<section[39m
          [33mclass[39m=[32m"mb-8 p-6 bg-white rounded-xl shadow-xl border border-slate-200"[39m
        [36m>[39m
          [36m<h2[39m
            [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
          [36m>[39m
            [0mEntrada de Dados via Excel (Upload Adaptativo)[0m
          [36m</h2>[39m
          [36m<div[39m
            [33mdata-testid[39m=[32m"excel-template-selector"[39m
          [36m>[39m
            [36m<button[39m
              [33mdata-testid[39m=[32m"template-download-button"[39m
            [36m>[39m
              [0mBaixar Modelo Excel[0m
            [36m</button>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-8 border-t border-slate-200 pt-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
            [36m>[39m
              [0mOu Carregue seu Arquivo Preenchido:[0m
            [36m</h3>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex justify-center"[39m
            [36m>[39m
              [36m<label[39m
                [33mclass[39m=[32m"w-full sm:w-auto px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 text-center cursor-pointer"[39m
              [36m>[39m
                [36m<span[39m
                  [33mclass[39m=[32m"flex items-center justify-center"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-5 w-5 mr-2"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [0mCarregar Planilha Excel (.xlsx)[0m
                [36m</span>[39m
                [36m<input[39m
                  [33maccept[39m=[32m".xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"[39m
                  [33mclass[39m=[32m"hidden"[39m
                  [33mtype[39m=[32m"file"[39m
                [36m/>[39m
              [36m</label>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-4 text-center"[39m
          [36m>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-xs text-slate-500 mt-2"[39m
            [36m>[39m
              [0mA plataforma tentará identificar automaticamente o formato do template e o número de períodos do seu arquivo. Recomendamos usar o "Template Inteligente".[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</section>[39m
      [36m</div>[39m
    [36m</body>[39m

      73 |       });
      74 |
    > 75 |       const input = screen.getByRole('button', { name: /carregar planilha excel/i }).querySelector('input');
         |                            ^
      76 |       await user.upload(input, file);
      77 |
      78 |       expect(defaultProps.onFileUpload).toHaveBeenCalledWith(file);

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at getByRole (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19)
      at Object.<anonymous> (src/components/__tests__/ExcelUploader.test.js:75:28)

  ● ExcelUploader Component › File Upload › should clear input after file selection

    TestingLibraryElementError: Unable to find an accessible element with the role "button" and name `/carregar planilha excel/i`

    Here are the accessible roles:

      heading:

      Name "Entrada de Dados via Excel (Upload Adaptativo)":
      [36m<h2[39m
        [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
      [36m/>[39m

      Name "Ou Carregue seu Arquivo Preenchido:":
      [36m<h3[39m
        [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
      [36m/>[39m

      --------------------------------------------------
      button:

      Name "Baixar Modelo Excel":
      [36m<button[39m
        [33mdata-testid[39m=[32m"template-download-button"[39m
      [36m/>[39m

      --------------------------------------------------

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<section[39m
          [33mclass[39m=[32m"mb-8 p-6 bg-white rounded-xl shadow-xl border border-slate-200"[39m
        [36m>[39m
          [36m<h2[39m
            [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
          [36m>[39m
            [0mEntrada de Dados via Excel (Upload Adaptativo)[0m
          [36m</h2>[39m
          [36m<div[39m
            [33mdata-testid[39m=[32m"excel-template-selector"[39m
          [36m>[39m
            [36m<button[39m
              [33mdata-testid[39m=[32m"template-download-button"[39m
            [36m>[39m
              [0mBaixar Modelo Excel[0m
            [36m</button>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-8 border-t border-slate-200 pt-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
            [36m>[39m
              [0mOu Carregue seu Arquivo Preenchido:[0m
            [36m</h3>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex justify-center"[39m
            [36m>[39m
              [36m<label[39m
                [33mclass[39m=[32m"w-full sm:w-auto px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 text-center cursor-pointer"[39m
              [36m>[39m
                [36m<span[39m
                  [33mclass[39m=[32m"flex items-center justify-center"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-5 w-5 mr-2"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [0mCarregar Planilha Excel (.xlsx)[0m
                [36m</span>[39m
                [36m<input[39m
                  [33maccept[39m=[32m".xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"[39m
                  [33mclass[39m=[32m"hidden"[39m
                  [33mtype[39m=[32m"file"[39m
                [36m/>[39m
              [36m</label>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-4 text-center"[39m
          [36m>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-xs text-slate-500 mt-2"[39m
            [36m>[39m
              [0mA plataforma tentará identificar automaticamente o formato do template e o número de períodos do seu arquivo. Recomendamos usar o "Template Inteligente".[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</section>[39m
      [36m</div>[39m
    [36m</body>[39m

      87 |       });
      88 |
    > 89 |       const input = screen.getByRole('button', { name: /carregar planilha excel/i }).querySelector('input');
         |                            ^
      90 |       await user.upload(input, file);
      91 |
      92 |       expect(input.value).toBe('');

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at getByRole (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19)
      at Object.<anonymous> (src/components/__tests__/ExcelUploader.test.js:89:28)

  ● ExcelUploader Component › File Upload › should disable upload when loading

    TestingLibraryElementError: Unable to find an accessible element with the role "button" and name `/carregar planilha excel/i`

    Here are the accessible roles:

      heading:

      Name "Entrada de Dados via Excel (Upload Adaptativo)":
      [36m<h2[39m
        [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
      [36m/>[39m

      Name "Ou Carregue seu Arquivo Preenchido:":
      [36m<h3[39m
        [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
      [36m/>[39m

      --------------------------------------------------
      button:

      Name "Baixar Modelo Excel":
      [36m<button[39m
        [33mdata-testid[39m=[32m"template-download-button"[39m
      [36m/>[39m

      --------------------------------------------------

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<section[39m
          [33mclass[39m=[32m"mb-8 p-6 bg-white rounded-xl shadow-xl border border-slate-200"[39m
        [36m>[39m
          [36m<h2[39m
            [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
          [36m>[39m
            [0mEntrada de Dados via Excel (Upload Adaptativo)[0m
          [36m</h2>[39m
          [36m<div[39m
            [33mdata-testid[39m=[32m"excel-template-selector"[39m
          [36m>[39m
            [36m<button[39m
              [33mdata-testid[39m=[32m"template-download-button"[39m
            [36m>[39m
              [0mBaixar Modelo Excel[0m
            [36m</button>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-8 border-t border-slate-200 pt-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
            [36m>[39m
              [0mOu Carregue seu Arquivo Preenchido:[0m
            [36m</h3>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex justify-center"[39m
            [36m>[39m
              [36m<label[39m
                [33mclass[39m=[32m"w-full sm:w-auto px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 text-center opacity-50 cursor-not-allowed"[39m
              [36m>[39m
                [36m<span[39m
                  [33mclass[39m=[32m"flex items-center justify-center"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-5 w-5 mr-2"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [0mCarregar Planilha Excel (.xlsx)[0m
                [36m</span>[39m
                [36m<input[39m
                  [33maccept[39m=[32m".xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"[39m
                  [33mclass[39m=[32m"hidden"[39m
                  [33mdisabled[39m=[32m""[39m
                  [33mtype[39m=[32m"file"[39m
                [36m/>[39m
              [36m</label>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-4 text-center"[39m
          [36m>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-xs text-slate-500 mt-2"[39m
            [36m>[39m
              [0mA plataforma tentará identificar automaticamente o formato do template e o número de períodos do seu arquivo. Recomendamos usar o "Template Inteligente".[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</section>[39m
      [36m</div>[39m
    [36m</body>[39m

       96 |       render(<ExcelUploader {...defaultProps} isLoading={true} />);
       97 |       
    >  98 |       const input = screen.getByRole('button', { name: /carregar planilha excel/i }).querySelector('input');
          |                            ^
       99 |       expect(input).toBeDisabled();
      100 |     });
      101 |

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at getByRole (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19)
      at Object.<anonymous> (src/components/__tests__/ExcelUploader.test.js:98:28)

  ● ExcelUploader Component › File Upload › should disable upload when ExcelJS is loading

    TestingLibraryElementError: Unable to find an accessible element with the role "button" and name `/carregar planilha excel/i`

    Here are the accessible roles:

      heading:

      Name "Entrada de Dados via Excel (Upload Adaptativo)":
      [36m<h2[39m
        [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
      [36m/>[39m

      Name "Ou Carregue seu Arquivo Preenchido:":
      [36m<h3[39m
        [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
      [36m/>[39m

      --------------------------------------------------
      button:

      Name "Baixar Modelo Excel":
      [36m<button[39m
        [33mdata-testid[39m=[32m"template-download-button"[39m
        [33mdisabled[39m=[32m""[39m
      [36m/>[39m

      --------------------------------------------------

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<section[39m
          [33mclass[39m=[32m"mb-8 p-6 bg-white rounded-xl shadow-xl border border-slate-200"[39m
        [36m>[39m
          [36m<h2[39m
            [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
          [36m>[39m
            [0mEntrada de Dados via Excel (Upload Adaptativo)[0m
          [36m</h2>[39m
          [36m<div[39m
            [33mdata-testid[39m=[32m"excel-template-selector"[39m
          [36m>[39m
            [36m<button[39m
              [33mdata-testid[39m=[32m"template-download-button"[39m
              [33mdisabled[39m=[32m""[39m
            [36m>[39m
              [0mBaixar Modelo Excel[0m
            [36m</button>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-8 border-t border-slate-200 pt-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
            [36m>[39m
              [0mOu Carregue seu Arquivo Preenchido:[0m
            [36m</h3>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex justify-center"[39m
            [36m>[39m
              [36m<label[39m
                [33mclass[39m=[32m"w-full sm:w-auto px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 text-center opacity-50 cursor-not-allowed"[39m
              [36m>[39m
                [36m<span[39m
                  [33mclass[39m=[32m"flex items-center justify-center"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-5 w-5 mr-2"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [0mCarregar Planilha Excel (.xlsx)[0m
                [36m</span>[39m
                [36m<input[39m
                  [33maccept[39m=[32m".xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"[39m
                  [33mclass[39m=[32m"hidden"[39m
                  [33mdisabled[39m=[32m""[39m
                  [33mtype[39m=[32m"file"[39m
                [36m/>[39m
              [36m</label>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-4 text-center"[39m
          [36m>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-xs text-slate-500 mt-2"[39m
            [36m>[39m
              [0mA plataforma tentará identificar automaticamente o formato do template e o número de períodos do seu arquivo. Recomendamos usar o "Template Inteligente".[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</section>[39m
      [36m</div>[39m
    [36m</body>[39m

      103 |       render(<ExcelUploader {...defaultProps} isExcelJsLoading={true} />);
      104 |       
    > 105 |       const input = screen.getByRole('button', { name: /carregar planilha excel/i }).querySelector('input');
          |                            ^
      106 |       expect(input).toBeDisabled();
      107 |     });
      108 |

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at getByRole (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19)
      at Object.<anonymous> (src/components/__tests__/ExcelUploader.test.js:105:28)

  ● ExcelUploader Component › File Upload › should accept Excel file types

    TestingLibraryElementError: Unable to find an accessible element with the role "button" and name `/carregar planilha excel/i`

    Here are the accessible roles:

      heading:

      Name "Entrada de Dados via Excel (Upload Adaptativo)":
      [36m<h2[39m
        [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
      [36m/>[39m

      Name "Ou Carregue seu Arquivo Preenchido:":
      [36m<h3[39m
        [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
      [36m/>[39m

      --------------------------------------------------
      button:

      Name "Baixar Modelo Excel":
      [36m<button[39m
        [33mdata-testid[39m=[32m"template-download-button"[39m
      [36m/>[39m

      --------------------------------------------------

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<section[39m
          [33mclass[39m=[32m"mb-8 p-6 bg-white rounded-xl shadow-xl border border-slate-200"[39m
        [36m>[39m
          [36m<h2[39m
            [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
          [36m>[39m
            [0mEntrada de Dados via Excel (Upload Adaptativo)[0m
          [36m</h2>[39m
          [36m<div[39m
            [33mdata-testid[39m=[32m"excel-template-selector"[39m
          [36m>[39m
            [36m<button[39m
              [33mdata-testid[39m=[32m"template-download-button"[39m
            [36m>[39m
              [0mBaixar Modelo Excel[0m
            [36m</button>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-8 border-t border-slate-200 pt-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
            [36m>[39m
              [0mOu Carregue seu Arquivo Preenchido:[0m
            [36m</h3>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex justify-center"[39m
            [36m>[39m
              [36m<label[39m
                [33mclass[39m=[32m"w-full sm:w-auto px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 text-center cursor-pointer"[39m
              [36m>[39m
                [36m<span[39m
                  [33mclass[39m=[32m"flex items-center justify-center"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-5 w-5 mr-2"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [0mCarregar Planilha Excel (.xlsx)[0m
                [36m</span>[39m
                [36m<input[39m
                  [33maccept[39m=[32m".xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"[39m
                  [33mclass[39m=[32m"hidden"[39m
                  [33mtype[39m=[32m"file"[39m
                [36m/>[39m
              [36m</label>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-4 text-center"[39m
          [36m>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-xs text-slate-500 mt-2"[39m
            [36m>[39m
              [0mA plataforma tentará identificar automaticamente o formato do template e o número de períodos do seu arquivo. Recomendamos usar o "Template Inteligente".[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</section>[39m
      [36m</div>[39m
    [36m</body>[39m

      110 |       render(<ExcelUploader {...defaultProps} />);
      111 |       
    > 112 |       const input = screen.getByRole('button', { name: /carregar planilha excel/i }).querySelector('input');
          |                            ^
      113 |       expect(input).toHaveAttribute('accept', '.xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
      114 |     });
      115 |   });

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at getByRole (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19)
      at Object.<anonymous> (src/components/__tests__/ExcelUploader.test.js:112:28)

  ● ExcelUploader Component › Template Download › should disable template download when processing

    expect(element).toBeDisabled()

    Received element is not disabled:
      <button data-testid="template-download-button" />

      137 |       
      138 |       const downloadButton = screen.getByTestId('template-download-button');
    > 139 |       expect(downloadButton).toBeDisabled();
          |                              ^
      140 |     });
      141 |   });
      142 |

      at Object.<anonymous> (src/components/__tests__/ExcelUploader.test.js:139:30)

  ● ExcelUploader Component › Accessibility › should have accessible file input

    TestingLibraryElementError: Unable to find an accessible element with the role "button" and name `/carregar planilha excel/i`

    Here are the accessible roles:

      heading:

      Name "Entrada de Dados via Excel (Upload Adaptativo)":
      [36m<h2[39m
        [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
      [36m/>[39m

      Name "Ou Carregue seu Arquivo Preenchido:":
      [36m<h3[39m
        [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
      [36m/>[39m

      --------------------------------------------------
      button:

      Name "Baixar Modelo Excel":
      [36m<button[39m
        [33mdata-testid[39m=[32m"template-download-button"[39m
      [36m/>[39m

      --------------------------------------------------

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<section[39m
          [33mclass[39m=[32m"mb-8 p-6 bg-white rounded-xl shadow-xl border border-slate-200"[39m
        [36m>[39m
          [36m<h2[39m
            [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
          [36m>[39m
            [0mEntrada de Dados via Excel (Upload Adaptativo)[0m
          [36m</h2>[39m
          [36m<div[39m
            [33mdata-testid[39m=[32m"excel-template-selector"[39m
          [36m>[39m
            [36m<button[39m
              [33mdata-testid[39m=[32m"template-download-button"[39m
            [36m>[39m
              [0mBaixar Modelo Excel[0m
            [36m</button>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-8 border-t border-slate-200 pt-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
            [36m>[39m
              [0mOu Carregue seu Arquivo Preenchido:[0m
            [36m</h3>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex justify-center"[39m
            [36m>[39m
              [36m<label[39m
                [33mclass[39m=[32m"w-full sm:w-auto px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 text-center cursor-pointer"[39m
              [36m>[39m
                [36m<span[39m
                  [33mclass[39m=[32m"flex items-center justify-center"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-5 w-5 mr-2"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [0mCarregar Planilha Excel (.xlsx)[0m
                [36m</span>[39m
                [36m<input[39m
                  [33maccept[39m=[32m".xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"[39m
                  [33mclass[39m=[32m"hidden"[39m
                  [33mtype[39m=[32m"file"[39m
                [36m/>[39m
              [36m</label>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-4 text-center"[39m
          [36m>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-xs text-slate-500 mt-2"[39m
            [36m>[39m
              [0mA plataforma tentará identificar automaticamente o formato do template e o número de períodos do seu arquivo. Recomendamos usar o "Template Inteligente".[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</section>[39m
      [36m</div>[39m
    [36m</body>[39m

      175 |       render(<ExcelUploader {...defaultProps} />);
      176 |       
    > 177 |       const input = screen.getByRole('button', { name: /carregar planilha excel/i }).querySelector('input');
          |                            ^
      178 |       expect(input).toHaveAttribute('type', 'file');
      179 |       expect(input).toHaveClass('hidden');
      180 |     });

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at getByRole (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19)
      at Object.<anonymous> (src/components/__tests__/ExcelUploader.test.js:177:28)

FAIL src/__tests__/utils/testUtils.js
  ● Test suite failed to run

    Cannot find module 'react-router-dom' from 'src/__tests__/utils/testUtils.js'

       6 | import React from 'react';
       7 | import { render } from '@testing-library/react';
    >  8 | import { BrowserRouter } from 'react-router-dom';
         | ^
       9 |
      10 | /**
      11 |  * Custom render function that wraps components with necessary providers

      at Resolver.resolveModule (node_modules/jest-resolve/build/resolver.js:324:11)
      at Object.<anonymous> (src/__tests__/utils/testUtils.js:8:1)

PASS src/__tests__/setup/testInfrastructure.test.js
  Testing Infrastructure Setup
    Jest Configuration
      ✓ should have Jest configured with proper test environment (2 ms)
      ✓ should have jsdom environment available
    React Testing Library Setup
      ✓ should have React Testing Library utilities available (1 ms)
      ✓ should have user-event library available
    Accessibility Testing Setup
      ✓ should have jest-axe configured (1 ms)
      ✓ should have custom accessibility matchers available (82 ms)
    Jest DOM Matchers
      ✓ should have @testing-library/jest-dom matchers available (4 ms)
    Test Coverage Configuration
      ✓ should fail initially - coverage thresholds not yet configured (1 ms)
  Financial Calculation Test Utilities
    Custom Matchers for Financial Data
      ✓ should have custom financial matchers available (1 ms)
    Financial Test Data Factories
      ✓ should fail initially - test data factories not yet implemented
  Component Testing Patterns
    UI Component Test Utilities
      ✓ should fail initially - component test utilities not yet implemented (53 ms)
    Accessibility Testing Patterns
      ✓ should have accessibility test patterns implemented (6 ms)

  console.error
    Warning: An update to ManualDataEntry inside a test was not wrapped in act(...).
    
    When testing, code that causes React state updates should be wrapped into act(...):
    
    act(() => {
      /* fire events that update state */
    });
    /* assert on the output */
    
    This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
        at ManualDataEntry (/home/user/EnterpriseCashFlow/src/components/InputPanel/ManualDataEntry.jsx:25:3)

      40 |
      41 |   const toggleOverrideSection = (sectionKey) => {
    > 42 |     setExpandedOverrides(prev => ({ ...prev, [sectionKey]: !prev[sectionKey] }));
         |     ^
      43 |   };
      44 |
      45 |   const driverFieldKeys = getFieldKeys([FIELD_CATEGORIES.DRIVER_REQUIRED, FIELD_CATEGORIES.DRIVER_OPTIONAL]);

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom.development.js:27628:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom.development.js:25547:5)
      at setExpandedOverrides (node_modules/react-dom/cjs/react-dom.development.js:16708:7)
      at toggleOverrideSection (src/components/InputPanel/ManualDataEntry.jsx:42:5)
      at onClick (src/components/InputPanel/ManualDataEntry.jsx:104:28)
      at HTMLUnknownElement.callCallback (node_modules/react-dom/cjs/react-dom.development.js:4164:14)
      at HTMLUnknownElement.callTheUserObjectsOperation (node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:338:25)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
      at HTMLUnknownElementImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
      at HTMLUnknownElementImpl.dispatchEvent (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
      at HTMLUnknownElement.dispatchEvent (node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
      at Object.invokeGuardedCallbackDev (node_modules/react-dom/cjs/react-dom.development.js:4213:16)
      at invokeGuardedCallback (node_modules/react-dom/cjs/react-dom.development.js:4277:31)
      at invokeGuardedCallbackAndCatchFirstError (node_modules/react-dom/cjs/react-dom.development.js:4291:25)
      at executeDispatch (node_modules/react-dom/cjs/react-dom.development.js:9041:3)
      at processDispatchQueueItemsInOrder (node_modules/react-dom/cjs/react-dom.development.js:9073:7)
      at processDispatchQueue (node_modules/react-dom/cjs/react-dom.development.js:9086:5)
      at dispatchEventsForPlugins (node_modules/react-dom/cjs/react-dom.development.js:9097:3)
      at node_modules/react-dom/cjs/react-dom.development.js:9288:12
      at batchedUpdates$1 (node_modules/react-dom/cjs/react-dom.development.js:26179:12)
      at batchedUpdates (node_modules/react-dom/cjs/react-dom.development.js:3991:12)
      at dispatchEventForPluginEventSystem (node_modules/react-dom/cjs/react-dom.development.js:9287:3)
      at dispatchEventWithEnableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay (node_modules/react-dom/cjs/react-dom.development.js:6465:5)
      at dispatchEvent (node_modules/react-dom/cjs/react-dom.development.js:6457:5)
      at dispatchDiscreteEvent (node_modules/react-dom/cjs/react-dom.development.js:6430:5)
      at HTMLDivElement.callTheUserObjectsOperation (node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:338:25)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
      at HTMLSpanElementImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
      at HTMLSpanElementImpl.dispatchEvent (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
      at HTMLSpanElement.dispatchEvent (node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
      at node_modules/@testing-library/user-event/dist/cjs/event/dispatchEvent.js:45:43
      at Object.eventWrapper (node_modules/@testing-library/dom/dist/config.js:25:23)
      at Object.wrapEvent (node_modules/@testing-library/user-event/dist/cjs/event/wrapEvent.js:6:28)
      at Object.dispatchEvent (node_modules/@testing-library/user-event/dist/cjs/event/dispatchEvent.js:45:22)
      at Object.dispatchUIEvent (node_modules/@testing-library/user-event/dist/cjs/event/dispatchEvent.js:22:26)
      at Mouse.up (node_modules/@testing-library/user-event/dist/cjs/system/pointer/mouse.js:100:30)
      at PointerHost.release (node_modules/@testing-library/user-event/dist/cjs/system/pointer/index.js:87:24)
      at pointerAction (node_modules/@testing-library/user-event/dist/cjs/pointer/index.js:54:47)
      at Object.pointer (node_modules/@testing-library/user-event/dist/cjs/pointer/index.js:27:9)
      at Object.<anonymous> (src/components/__tests__/ManualDataEntry.test.js:128:7)

FAIL src/components/__tests__/ManualDataEntry.test.js (6.31 s)
  ManualDataEntry Component
    Rendering
      ✓ should render basic component structure (226 ms)
      ✓ should render driver fields table (46 ms)
      ✓ should handle different number of periods (33 ms)
    User Interactions
      ✓ should handle number of periods change (92 ms)
      ✕ should handle period type change (45 ms)
      ✓ should handle input changes (262 ms)
    Submit functionality
      ✓ should handle submit action (37 ms)
      ✕ should show loading state (54 ms)
    Override sections
      ✕ should render override sections as collapsed by default (48 ms)
      ✕ should expand override sections when clicked (99 ms)

  ● ManualDataEntry Component › User Interactions › should handle period type change

    TestingLibraryElementError: Value "QUARTERLY" not found in options

    Ignored nodes: comments, script, style
    [36m<select[39m
      [33mclass[39m=[32m"w-full p-2.5 border border-slate-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"[39m
      [33mid[39m=[32m"periodTypeEntry"[39m
    [36m>[39m
      [36m<option[39m
        [33mvalue[39m=[32m"anos"[39m
      [36m>[39m
        [0mAnos[0m
      [36m</option>[39m
      [36m<option[39m
        [33mvalue[39m=[32m"trimestres"[39m
      [36m>[39m
        [0mTrimestres[0m
      [36m</option>[39m
      [36m<option[39m
        [33mvalue[39m=[32m"meses"[39m
      [36m>[39m
        [0mMeses[0m
      [36m</option>[39m
    [36m</select>[39m

      73 |       
      74 |       const typeSelect = screen.getByLabelText(/Tipo de Período/i);
    > 75 |       await user.selectOptions(typeSelect, 'QUARTERLY');
         |                  ^
      76 |       
      77 |       expect(defaultProps.onPeriodTypeChange).toHaveBeenCalledWith('QUARTERLY');
      78 |     });

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/user-event/dist/cjs/utility/selectOptions.js:39:39
          at Array.map (<anonymous>)
      at Object.selectOptionsBase (node_modules/@testing-library/user-event/dist/cjs/utility/selectOptions.js:31:38)
      at Object.selectOptions (node_modules/@testing-library/user-event/dist/cjs/utility/selectOptions.js:18:30)
      at node_modules/@testing-library/user-event/dist/cjs/setup/setup.js:85:45
      at Object.asyncWrapper (node_modules/@testing-library/dom/dist/config.js:23:23)
      at Object.wrapAsync (node_modules/@testing-library/user-event/dist/cjs/setup/wrapAsync.js:8:28)
      at Object.selectOptions (node_modules/@testing-library/user-event/dist/cjs/setup/setup.js:85:26)
      at Object.<anonymous> (src/components/__tests__/ManualDataEntry.test.js:75:18)

  ● ManualDataEntry Component › Submit functionality › should show loading state

    TestingLibraryElementError: Found multiple elements with the role "button"

    Here are the matching elements:

    Ignored nodes: comments, script, style
    [36m<button[39m
      [33mclass[39m=[32m"flex items-center justify-between w-full p-3 bg-sky-100 hover:bg-sky-200 rounded-lg transition-colors mb-3 shadow-sm"[39m
      [33mtype[39m=[32m"button"[39m
    [36m>[39m
      [36m<div[39m
        [33mclass[39m=[32m"flex items-center space-x-2"[39m
      [36m>[39m
        [36m<span[39m
          [33mclass[39m=[32m"text-lg font-medium text-sky-700"[39m
        [36m>[39m
          [0m🔧 DRE - Itens de Resultado (Overrides Opcionais)[0m
        [36m</span>[39m
        [36m<span[39m
          [33mclass[39m=[32m"text-xs bg-sky-200 text-sky-800 px-2 py-0.5 rounded-full"[39m
        [36m>[39m
          [0mOpcional Avançado[0m
        [36m</span>[39m
      [36m</div>[39m
      [36m<div[39m
        [33mclass[39m=[32m"flex items-center space-x-2"[39m
      [36m>[39m
        [36m<svg[39m
          [33mclass[39m=[32m"w-5 h-5 text-sky-600 transition-transform "[39m
          [33mfill[39m=[32m"none"[39m
          [33mstroke[39m=[32m"currentColor"[39m
          [33mviewBox[39m=[32m"0 0 24 24"[39m
        [36m>[39m
          [36m<path[39m
            [33md[39m=[32m"M19 9l-7 7-7-7"[39m
            [33mstroke-linecap[39m=[32m"round"[39m
            [33mstroke-linejoin[39m=[32m"round"[39m
            [33mstroke-width[39m=[32m"2"[39m
          [36m/>[39m
        [36m</svg>[39m
      [36m</div>[39m
    [36m</button>[39m

    Ignored nodes: comments, script, style
    [36m<button[39m
      [33mclass[39m=[32m"flex items-center justify-between w-full p-3 bg-sky-100 hover:bg-sky-200 rounded-lg transition-colors mb-3 shadow-sm"[39m
      [33mtype[39m=[32m"button"[39m
    [36m>[39m
      [36m<div[39m
        [33mclass[39m=[32m"flex items-center space-x-2"[39m
      [36m>[39m
        [36m<span[39m
          [33mclass[39m=[32m"text-lg font-medium text-sky-700"[39m
        [36m>[39m
          [0m🔧 Balanço Patrimonial (Overrides Opcionais)[0m
        [36m</span>[39m
        [36m<span[39m
          [33mclass[39m=[32m"text-xs bg-sky-200 text-sky-800 px-2 py-0.5 rounded-full"[39m
        [36m>[39m
          [0mOpcional Avançado[0m
        [36m</span>[39m
      [36m</div>[39m
      [36m<div[39m
        [33mclass[39m=[32m"flex items-center space-x-2"[39m
      [36m>[39m
        [36m<svg[39m
          [33mclass[39m=[32m"w-5 h-5 text-sky-600 transition-transform "[39m
          [33mfill[39m=[32m"none"[39m
          [33mstroke[39m=[32m"currentColor"[39m
          [33mviewBox[39m=[32m"0 0 24 24"[39m
        [36m>[39m
          [36m<path[39m
            [33md[39m=[32m"M19 9l-7 7-7-7"[39m
            [33mstroke-linecap[39m=[32m"round"[39m
            [33mstroke-linejoin[39m=[32m"round"[39m
            [33mstroke-width[39m=[32m"2"[39m
          [36m/>[39m
        [36m</svg>[39m
      [36m</div>[39m
    [36m</button>[39m

    Ignored nodes: comments, script, style
    [36m<button[39m
      [33mclass[39m=[32m"flex items-center justify-between w-full p-3 bg-sky-100 hover:bg-sky-200 rounded-lg transition-colors mb-3 shadow-sm"[39m
      [33mtype[39m=[32m"button"[39m
    [36m>[39m
      [36m<div[39m
        [33mclass[39m=[32m"flex items-center space-x-2"[39m
      [36m>[39m
        [36m<span[39m
          [33mclass[39m=[32m"text-lg font-medium text-sky-700"[39m
        [36m>[39m
          [0m🔧 Fluxo de Caixa (Overrides Opcionais)[0m
        [36m</span>[39m
        [36m<span[39m
          [33mclass[39m=[32m"text-xs bg-sky-200 text-sky-800 px-2 py-0.5 rounded-full"[39m
        [36m>[39m
          [0mOpcional Avançado[0m
        [36m</span>[39m
      [36m</div>[39m
      [36m<div[39m
        [33mclass[39m=[32m"flex items-center space-x-2"[39m
      [36m>[39m
        [36m<svg[39m
          [33mclass[39m=[32m"w-5 h-5 text-sky-600 transition-transform "[39m
          [33mfill[39m=[32m"none"[39m
          [33mstroke[39m=[32m"currentColor"[39m
          [33mviewBox[39m=[32m"0 0 24 24"[39m
        [36m>[39m
          [36m<path[39m
            [33md[39m=[32m"M19 9l-7 7-7-7"[39m
            [33mstroke-linecap[39m=[32m"round"[39m
            [33mstroke-linejoin[39m=[32m"round"[39m
            [33mstroke-width[39m=[32m"2"[39m
          [36m/>[39m
        [36m</svg>[39m
      [36m</div>[39m
    [36m</button>[39m

    Ignored nodes: comments, script, style
    [36m<button[39m
      [33mclass[39m=[32m"px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 disabled:opacity-50 disabled:cursor-not-allowed"[39m
      [33mdisabled[39m=[32m""[39m
    [36m>[39m
      [36m<div[39m
        [33mclass[39m=[32m"flex items-center justify-center space-x-2"[39m
      [36m>[39m
        [36m<svg[39m
          [33mclass[39m=[32m"animate-spin h-4 w-4 text-white"[39m
          [33mfill[39m=[32m"none"[39m
          [33mviewBox[39m=[32m"0 0 24 24"[39m
          [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
        [36m>[39m
          [36m<circle[39m
            [33mclass[39m=[32m"opacity-25"[39m
            [33mcx[39m=[32m"12"[39m
            [33mcy[39m=[32m"12"[39m
            [33mr[39m=[32m"10"[39m
            [33mstroke[39m=[32m"currentColor"[39m
            [33mstroke-width[39m=[32m"4"[39m
          [36m/>[39m
          [36m<path[39m
            [33mclass[39m=[32m"opacity-75"[39m
            [33md[39m=[32m"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"[39m
            [33mfill[39m=[32m"currentColor"[39m
          [36m/>[39m
        [36m</svg>[39m
        [36m<span>[39m
          [0mProcessando...[0m
        [36m</span>[39m
      [36m</div>[39m
    [36m</button>[39m

    (If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<section[39m
          [33mclass[39m=[32m"mb-8 p-6 bg-white rounded-xl shadow-lg border border-slate-200"[39m
        [36m>[39m
          [36m<h2[39m
            [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
          [36m>[39m
            [0mEntrada Manual de Dados - Modo Adaptativo[0m
          [36m</h2>[39m
          [36m<div[39m
            [33mclass[39m=[32m"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"[39m
          [36m>[39m
            [36m<div>[39m
              [36m<label[39m
                [33mclass[39m=[32m"block text-sm font-medium text-slate-700 mb-1"[39m
                [33mfor[39m=[32m"numberOfPeriodsEntry"[39m
              [36m>[39m
                [0mNúmero de Períodos ([0m
                [0m2[0m
                [0m-[0m
                [0m6[0m
                [0m):[0m
              [36m</label>[39m
              [36m<select[39m
                [33mclass[39m=[32m"w-full p-2.5 border border-slate-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"[39m
                [33mid[39m=[32m"numberOfPeriodsEntry"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"2"[39m
                [36m>[39m
                  [0m2[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"3"[39m
                [36m>[39m
                  [0m3[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"4"[39m
                [36m>[39m
                  [0m4[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"5"[39m
                [36m>[39m
                  [0m5[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"6"[39m
                [36m>[39m
                  [0m6[0m
                  [0m Períodos[0m
                [36m</option>[39m
              [36m</select>[39m
            [36m</div>[39m
            [36m<div>[39m
              [36m<label[39m
                [33mclass[39m=[32m"block text-sm font-medium text-slate-700 mb-1"[39m
                [33mfor[39m=[32m"periodTypeEntry"[39m
              [36m>[39m
                [0mTipo de Período:[0m
              [36m</label>[39m
              [36m<select[39m
                [33mclass[39m=[32m"w-full p-2.5 border border-slate-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"[39m
                [33mid[39m=[32m"periodTypeEntry"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"anos"[39m
                [36m>[39m
                  [0mAnos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"trimestres"[39m
                [36m>[39m
                  [0mTrimestres[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"meses"[39m
                [36m>[39m
                  [0mMeses[0m
                [36m</option>[39m
              [36m</select>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"bg-sky-50 p-4 rounded-lg mb-6 border border-sky-200 text-sm text-sky-700"[39m
          [36m>[39m
            [36m<h4[39m
              [33mclass[39m=[32m"font-semibold text-sky-800 mb-2 flex items-center"[39m
            [36m>[39m
              [36m<span[39m
                [33mclass[39m=[32m"text-lg mr-2"[39m
              [36m>[39m
                [0m💡[0m
              [36m</span>[39m
              [0m Como Funciona o Modo Adaptativo:[0m
            [36m</h4>[39m
            [36m<ul[39m
              [33mclass[39m=[32m"list-disc list-inside space-y-1 pl-2"[39m
            [36m>[39m
              [36m<li>[39m
                [0mPreencha os **Dados Principais / Drivers** para que o sistema calcule automaticamente as demonstrações.[0m
              [36m</li>[39m
              [36m<li>[39m
                [0mSe possuir valores reais para itens específicos da DRE, Balanço ou Fluxo de Caixa, expanda as seções de **Overrides Opcionais** e insira esses valores.[0m
              [36m</li>[39m
              [36m<li>[39m
                [0mValores inseridos nos campos de **Override (🔧)** terão prioridade sobre os cálculos automáticos do sistema para aquele item específico.[0m
              [36m</li>[39m
              [36m<li>[39m
                [0mA "Diferença de Balanço" e as "Validações de Dados" ajudarão a identificar possíveis inconsistências.[0m
              [36m</li>[39m
            [36m</ul>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mb-6 "[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-semibold text-slate-700 mb-4"[39m
            [36m>[39m
              [0m📋 Dados Principais / Drivers Essenciais[0m
            [36m</h3>[39m
            [36m<div[39m
              [33mclass[39m=[32m"overflow-x-auto border border-slate-300 rounded-lg mt-2 animation-fade-in"[39m
            [36m>[39m
              [36m<table[39m
                [33mclass[39m=[32m"min-w-full border-collapse"[39m
              [36m>[39m
                [36m<thead>[39m
                  [36m<tr[39m
                    [33mclass[39m=[32m"bg-slate-100"[39m
                  [36m>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-left text-sm font-semibold text-slate-700 sticky left-0 bg-slate-100 z-10 min-w-[250px] md:min-w-[300px]"[39m
                    [36m>[39m
                      [0mItem Financeiro[0m
                    [36m</th>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-center text-sm font-semibold text-slate-700 min-w-[120px]"[39m
                    [36m>[39m
                      [0mPeríodo [0m
                      [0m1[0m
                      [36m<span[39m
                        [33mclass[39m=[32m"font-normal text-xs block"[39m
                      [36m>[39m
                        [0m([0m
                        [0mMONTHLY[0m
                        [0m)[0m
                      [36m</span>[39m
                    [36m</th>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-center text-sm font-semibold text-slate-700 min-w-[120px]"[39m
                    [36m>[39m
                      [0mPeríodo [0m
                      [0m2[0m
                      [36m<span[39m
                        [33mclass[39m=[32m"font-normal text-xs block"[39m
                      [36m>[39m
                        [0m([0m
                        [0mMONTHLY[0m
                        [0m)[0m
                      [36m</span>[39m
                    [36m</th>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-center text-sm font-semibold text-slate-700 min-w-[120px]"[39m
                   ...

      108 |       
      109 |       expect(screen.getByText('Processando...')).toBeInTheDocument();
    > 110 |       expect(screen.getByRole('button')).toBeDisabled();
          |                     ^
      111 |     });
      112 |   });
      113 |

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:20:35)
      at getMultipleElementsFoundError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:23:10)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:55:13
      at getByRole (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19)
      at Object.<anonymous> (src/components/__tests__/ManualDataEntry.test.js:110:21)

  ● ManualDataEntry Component › Override sections › should render override sections as collapsed by default

    TestingLibraryElementError: Found multiple elements with the text: /Fluxo de Caixa/

    Here are the matching elements:

    Ignored nodes: comments, script, style
    [36m<li>[39m
      [0mSe possuir valores reais para itens específicos da DRE, Balanço ou Fluxo de Caixa, expanda as seções de **Overrides Opcionais** e insira esses valores.[0m
    [36m</li>[39m

    Ignored nodes: comments, script, style
    [36m<span[39m
      [33mclass[39m=[32m"text-lg font-medium text-sky-700"[39m
    [36m>[39m
      [0m🔧 Fluxo de Caixa (Overrides Opcionais)[0m
    [36m</span>[39m

    (If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<section[39m
          [33mclass[39m=[32m"mb-8 p-6 bg-white rounded-xl shadow-lg border border-slate-200"[39m
        [36m>[39m
          [36m<h2[39m
            [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
          [36m>[39m
            [0mEntrada Manual de Dados - Modo Adaptativo[0m
          [36m</h2>[39m
          [36m<div[39m
            [33mclass[39m=[32m"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"[39m
          [36m>[39m
            [36m<div>[39m
              [36m<label[39m
                [33mclass[39m=[32m"block text-sm font-medium text-slate-700 mb-1"[39m
                [33mfor[39m=[32m"numberOfPeriodsEntry"[39m
              [36m>[39m
                [0mNúmero de Períodos ([0m
                [0m2[0m
                [0m-[0m
                [0m6[0m
                [0m):[0m
              [36m</label>[39m
              [36m<select[39m
                [33mclass[39m=[32m"w-full p-2.5 border border-slate-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"[39m
                [33mid[39m=[32m"numberOfPeriodsEntry"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"2"[39m
                [36m>[39m
                  [0m2[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"3"[39m
                [36m>[39m
                  [0m3[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"4"[39m
                [36m>[39m
                  [0m4[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"5"[39m
                [36m>[39m
                  [0m5[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"6"[39m
                [36m>[39m
                  [0m6[0m
                  [0m Períodos[0m
                [36m</option>[39m
              [36m</select>[39m
            [36m</div>[39m
            [36m<div>[39m
              [36m<label[39m
                [33mclass[39m=[32m"block text-sm font-medium text-slate-700 mb-1"[39m
                [33mfor[39m=[32m"periodTypeEntry"[39m
              [36m>[39m
                [0mTipo de Período:[0m
              [36m</label>[39m
              [36m<select[39m
                [33mclass[39m=[32m"w-full p-2.5 border border-slate-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"[39m
                [33mid[39m=[32m"periodTypeEntry"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"anos"[39m
                [36m>[39m
                  [0mAnos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"trimestres"[39m
                [36m>[39m
                  [0mTrimestres[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"meses"[39m
                [36m>[39m
                  [0mMeses[0m
                [36m</option>[39m
              [36m</select>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"bg-sky-50 p-4 rounded-lg mb-6 border border-sky-200 text-sm text-sky-700"[39m
          [36m>[39m
            [36m<h4[39m
              [33mclass[39m=[32m"font-semibold text-sky-800 mb-2 flex items-center"[39m
            [36m>[39m
              [36m<span[39m
                [33mclass[39m=[32m"text-lg mr-2"[39m
              [36m>[39m
                [0m💡[0m
              [36m</span>[39m
              [0m Como Funciona o Modo Adaptativo:[0m
            [36m</h4>[39m
            [36m<ul[39m
              [33mclass[39m=[32m"list-disc list-inside space-y-1 pl-2"[39m
            [36m>[39m
              [36m<li>[39m
                [0mPreencha os **Dados Principais / Drivers** para que o sistema calcule automaticamente as demonstrações.[0m
              [36m</li>[39m
              [36m<li>[39m
                [0mSe possuir valores reais para itens específicos da DRE, Balanço ou Fluxo de Caixa, expanda as seções de **Overrides Opcionais** e insira esses valores.[0m
              [36m</li>[39m
              [36m<li>[39m
                [0mValores inseridos nos campos de **Override (🔧)** terão prioridade sobre os cálculos automáticos do sistema para aquele item específico.[0m
              [36m</li>[39m
              [36m<li>[39m
                [0mA "Diferença de Balanço" e as "Validações de Dados" ajudarão a identificar possíveis inconsistências.[0m
              [36m</li>[39m
            [36m</ul>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mb-6 "[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-semibold text-slate-700 mb-4"[39m
            [36m>[39m
              [0m📋 Dados Principais / Drivers Essenciais[0m
            [36m</h3>[39m
            [36m<div[39m
              [33mclass[39m=[32m"overflow-x-auto border border-slate-300 rounded-lg mt-2 animation-fade-in"[39m
            [36m>[39m
              [36m<table[39m
                [33mclass[39m=[32m"min-w-full border-collapse"[39m
              [36m>[39m
                [36m<thead>[39m
                  [36m<tr[39m
                    [33mclass[39m=[32m"bg-slate-100"[39m
                  [36m>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-left text-sm font-semibold text-slate-700 sticky left-0 bg-slate-100 z-10 min-w-[250px] md:min-w-[300px]"[39m
                    [36m>[39m
                      [0mItem Financeiro[0m
                    [36m</th>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-center text-sm font-semibold text-slate-700 min-w-[120px]"[39m
                    [36m>[39m
                      [0mPeríodo [0m
                      [0m1[0m
                      [36m<span[39m
                        [33mclass[39m=[32m"font-normal text-xs block"[39m
                      [36m>[39m
                        [0m([0m
                        [0mMONTHLY[0m
                        [0m)[0m
                      [36m</span>[39m
                    [36m</th>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-center text-sm font-semibold text-slate-700 min-w-[120px]"[39m
                    [36m>[39m
                      [0mPeríodo [0m
                      [0m2[0m
                      [36m<span[39m
                        [33mclass[39m=[32m"font-normal text-xs block"[39m
                      [36m>[39m
                        [0m([0m
                        [0mMONTHLY[0m
                        [0m)[0m
                      [36m</span>[39m
                    [36m</th>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-center text-sm font-semibold text-slate-700 min-w-[120px]"[39m
                   ...

      118 |       expect(screen.getByText(/DRE - Itens de Resultado/)).toBeInTheDocument();
      119 |       expect(screen.getByText(/Balanço Patrimonial/)).toBeInTheDocument();
    > 120 |       expect(screen.getByText(/Fluxo de Caixa/)).toBeInTheDocument();
          |                     ^
      121 |     });
      122 |
      123 |     it('should expand override sections when clicked', async () => {

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:20:35)
      at getMultipleElementsFoundError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:23:10)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:55:13
      at getByText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19)
      at Object.<anonymous> (src/components/__tests__/ManualDataEntry.test.js:120:21)

  ● ManualDataEntry Component › Override sections › should expand override sections when clicked

    TestingLibraryElementError: Found multiple elements with the text: /Override/

    Here are the matching elements:

    Ignored nodes: comments, script, style
    [36m<li>[39m
      [0mSe possuir valores reais para itens específicos da DRE, Balanço ou Fluxo de Caixa, expanda as seções de **Overrides Opcionais** e insira esses valores.[0m
    [36m</li>[39m

    Ignored nodes: comments, script, style
    [36m<li>[39m
      [0mValores inseridos nos campos de **Override (🔧)** terão prioridade sobre os cálculos automáticos do sistema para aquele item específico.[0m
    [36m</li>[39m

    Ignored nodes: comments, script, style
    [36m<span[39m
      [33mclass[39m=[32m"text-lg font-medium text-sky-700"[39m
    [36m>[39m
      [0m🔧 DRE - Itens de Resultado (Overrides Opcionais)[0m
    [36m</span>[39m

    Ignored nodes: comments, script, style
    [36m<th[39m
      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-left text-sm font-semibold text-slate-700 sticky left-0 bg-slate-100 z-10 min-w-[250px] md:min-w-[300px]"[39m
    [36m>[39m
      [0m🔧 Item Financeiro (Override)[0m
    [36m</th>[39m

    Ignored nodes: comments, script, style
    [36m<div[39m
      [33mclass[39m=[32m"font-medium"[39m
    [36m>[39m
      [0m🔧 CPV/CSV (Override)[0m
    [36m</div>[39m

    Ignored nodes: comments, script, style
    [36m<div[39m
      [33mclass[39m=[32m"font-medium"[39m
    [36m>[39m
      [0m🔧 Lucro Bruto (Override)[0m
    [36m</div>[39m

    Ignored nodes: comments, script, style
    [36m<div[39m
      [33mclass[39m=[32m"font-medium"[39m
    [36m>[39m
      [0m🔧 EBITDA (Override)[0m
    [36m</div>[39m

    Ignored nodes: comments, script, style
    [36m<div[39m
      [33mclass[39m=[32m"font-medium"[39m
    [36m>[39m
      [0m🔧 EBIT (Override)[0m
    [36m</div>[39m

    Ignored nodes: comments, script, style
    [36m<div[39m
      [33mclass[39m=[32m"font-medium"[39m
    [36m>[39m
      [0m🔧 LAIR/PBT (Override)[0m
    [36m</div>[39m

    Ignored nodes: comments, script, style
    [36m<div[39m
      [33mclass[39m=[32m"font-medium"[39m
    [36m>[39m
      [0m🔧 Imposto de Renda (Override)[0m
    [36m</div>[39m

    Ignored nodes: comments, script, style
    [36m<div[39m
      [33mclass[39m=[32m"font-medium"[39m
    [36m>[39m
      [0m🔧 Lucro Líquido (Override)[0m
    [36m</div>[39m

    Ignored nodes: comments, script, style
    [36m<span[39m
      [33mclass[39m=[32m"text-lg font-medium text-sky-700"[39m
    [36m>[39m
      [0m🔧 Balanço Patrimonial (Overrides Opcionais)[0m
    [36m</span>[39m

    Ignored nodes: comments, script, style
    [36m<span[39m
      [33mclass[39m=[32m"text-lg font-medium text-sky-700"[39m
    [36m>[39m
      [0m🔧 Fluxo de Caixa (Overrides Opcionais)[0m
    [36m</span>[39m

    (If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<section[39m
          [33mclass[39m=[32m"mb-8 p-6 bg-white rounded-xl shadow-lg border border-slate-200"[39m
        [36m>[39m
          [36m<h2[39m
            [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
          [36m>[39m
            [0mEntrada Manual de Dados - Modo Adaptativo[0m
          [36m</h2>[39m
          [36m<div[39m
            [33mclass[39m=[32m"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"[39m
          [36m>[39m
            [36m<div>[39m
              [36m<label[39m
                [33mclass[39m=[32m"block text-sm font-medium text-slate-700 mb-1"[39m
                [33mfor[39m=[32m"numberOfPeriodsEntry"[39m
              [36m>[39m
                [0mNúmero de Períodos ([0m
                [0m2[0m
                [0m-[0m
                [0m6[0m
                [0m):[0m
              [36m</label>[39m
              [36m<select[39m
                [33mclass[39m=[32m"w-full p-2.5 border border-slate-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"[39m
                [33mid[39m=[32m"numberOfPeriodsEntry"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"2"[39m
                [36m>[39m
                  [0m2[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"3"[39m
                [36m>[39m
                  [0m3[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"4"[39m
                [36m>[39m
                  [0m4[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"5"[39m
                [36m>[39m
                  [0m5[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"6"[39m
                [36m>[39m
                  [0m6[0m
                  [0m Períodos[0m
                [36m</option>[39m
              [36m</select>[39m
            [36m</div>[39m
            [36m<div>[39m
              [36m<label[39m
                [33mclass[39m=[32m"block text-sm font-medium text-slate-700 mb-1"[39m
                [33mfor[39m=[32m"periodTypeEntry"[39m
              [36m>[39m
                [0mTipo de Período:[0m
              [36m</label>[39m
              [36m<select[39m
                [33mclass[39m=[32m"w-full p-2.5 border border-slate-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"[39m
                [33mid[39m=[32m"periodTypeEntry"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"anos"[39m
                [36m>[39m
                  [0mAnos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"trimestres"[39m
                [36m>[39m
                  [0mTrimestres[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"meses"[39m
                [36m>[39m
                  [0mMeses[0m
                [36m</option>[39m
              [36m</select>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"bg-sky-50 p-4 rounded-lg mb-6 border border-sky-200 text-sm text-sky-700"[39m
          [36m>[39m
            [36m<h4[39m
              [33mclass[39m=[32m"font-semibold text-sky-800 mb-2 flex items-center"[39m
            [36m>[39m
              [36m<span[39m
                [33mclass[39m=[32m"text-lg mr-2"[39m
              [36m>[39m
                [0m💡[0m
              [36m</span>[39m
              [0m Como Funciona o Modo Adaptativo:[0m
            [36m</h4>[39m
            [36m<ul[39m
              [33mclass[39m=[32m"list-disc list-inside space-y-1 pl-2"[39m
            [36m>[39m
              [36m<li>[39m
                [0mPreencha os **Dados Principais / Drivers** para que o sistema calcule automaticamente as demonstrações.[0m
              [36m</li>[39m
              [36m<li>[39m
                [0mSe possuir valores reais para itens específicos da DRE, Balanço ou Fluxo de Caixa, expanda as seções de **Overrides Opcionais** e insira esses valores.[0m
              [36m</li>[39m
              [36m<li>[39m
                [0mValores inseridos nos campos de **Override (🔧)** terão prioridade sobre os cálculos automáticos do sistema para aquele item específico.[0m
              [36m</li>[39m
              [36m<li>[39m
                [0mA "Diferença de Balanço" e as "Validações de Dados" ajudarão a identificar possíveis inconsistências.[0m
              [36m</li>[39m
            [36m</ul>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mb-6 "[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-semibold text-slate-700 mb-4"[39m
            [36m>[39m
              [0m📋 Dados Principais / Drivers Essenciais[0m
            [36m</h3>[39m
            [36m<div[39m
              [33mclass[39m=[32m"overflow-x-auto border border-slate-300 rounded-lg mt-2 animation-fade-in"[39m
            [36m>[39m
              [36m<table[39m
                [33mclass[39m=[32m"min-w-full border-collapse"[39m
              [36m>[39m
                [36m<thead>[39m
                  [36m<tr[39m
                    [33mclass[39m=[32m"bg-slate-100"[39m
                  [36m>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-left text-sm font-semibold text-slate-700 sticky left-0 bg-slate-100 z-10 min-w-[250px] md:min-w-[300px]"[39m
                    [36m>[39m
                      [0mItem Financeiro[0m
                    [36m</th>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-center text-sm font-semibold text-slate-700 min-w-[120px]"[39m
                    [36m>[39m
                      [0mPeríodo [0m
                      [0m1[0m
                      [36m<span[39m
                        [33mclass[39m=[32m"font-normal text-xs block"[39m
                      [36m>[39m
                        [0m([0m
                        [0mMONTHLY[0m
                        [0m)[0m
                      [36m</span>[39m
                    [36m</th>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-center text-sm font-semibold text-slate-700 min-w-[120px]"[39m
                    [36m>[39m
                      [0mPeríodo [0m
                      [0m2[0m
                      [36m<span[39m
                        [33mclass[39m=[32m"font-normal text-xs block"[39m
                      [36m>[39m
                        [0m([0m
                        [0mMONTHLY[0m
                        [0m)[0m
                      [36m</span>[39m
                    [36m</th>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-center text-sm font-semibold text-slate-700 min-w-[120px]"[39m
                   ...

      129 |       
      130 |       // Section should expand and show additional content
    > 131 |       expect(screen.getByText(/Override/)).toBeInTheDocument();
          |                     ^
      132 |     });
      133 |   });
      134 | });

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:20:35)
      at getMultipleElementsFoundError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:23:10)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:55:13
      at getByText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19)
      at Object.<anonymous> (src/components/__tests__/ManualDataEntry.test.js:131:21)

FAIL src/components/__tests__/Charts.test.js
  ● Test suite failed to run

    Cannot find module '../Charts' from 'src/components/__tests__/Charts.test.js'

       7 | import { render, screen, fireEvent, waitFor } from '@testing-library/react';
       8 | import userEvent from '@testing-library/user-event';
    >  9 | import { 
         | ^
      10 |   CashFlowWaterfallChart,
      11 |   ProfitWaterfallChart,
      12 |   FundingStructureChart,

      at Resolver.resolveModule (node_modules/jest-resolve/build/resolver.js:324:11)
      at Object.<anonymous> (src/components/__tests__/Charts.test.js:9:1)

  console.error
    Warning: `ReactDOMTestUtils.act` is deprecated in favor of `React.act`. Import `act` from `react` instead of `react-dom/test-utils`. See https://react.dev/warnings/react-dom-test-utils for more info.

      120 |   describe('Grid System Integration', () => {
      121 |     test('Grid renders with responsive breakpoints', () => {
    > 122 |       render(
          |             ^
      123 |         <Grid container spacing={4}>
      124 |           <Grid item xs={12} md={6}>
      125 |             <div data-testid="grid-item-1">Content 1</div>

      at printWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:71:30)
      at error (node_modules/react-dom/cjs/react-dom-test-utils.development.js:45:7)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1736:7)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/__tests__/integration/phase2-components.integration.test.js:122:13)

  console.error
    Error: Uncaught [Error: useStorage must be used within StorageProvider]
        at reportException (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
        at innerInvokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:341:9)
        at invokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
        at HTMLUnknownElementImpl._dispatch (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
        at HTMLUnknownElementImpl.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
        at HTMLUnknownElement.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
        at Object.invokeGuardedCallbackDev (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
        at invokeGuardedCallback (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
        at beginWork$1 (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
        at performUnitOfWork (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26599:12)
        at workLoopSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26505:5)
        at renderRootSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26473:7)
        at performConcurrentWorkOnRoot (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:25777:74)
        at flushActQueue (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2667:24)
        at act (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2582:11)
        at actWithWarning (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
        at /home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/act-compat.js:63:25
        at renderRoot (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:159:26)
        at render (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:246:10)
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/__tests__/integration/phase2-components.integration.test.js:327:13)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12) Error: useStorage must be used within StorageProvider
        at useStorage (/home/user/EnterpriseCashFlow/src/context/StorageContext.jsx:19:11)
        at ReportGeneratorApp (/home/user/EnterpriseCashFlow/src/components/ReportGeneratorApp.jsx:120:92)
        at renderWithHooks (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
        at mountIndeterminateComponent (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
        at beginWork (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
        at HTMLUnknownElement.callCallback (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
        at HTMLUnknownElement.callTheUserObjectsOperation (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
        at innerInvokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:338:25)
        at invokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
        at HTMLUnknownElementImpl._dispatch (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
        at HTMLUnknownElementImpl.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
        at HTMLUnknownElement.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
        at Object.invokeGuardedCallbackDev (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
        at invokeGuardedCallback (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
        at beginWork$1 (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
        at performUnitOfWork (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26599:12)
        at workLoopSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26505:5)
        at renderRootSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26473:7)
        at performConcurrentWorkOnRoot (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:25777:74)
        at flushActQueue (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2667:24)
        at act (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2582:11)
        at actWithWarning (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
        at /home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/act-compat.js:63:25
        at renderRoot (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:159:26)
        at render (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:246:10)
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/__tests__/integration/phase2-components.integration.test.js:327:13)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12)

      325 |   describe('ReportGeneratorApp Integration', () => {
      326 |     test('App renders without crashing', () => {
    > 327 |       render(<ReportGeneratorApp />);
          |             ^
      328 |       
      329 |       expect(screen.getByText('Auditor Financeiro com IA ✨')).toBeInTheDocument();
      330 |       expect(screen.getByText('Entrada Manual de Dados')).toBeInTheDocument();

      at VirtualConsole.<anonymous> (node_modules/jsdom/lib/jsdom/virtual-console.js:29:45)
      at reportException (node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:70:28)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:341:9)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
      at HTMLUnknownElementImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
      at HTMLUnknownElementImpl.dispatchEvent (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
      at HTMLUnknownElement.dispatchEvent (node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
      at Object.invokeGuardedCallbackDev (node_modules/react-dom/cjs/react-dom.development.js:4213:16)
      at invokeGuardedCallback (node_modules/react-dom/cjs/react-dom.development.js:4277:31)
      at beginWork$1 (node_modules/react-dom/cjs/react-dom.development.js:27490:7)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26599:12)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26505:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26473:7)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25777:74)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/__tests__/integration/phase2-components.integration.test.js:327:13)

  console.error
    Error: Uncaught [Error: useStorage must be used within StorageProvider]
        at reportException (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
        at innerInvokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:341:9)
        at invokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
        at HTMLUnknownElementImpl._dispatch (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
        at HTMLUnknownElementImpl.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
        at HTMLUnknownElement.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
        at Object.invokeGuardedCallbackDev (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
        at invokeGuardedCallback (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
        at beginWork$1 (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
        at performUnitOfWork (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26599:12)
        at workLoopSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26505:5)
        at renderRootSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26473:7)
        at recoverFromConcurrentError (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:25889:20)
        at performConcurrentWorkOnRoot (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:25789:22)
        at flushActQueue (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2667:24)
        at act (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2582:11)
        at actWithWarning (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
        at /home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/act-compat.js:63:25
        at renderRoot (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:159:26)
        at render (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:246:10)
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/__tests__/integration/phase2-components.integration.test.js:327:13)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12) Error: useStorage must be used within StorageProvider
        at useStorage (/home/user/EnterpriseCashFlow/src/context/StorageContext.jsx:19:11)
        at ReportGeneratorApp (/home/user/EnterpriseCashFlow/src/components/ReportGeneratorApp.jsx:120:92)
        at renderWithHooks (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
        at mountIndeterminateComponent (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
        at beginWork (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
        at HTMLUnknownElement.callCallback (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
        at HTMLUnknownElement.callTheUserObjectsOperation (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
        at innerInvokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:338:25)
        at invokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
        at HTMLUnknownElementImpl._dispatch (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
        at HTMLUnknownElementImpl.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
        at HTMLUnknownElement.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
        at Object.invokeGuardedCallbackDev (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
        at invokeGuardedCallback (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
        at beginWork$1 (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
        at performUnitOfWork (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26599:12)
        at workLoopSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26505:5)
        at renderRootSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26473:7)
        at recoverFromConcurrentError (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:25889:20)
        at performConcurrentWorkOnRoot (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:25789:22)
        at flushActQueue (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2667:24)
        at act (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2582:11)
        at actWithWarning (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
        at /home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/act-compat.js:63:25
        at renderRoot (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:159:26)
        at render (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:246:10)
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/__tests__/integration/phase2-components.integration.test.js:327:13)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12)

      325 |   describe('ReportGeneratorApp Integration', () => {
      326 |     test('App renders without crashing', () => {
    > 327 |       render(<ReportGeneratorApp />);
          |             ^
      328 |       
      329 |       expect(screen.getByText('Auditor Financeiro com IA ✨')).toBeInTheDocument();
      330 |       expect(screen.getByText('Entrada Manual de Dados')).toBeInTheDocument();

      at VirtualConsole.<anonymous> (node_modules/jsdom/lib/jsdom/virtual-console.js:29:45)
      at reportException (node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:70:28)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:341:9)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
      at HTMLUnknownElementImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
      at HTMLUnknownElementImpl.dispatchEvent (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
      at HTMLUnknownElement.dispatchEvent (node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
      at Object.invokeGuardedCallbackDev (node_modules/react-dom/cjs/react-dom.development.js:4213:16)
      at invokeGuardedCallback (node_modules/react-dom/cjs/react-dom.development.js:4277:31)
      at beginWork$1 (node_modules/react-dom/cjs/react-dom.development.js:27490:7)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26599:12)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26505:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26473:7)
      at recoverFromConcurrentError (node_modules/react-dom/cjs/react-dom.development.js:25889:20)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25789:22)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/__tests__/integration/phase2-components.integration.test.js:327:13)

  console.error
    The above error occurred in the <ReportGeneratorApp> component:
    
        at ReportGeneratorApp (/home/user/EnterpriseCashFlow/src/components/ReportGeneratorApp.jsx:32:49)
    
    Consider adding an error boundary to your tree to customize error handling behavior.
    Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

      325 |   describe('ReportGeneratorApp Integration', () => {
      326 |     test('App renders without crashing', () => {
    > 327 |       render(<ReportGeneratorApp />);
          |             ^
      328 |       
      329 |       expect(screen.getByText('Auditor Financeiro com IA ✨')).toBeInTheDocument();
      330 |       expect(screen.getByText('Entrada Manual de Dados')).toBeInTheDocument();

      at logCapturedError (node_modules/react-dom/cjs/react-dom.development.js:18704:23)
      at update.callback (node_modules/react-dom/cjs/react-dom.development.js:18737:5)
      at callCallback (node_modules/react-dom/cjs/react-dom.development.js:15036:12)
      at commitUpdateQueue (node_modules/react-dom/cjs/react-dom.development.js:15057:9)
      at commitLayoutEffectOnFiber (node_modules/react-dom/cjs/react-dom.development.js:23430:13)
      at commitLayoutMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24727:9)
      at commitLayoutEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24713:7)
      at commitLayoutEffects (node_modules/react-dom/cjs/react-dom.development.js:24651:3)
      at commitRootImpl (node_modules/react-dom/cjs/react-dom.development.js:26862:5)
      at commitRoot (node_modules/react-dom/cjs/react-dom.development.js:26721:5)
      at finishConcurrentRender (node_modules/react-dom/cjs/react-dom.development.js:25931:9)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25848:7)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/__tests__/integration/phase2-components.integration.test.js:327:13)

  console.error
    Error: Uncaught [Error: useStorage must be used within StorageProvider]
        at reportException (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
        at innerInvokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:341:9)
        at invokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
        at HTMLUnknownElementImpl._dispatch (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
        at HTMLUnknownElementImpl.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
        at HTMLUnknownElement.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
        at Object.invokeGuardedCallbackDev (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
        at invokeGuardedCallback (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
        at beginWork$1 (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
        at performUnitOfWork (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26599:12)
        at workLoopSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26505:5)
        at renderRootSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26473:7)
        at performConcurrentWorkOnRoot (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:25777:74)
        at flushActQueue (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2667:24)
        at act (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2582:11)
        at actWithWarning (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
        at /home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/act-compat.js:63:25
        at renderRoot (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:159:26)
        at render (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:246:10)
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/__tests__/integration/phase2-components.integration.test.js:334:13)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12) Error: useStorage must be used within StorageProvider
        at useStorage (/home/user/EnterpriseCashFlow/src/context/StorageContext.jsx:19:11)
        at ReportGeneratorApp (/home/user/EnterpriseCashFlow/src/components/ReportGeneratorApp.jsx:120:92)
        at renderWithHooks (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
        at mountIndeterminateComponent (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
        at beginWork (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
        at HTMLUnknownElement.callCallback (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
        at HTMLUnknownElement.callTheUserObjectsOperation (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
        at innerInvokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:338:25)
        at invokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
        at HTMLUnknownElementImpl._dispatch (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
        at HTMLUnknownElementImpl.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
        at HTMLUnknownElement.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
        at Object.invokeGuardedCallbackDev (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
        at invokeGuardedCallback (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
        at beginWork$1 (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
        at performUnitOfWork (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26599:12)
        at workLoopSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26505:5)
        at renderRootSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26473:7)
        at performConcurrentWorkOnRoot (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:25777:74)
        at flushActQueue (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2667:24)
        at act (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2582:11)
        at actWithWarning (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
        at /home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/act-compat.js:63:25
        at renderRoot (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:159:26)
        at render (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:246:10)
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/__tests__/integration/phase2-components.integration.test.js:334:13)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12)

      332 |
      333 |     test('App switches between input methods correctly', () => {
    > 334 |       render(<ReportGeneratorApp />);
          |             ^
      335 |       
      336 |       // Test manual input method (default)
      337 |       expect(screen.getByText('Entrada Manual de Dados - Modo Adaptativo')).toBeInTheDocument();

      at VirtualConsole.<anonymous> (node_modules/jsdom/lib/jsdom/virtual-console.js:29:45)
      at reportException (node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:70:28)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:341:9)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
      at HTMLUnknownElementImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
      at HTMLUnknownElementImpl.dispatchEvent (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
      at HTMLUnknownElement.dispatchEvent (node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
      at Object.invokeGuardedCallbackDev (node_modules/react-dom/cjs/react-dom.development.js:4213:16)
      at invokeGuardedCallback (node_modules/react-dom/cjs/react-dom.development.js:4277:31)
      at beginWork$1 (node_modules/react-dom/cjs/react-dom.development.js:27490:7)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26599:12)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26505:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26473:7)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25777:74)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/__tests__/integration/phase2-components.integration.test.js:334:13)

  console.error
    Error: Uncaught [Error: useStorage must be used within StorageProvider]
        at reportException (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
        at innerInvokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:341:9)
        at invokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
        at HTMLUnknownElementImpl._dispatch (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
        at HTMLUnknownElementImpl.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
        at HTMLUnknownElement.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
        at Object.invokeGuardedCallbackDev (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
        at invokeGuardedCallback (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
        at beginWork$1 (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
        at performUnitOfWork (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26599:12)
        at workLoopSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26505:5)
        at renderRootSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26473:7)
        at recoverFromConcurrentError (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:25889:20)
        at performConcurrentWorkOnRoot (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:25789:22)
        at flushActQueue (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2667:24)
        at act (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2582:11)
        at actWithWarning (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
        at /home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/act-compat.js:63:25
        at renderRoot (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:159:26)
        at render (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:246:10)
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/__tests__/integration/phase2-components.integration.test.js:334:13)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12) Error: useStorage must be used within StorageProvider
        at useStorage (/home/user/EnterpriseCashFlow/src/context/StorageContext.jsx:19:11)
        at ReportGeneratorApp (/home/user/EnterpriseCashFlow/src/components/ReportGeneratorApp.jsx:120:92)
        at renderWithHooks (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
        at mountIndeterminateComponent (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
        at beginWork (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
        at HTMLUnknownElement.callCallback (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
        at HTMLUnknownElement.callTheUserObjectsOperation (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
        at innerInvokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:338:25)
        at invokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
        at HTMLUnknownElementImpl._dispatch (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
        at HTMLUnknownElementImpl.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
        at HTMLUnknownElement.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
        at Object.invokeGuardedCallbackDev (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
        at invokeGuardedCallback (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
        at beginWork$1 (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
        at performUnitOfWork (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26599:12)
        at workLoopSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26505:5)
        at renderRootSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26473:7)
        at recoverFromConcurrentError (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:25889:20)
        at performConcurrentWorkOnRoot (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:25789:22)
        at flushActQueue (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2667:24)
        at act (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2582:11)
        at actWithWarning (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
        at /home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/act-compat.js:63:25
        at renderRoot (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:159:26)
        at render (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:246:10)
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/__tests__/integration/phase2-components.integration.test.js:334:13)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12)

      332 |
      333 |     test('App switches between input methods correctly', () => {
    > 334 |       render(<ReportGeneratorApp />);
          |             ^
      335 |       
      336 |       // Test manual input method (default)
      337 |       expect(screen.getByText('Entrada Manual de Dados - Modo Adaptativo')).toBeInTheDocument();

      at VirtualConsole.<anonymous> (node_modules/jsdom/lib/jsdom/virtual-console.js:29:45)
      at reportException (node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:70:28)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:341:9)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
      at HTMLUnknownElementImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
      at HTMLUnknownElementImpl.dispatchEvent (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
      at HTMLUnknownElement.dispatchEvent (node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
      at Object.invokeGuardedCallbackDev (node_modules/react-dom/cjs/react-dom.development.js:4213:16)
      at invokeGuardedCallback (node_modules/react-dom/cjs/react-dom.development.js:4277:31)
      at beginWork$1 (node_modules/react-dom/cjs/react-dom.development.js:27490:7)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26599:12)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26505:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26473:7)
      at recoverFromConcurrentError (node_modules/react-dom/cjs/react-dom.development.js:25889:20)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25789:22)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/__tests__/integration/phase2-components.integration.test.js:334:13)

  console.error
    The above error occurred in the <ReportGeneratorApp> component:
    
        at ReportGeneratorApp (/home/user/EnterpriseCashFlow/src/components/ReportGeneratorApp.jsx:32:49)
    
    Consider adding an error boundary to your tree to customize error handling behavior.
    Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

      332 |
      333 |     test('App switches between input methods correctly', () => {
    > 334 |       render(<ReportGeneratorApp />);
          |             ^
      335 |       
      336 |       // Test manual input method (default)
      337 |       expect(screen.getByText('Entrada Manual de Dados - Modo Adaptativo')).toBeInTheDocument();

      at logCapturedError (node_modules/react-dom/cjs/react-dom.development.js:18704:23)
      at update.callback (node_modules/react-dom/cjs/react-dom.development.js:18737:5)
      at callCallback (node_modules/react-dom/cjs/react-dom.development.js:15036:12)
      at commitUpdateQueue (node_modules/react-dom/cjs/react-dom.development.js:15057:9)
      at commitLayoutEffectOnFiber (node_modules/react-dom/cjs/react-dom.development.js:23430:13)
      at commitLayoutMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24727:9)
      at commitLayoutEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24713:7)
      at commitLayoutEffects (node_modules/react-dom/cjs/react-dom.development.js:24651:3)
      at commitRootImpl (node_modules/react-dom/cjs/react-dom.development.js:26862:5)
      at commitRoot (node_modules/react-dom/cjs/react-dom.development.js:26721:5)
      at finishConcurrentRender (node_modules/react-dom/cjs/react-dom.development.js:25931:9)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25848:7)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/__tests__/integration/phase2-components.integration.test.js:334:13)

  console.error
    Error: Uncaught [Error: useStorage must be used within StorageProvider]
        at reportException (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
        at innerInvokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:341:9)
        at invokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
        at HTMLUnknownElementImpl._dispatch (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
        at HTMLUnknownElementImpl.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
        at HTMLUnknownElement.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
        at Object.invokeGuardedCallbackDev (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
        at invokeGuardedCallback (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
        at beginWork$1 (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
        at performUnitOfWork (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26599:12)
        at workLoopSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26505:5)
        at renderRootSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26473:7)
        at performConcurrentWorkOnRoot (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:25777:74)
        at flushActQueue (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2667:24)
        at act (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2582:11)
        at actWithWarning (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
        at /home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/act-compat.js:63:25
        at renderRoot (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:159:26)
        at render (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:246:10)
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/__tests__/integration/phase2-components.integration.test.js:349:13)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12) Error: useStorage must be used within StorageProvider
        at useStorage (/home/user/EnterpriseCashFlow/src/context/StorageContext.jsx:19:11)
        at ReportGeneratorApp (/home/user/EnterpriseCashFlow/src/components/ReportGeneratorApp.jsx:120:92)
        at renderWithHooks (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
        at mountIndeterminateComponent (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
        at beginWork (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
        at HTMLUnknownElement.callCallback (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
        at HTMLUnknownElement.callTheUserObjectsOperation (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
        at innerInvokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:338:25)
        at invokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
        at HTMLUnknownElementImpl._dispatch (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
        at HTMLUnknownElementImpl.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
        at HTMLUnknownElement.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
        at Object.invokeGuardedCallbackDev (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
        at invokeGuardedCallback (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
        at beginWork$1 (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
        at performUnitOfWork (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26599:12)
        at workLoopSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26505:5)
        at renderRootSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26473:7)
        at performConcurrentWorkOnRoot (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:25777:74)
        at flushActQueue (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2667:24)
        at act (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2582:11)
        at actWithWarning (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
        at /home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/act-compat.js:63:25
        at renderRoot (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:159:26)
        at render (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:246:10)
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/__tests__/integration/phase2-components.integration.test.js:349:13)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12)

      347 |
      348 |     test('App maintains state consistency across method switches', () => {
    > 349 |       render(<ReportGeneratorApp />);
          |             ^
      350 |       
      351 |       // Set company name
      352 |       const companyInput = screen.getByDisplayValue('Empresa Exemplo S.A.');

      at VirtualConsole.<anonymous> (node_modules/jsdom/lib/jsdom/virtual-console.js:29:45)
      at reportException (node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:70:28)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:341:9)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
      at HTMLUnknownElementImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
      at HTMLUnknownElementImpl.dispatchEvent (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
      at HTMLUnknownElement.dispatchEvent (node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
      at Object.invokeGuardedCallbackDev (node_modules/react-dom/cjs/react-dom.development.js:4213:16)
      at invokeGuardedCallback (node_modules/react-dom/cjs/react-dom.development.js:4277:31)
      at beginWork$1 (node_modules/react-dom/cjs/react-dom.development.js:27490:7)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26599:12)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26505:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26473:7)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25777:74)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/__tests__/integration/phase2-components.integration.test.js:349:13)

  console.error
    Error: Uncaught [Error: useStorage must be used within StorageProvider]
        at reportException (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
        at innerInvokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:341:9)
        at invokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
        at HTMLUnknownElementImpl._dispatch (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
        at HTMLUnknownElementImpl.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
        at HTMLUnknownElement.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
        at Object.invokeGuardedCallbackDev (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
        at invokeGuardedCallback (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
        at beginWork$1 (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
        at performUnitOfWork (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26599:12)
        at workLoopSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26505:5)
        at renderRootSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26473:7)
        at recoverFromConcurrentError (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:25889:20)
        at performConcurrentWorkOnRoot (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:25789:22)
        at flushActQueue (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2667:24)
        at act (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2582:11)
        at actWithWarning (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
        at /home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/act-compat.js:63:25
        at renderRoot (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:159:26)
        at render (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:246:10)
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/__tests__/integration/phase2-components.integration.test.js:349:13)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12) Error: useStorage must be used within StorageProvider
        at useStorage (/home/user/EnterpriseCashFlow/src/context/StorageContext.jsx:19:11)
        at ReportGeneratorApp (/home/user/EnterpriseCashFlow/src/components/ReportGeneratorApp.jsx:120:92)
        at renderWithHooks (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:15486:18)
        at mountIndeterminateComponent (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:20103:13)
        at beginWork (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:21626:16)
        at HTMLUnknownElement.callCallback (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4164:14)
        at HTMLUnknownElement.callTheUserObjectsOperation (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
        at innerInvokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:338:25)
        at invokeEventListeners (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
        at HTMLUnknownElementImpl._dispatch (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
        at HTMLUnknownElementImpl.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
        at HTMLUnknownElement.dispatchEvent (/home/user/EnterpriseCashFlow/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
        at Object.invokeGuardedCallbackDev (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4213:16)
        at invokeGuardedCallback (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:4277:31)
        at beginWork$1 (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:27490:7)
        at performUnitOfWork (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26599:12)
        at workLoopSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26505:5)
        at renderRootSync (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:26473:7)
        at recoverFromConcurrentError (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:25889:20)
        at performConcurrentWorkOnRoot (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom.development.js:25789:22)
        at flushActQueue (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2667:24)
        at act (/home/user/EnterpriseCashFlow/node_modules/react/cjs/react.development.js:2582:11)
        at actWithWarning (/home/user/EnterpriseCashFlow/node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
        at /home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/act-compat.js:63:25
        at renderRoot (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:159:26)
        at render (/home/user/EnterpriseCashFlow/node_modules/@testing-library/react/dist/pure.js:246:10)
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/__tests__/integration/phase2-components.integration.test.js:349:13)
        at Promise.then.completed (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:391:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/utils.js:316:10)
        at _callCircusTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:218:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:155:3)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:66:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at _runTestsForDescribeBlock (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:60:9)
        at run (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/run.js:25:3)
        at runAndTransformResultsToJestFormat (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:170:21)
        at jestAdapter (/home/user/EnterpriseCashFlow/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:82:19)
        at runTestInternal (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:389:16)
        at runTest (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/runTest.js:475:34)
        at Object.worker (/home/user/EnterpriseCashFlow/node_modules/jest-runner/build/testWorker.js:133:12)

      347 |
      348 |     test('App maintains state consistency across method switches', () => {
    > 349 |       render(<ReportGeneratorApp />);
          |             ^
      350 |       
      351 |       // Set company name
      352 |       const companyInput = screen.getByDisplayValue('Empresa Exemplo S.A.');

      at VirtualConsole.<anonymous> (node_modules/jsdom/lib/jsdom/virtual-console.js:29:45)
      at reportException (node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:70:28)
      at innerInvokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:341:9)
      at invokeEventListeners (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:274:3)
      at HTMLUnknownElementImpl._dispatch (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:221:9)
      at HTMLUnknownElementImpl.dispatchEvent (node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:94:17)
      at HTMLUnknownElement.dispatchEvent (node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:231:34)
      at Object.invokeGuardedCallbackDev (node_modules/react-dom/cjs/react-dom.development.js:4213:16)
      at invokeGuardedCallback (node_modules/react-dom/cjs/react-dom.development.js:4277:31)
      at beginWork$1 (node_modules/react-dom/cjs/react-dom.development.js:27490:7)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26599:12)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26505:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26473:7)
      at recoverFromConcurrentError (node_modules/react-dom/cjs/react-dom.development.js:25889:20)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25789:22)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/__tests__/integration/phase2-components.integration.test.js:349:13)

  console.error
    The above error occurred in the <ReportGeneratorApp> component:
    
        at ReportGeneratorApp (/home/user/EnterpriseCashFlow/src/components/ReportGeneratorApp.jsx:32:49)
    
    Consider adding an error boundary to your tree to customize error handling behavior.
    Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

      347 |
      348 |     test('App maintains state consistency across method switches', () => {
    > 349 |       render(<ReportGeneratorApp />);
          |             ^
      350 |       
      351 |       // Set company name
      352 |       const companyInput = screen.getByDisplayValue('Empresa Exemplo S.A.');

      at logCapturedError (node_modules/react-dom/cjs/react-dom.development.js:18704:23)
      at update.callback (node_modules/react-dom/cjs/react-dom.development.js:18737:5)
      at callCallback (node_modules/react-dom/cjs/react-dom.development.js:15036:12)
      at commitUpdateQueue (node_modules/react-dom/cjs/react-dom.development.js:15057:9)
      at commitLayoutEffectOnFiber (node_modules/react-dom/cjs/react-dom.development.js:23430:13)
      at commitLayoutMountEffects_complete (node_modules/react-dom/cjs/react-dom.development.js:24727:9)
      at commitLayoutEffects_begin (node_modules/react-dom/cjs/react-dom.development.js:24713:7)
      at commitLayoutEffects (node_modules/react-dom/cjs/react-dom.development.js:24651:3)
      at commitRootImpl (node_modules/react-dom/cjs/react-dom.development.js:26862:5)
      at commitRoot (node_modules/react-dom/cjs/react-dom.development.js:26721:5)
      at finishConcurrentRender (node_modules/react-dom/cjs/react-dom.development.js:25931:9)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25848:7)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/__tests__/integration/phase2-components.integration.test.js:349:13)

  console.error
    Warning: Failed prop type: The prop `inputData` is marked as required in `ManualDataEntry`, but its value is `null`.
        at ManualDataEntry (/home/user/EnterpriseCashFlow/src/components/InputPanel/ManualDataEntry.jsx:25:3)

      508 |       };
      509 |
    > 510 |       render(<ManualDataEntry {...mockProps} />);
          |              ^
      511 |       
      512 |       // Should handle null inputData gracefully
      513 |       expect(screen.getByText('Entrada Manual de Dados - Modo Adaptativo')).toBeInTheDocument();

      at printWarning (node_modules/react/cjs/react-jsx-dev-runtime.development.js:87:30)
      at error (node_modules/react/cjs/react-jsx-dev-runtime.development.js:61:7)
      at checkPropTypes (node_modules/react/cjs/react-jsx-dev-runtime.development.js:631:11)
      at validatePropTypes (node_modules/react/cjs/react-jsx-dev-runtime.development.js:1164:7)
      at jsxWithValidation (node_modules/react/cjs/react-jsx-dev-runtime.development.js:1303:7)
      at Object.<anonymous> (src/__tests__/integration/phase2-components.integration.test.js:510:14)

FAIL src/__tests__/integration/phase2-components.integration.test.js (7.28 s)
  Phase 2 Components Integration Tests
    Grid System Integration
      ✓ Grid renders with responsive breakpoints (105 ms)
      ✓ Grid integrates with ManualDataEntry layout (71 ms)
      ✓ Grid handles nested layouts correctly (11 ms)
    Form Composite Integration
      ✓ Form renders with validation and submission (68 ms)
      ✓ Form integrates with Grid layout (6 ms)
      ✓ Form handles validation errors correctly (22 ms)
    ReportGeneratorApp Integration
      ✕ App renders without crashing (113 ms)
      ✕ App switches between input methods correctly (13 ms)
      ✕ App maintains state consistency across method switches (22 ms)
    Backward Compatibility
      ✓ Existing UI components work with new Grid system (31 ms)
      ✓ Form composite maintains interface compatibility (3 ms)
    Performance and Accessibility
      ✓ Grid system maintains accessibility attributes (11 ms)
      ✓ Form composite supports accessibility features (12 ms)
      ✓ Components handle responsive design tokens correctly (4 ms)
    Error Handling and Edge Cases
      ✓ Grid handles invalid props gracefully (3 ms)
      ✓ Form handles missing configuration gracefully (4 ms)
      ✓ Components handle null/undefined props correctly (23 ms)

  ● Phase 2 Components Integration Tests › ReportGeneratorApp Integration › App renders without crashing

    useStorage must be used within StorageProvider

      17 |   const context = useContext(StorageContext);
      18 |   if (!context) {
    > 19 |     throw new Error('useStorage must be used within StorageProvider');
         |           ^
      20 |   }
      21 |   return context;
      22 | };

      at useStorage (src/context/StorageContext.jsx:19:11)
      at ReportGeneratorApp (src/components/ReportGeneratorApp.jsx:120:92)
      at renderWithHooks (node_modules/react-dom/cjs/react-dom.development.js:15486:18)
      at mountIndeterminateComponent (node_modules/react-dom/cjs/react-dom.development.js:20103:13)
      at beginWork (node_modules/react-dom/cjs/react-dom.development.js:21626:16)
      at beginWork$1 (node_modules/react-dom/cjs/react-dom.development.js:27465:14)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26599:12)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26505:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26473:7)
      at recoverFromConcurrentError (node_modules/react-dom/cjs/react-dom.development.js:25889:20)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25789:22)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/__tests__/integration/phase2-components.integration.test.js:327:13)

  ● Phase 2 Components Integration Tests › ReportGeneratorApp Integration › App switches between input methods correctly

    useStorage must be used within StorageProvider

      17 |   const context = useContext(StorageContext);
      18 |   if (!context) {
    > 19 |     throw new Error('useStorage must be used within StorageProvider');
         |           ^
      20 |   }
      21 |   return context;
      22 | };

      at useStorage (src/context/StorageContext.jsx:19:11)
      at ReportGeneratorApp (src/components/ReportGeneratorApp.jsx:120:92)
      at renderWithHooks (node_modules/react-dom/cjs/react-dom.development.js:15486:18)
      at mountIndeterminateComponent (node_modules/react-dom/cjs/react-dom.development.js:20103:13)
      at beginWork (node_modules/react-dom/cjs/react-dom.development.js:21626:16)
      at beginWork$1 (node_modules/react-dom/cjs/react-dom.development.js:27465:14)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26599:12)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26505:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26473:7)
      at recoverFromConcurrentError (node_modules/react-dom/cjs/react-dom.development.js:25889:20)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25789:22)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/__tests__/integration/phase2-components.integration.test.js:334:13)

  ● Phase 2 Components Integration Tests › ReportGeneratorApp Integration › App maintains state consistency across method switches

    useStorage must be used within StorageProvider

      17 |   const context = useContext(StorageContext);
      18 |   if (!context) {
    > 19 |     throw new Error('useStorage must be used within StorageProvider');
         |           ^
      20 |   }
      21 |   return context;
      22 | };

      at useStorage (src/context/StorageContext.jsx:19:11)
      at ReportGeneratorApp (src/components/ReportGeneratorApp.jsx:120:92)
      at renderWithHooks (node_modules/react-dom/cjs/react-dom.development.js:15486:18)
      at mountIndeterminateComponent (node_modules/react-dom/cjs/react-dom.development.js:20103:13)
      at beginWork (node_modules/react-dom/cjs/react-dom.development.js:21626:16)
      at beginWork$1 (node_modules/react-dom/cjs/react-dom.development.js:27465:14)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26599:12)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26505:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26473:7)
      at recoverFromConcurrentError (node_modules/react-dom/cjs/react-dom.development.js:25889:20)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25789:22)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/__tests__/integration/phase2-components.integration.test.js:349:13)

  console.log
    Calling Claude API with model: claude-3-opus-20240229

      at callClaude (src/utils/aiProviders.js:335:11)

  console.log
    Prompt length: 11 characters

      at callClaude (src/utils/aiProviders.js:336:11)

  console.log
    Calling Ollama API with model: llama2

      at callOllama (src/utils/aiProviders.js:408:11)

  console.log
    Prompt length: 11 characters

      at callOllama (src/utils/aiProviders.js:409:11)

  console.log
    Calling OpenAI API with model: gpt-4-turbo

      at callOpenAI (src/utils/aiProviders.js:261:11)

  console.log
    Prompt length: 11 characters

      at callOpenAI (src/utils/aiProviders.js:262:11)

  console.error
    Worker error: Error: Worker crashed
        at Object.<anonymous> (/home/user/EnterpriseCashFlow/src/__tests__/services/financial/FinancialCalculationService.test.js:491:20)

      39 |
      40 |       this.worker.onerror = (error) => {
    > 41 |         console.error('Worker error:', error);
         |                 ^
      42 |         // Reject all pending calculations
      43 |         this.pendingCalculations.forEach((pending) => {
      44 |           pending.reject(error);

      at errorHandler (src/services/financial/FinancialCalculationService.js:41:17)
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:491:7)

  console.error
    OpenAI API request timed out after 60 seconds

      315 |   } catch (error) {
      316 |     if (error.name === 'AbortError') {
    > 317 |       console.error("OpenAI API request timed out after 60 seconds");
          |               ^
      318 |       throw new Error('Erro: Timeout na requisição para OpenAI (60 segundos). Verifique sua conexão de internet.');
      319 |     }
      320 |     throw error;

      at callOpenAI (src/utils/aiProviders.js:317:15)
      at callWithRetry (src/utils/aiProviders.js:68:22)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:101:22)

  console.error
    Erro não recuperável: Erro: Timeout na requisição para OpenAI (60 segundos). Verifique sua conexão de internet.

      90 |           console.error(`Todas as ${maxRetries} tentativas falharam. Último erro: ${error.message}`);
      91 |         } else {
    > 92 |           console.error(`Erro não recuperável: ${error.message}`);
         |                   ^
      93 |         }
      94 |         throw error;
      95 |       }

      at callWithRetry (src/utils/aiProviders.js:92:19)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:101:22)

  console.log
    Calling OpenAI API with model: gpt-4-turbo

      at callOpenAI (src/utils/aiProviders.js:261:11)

  console.log
    Prompt length: 11 characters

      at callOpenAI (src/utils/aiProviders.js:262:11)

  console.log
    OpenAI API response status: 429

      at callOpenAI (src/utils/aiProviders.js:291:13)

  console.error
    OpenAI API error: { error: { message: 'Rate limit exceeded' } }

      293 |     if (!response.ok) {
      294 |       const errorData = await response.json().catch(() => ({ error: { message: response.statusText } }));
    > 295 |       console.error("OpenAI API error:", errorData);
          |               ^
      296 |
      297 |       // Handle specific error cases with Portuguese messages
      298 |       if (response.status === 429) {

      at callOpenAI (src/utils/aiProviders.js:295:15)
      at callWithRetry (src/utils/aiProviders.js:68:22)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:136:22)

  console.warn
    Tentativa 1/3 falhou: Erro: API OpenAI - Limite de taxa excedido. Tente novamente em alguns minutos.. Tentando novamente em 1000ms...

      81 |         // Exponential backoff: 1s, 2s, 4s
      82 |         const backoffTime = Math.pow(2, attempt - 1) * 1000;
    > 83 |         console.warn(`Tentativa ${attempt}/${maxRetries} falhou: ${error.message}. Tentando novamente em ${backoffTime}ms...`);
         |                 ^
      84 |
      85 |         // Wait before retrying
      86 |         await new Promise(resolve => setTimeout(resolve, backoffTime));

      at callWithRetry (src/utils/aiProviders.js:83:17)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:136:22)

  console.log
    Calling OpenAI API with model: gpt-4-turbo

      at callOpenAI (src/utils/aiProviders.js:261:11)

  console.log
    Prompt length: 11 characters

      at callOpenAI (src/utils/aiProviders.js:262:11)

  console.log
    OpenAI API response status: undefined

      at callOpenAI (src/utils/aiProviders.js:291:13)

  console.log
    OpenAI API returned success response

      at callOpenAI (src/utils/aiProviders.js:312:13)

  console.log
    Requisição bem-sucedida na tentativa 2/3

      at callWithRetry (src/utils/aiProviders.js:72:17)

  console.log
    Calling OpenAI API with model: gpt-4-turbo

      at callOpenAI (src/utils/aiProviders.js:261:11)

  console.log
    Prompt length: 11 characters

      at callOpenAI (src/utils/aiProviders.js:262:11)

  console.log
    OpenAI API response status: 401

      at callOpenAI (src/utils/aiProviders.js:291:13)

  console.error
    OpenAI API error: { error: { message: 'Invalid API key' } }

      293 |     if (!response.ok) {
      294 |       const errorData = await response.json().catch(() => ({ error: { message: response.statusText } }));
    > 295 |       console.error("OpenAI API error:", errorData);
          |               ^
      296 |
      297 |       // Handle specific error cases with Portuguese messages
      298 |       if (response.status === 429) {

      at callOpenAI (src/utils/aiProviders.js:295:15)
      at callWithRetry (src/utils/aiProviders.js:68:22)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:156:7)

  console.error
    Erro não recuperável: Erro: API OpenAI - Chave API inválida ou sem permissão. Verifique sua configuração.

      90 |           console.error(`Todas as ${maxRetries} tentativas falharam. Último erro: ${error.message}`);
      91 |         } else {
    > 92 |           console.error(`Erro não recuperável: ${error.message}`);
         |                   ^
      93 |         }
      94 |         throw error;
      95 |       }

      at callWithRetry (src/utils/aiProviders.js:92:19)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:156:7)

  console.log
    Calling OpenAI API with model: gpt-4-turbo

      at callOpenAI (src/utils/aiProviders.js:261:11)

  console.log
    Prompt length: 11 characters

      at callOpenAI (src/utils/aiProviders.js:262:11)

  console.log
    OpenAI API response status: 500

      at callOpenAI (src/utils/aiProviders.js:291:13)

  console.error
    OpenAI API error: { error: { message: 'Server error' } }

      293 |     if (!response.ok) {
      294 |       const errorData = await response.json().catch(() => ({ error: { message: response.statusText } }));
    > 295 |       console.error("OpenAI API error:", errorData);
          |               ^
      296 |
      297 |       // Handle specific error cases with Portuguese messages
      298 |       if (response.status === 429) {

      at callOpenAI (src/utils/aiProviders.js:295:15)
      at callWithRetry (src/utils/aiProviders.js:68:22)

  console.warn
    Tentativa 1/3 falhou: Erro: API OpenAI - Erro no servidor (500). Tente novamente mais tarde.. Tentando novamente em 1000ms...

      81 |         // Exponential backoff: 1s, 2s, 4s
      82 |         const backoffTime = Math.pow(2, attempt - 1) * 1000;
    > 83 |         console.warn(`Tentativa ${attempt}/${maxRetries} falhou: ${error.message}. Tentando novamente em ${backoffTime}ms...`);
         |                 ^
      84 |
      85 |         // Wait before retrying
      86 |         await new Promise(resolve => setTimeout(resolve, backoffTime));

      at callWithRetry (src/utils/aiProviders.js:83:17)

  console.log
    Calling OpenAI API with model: gpt-4-turbo

      at callOpenAI (src/utils/aiProviders.js:261:11)

  console.log
    Prompt length: 11 characters

      at callOpenAI (src/utils/aiProviders.js:262:11)

  console.log
    OpenAI API response status: 500

      at callOpenAI (src/utils/aiProviders.js:291:13)

  console.error
    OpenAI API error: { error: { message: 'Server error' } }

      293 |     if (!response.ok) {
      294 |       const errorData = await response.json().catch(() => ({ error: { message: response.statusText } }));
    > 295 |       console.error("OpenAI API error:", errorData);
          |               ^
      296 |
      297 |       // Handle specific error cases with Portuguese messages
      298 |       if (response.status === 429) {

      at callOpenAI (src/utils/aiProviders.js:295:15)
      at callWithRetry (src/utils/aiProviders.js:68:22)

  console.warn
    Tentativa 2/3 falhou: Erro: API OpenAI - Erro no servidor (500). Tente novamente mais tarde.. Tentando novamente em 2000ms...

      81 |         // Exponential backoff: 1s, 2s, 4s
      82 |         const backoffTime = Math.pow(2, attempt - 1) * 1000;
    > 83 |         console.warn(`Tentativa ${attempt}/${maxRetries} falhou: ${error.message}. Tentando novamente em ${backoffTime}ms...`);
         |                 ^
      84 |
      85 |         // Wait before retrying
      86 |         await new Promise(resolve => setTimeout(resolve, backoffTime));

      at callWithRetry (src/utils/aiProviders.js:83:17)

  console.log
    Calling OpenAI API with model: gpt-4-turbo

      at callOpenAI (src/utils/aiProviders.js:261:11)

  console.log
    Prompt length: 4 characters

      at callOpenAI (src/utils/aiProviders.js:262:11)

  console.log
    OpenAI API response status: 429

      at callOpenAI (src/utils/aiProviders.js:291:13)

  console.error
    OpenAI API error: { error: { message: 'Rate limit exceeded' } }

      293 |     if (!response.ok) {
      294 |       const errorData = await response.json().catch(() => ({ error: { message: response.statusText } }));
    > 295 |       console.error("OpenAI API error:", errorData);
          |               ^
      296 |
      297 |       // Handle specific error cases with Portuguese messages
      298 |       if (response.status === 429) {

      at callOpenAI (src/utils/aiProviders.js:295:15)
      at callWithRetry (src/utils/aiProviders.js:68:22)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:222:7)

  console.warn
    Tentativa 1/3 falhou: Erro: API OpenAI - Limite de taxa excedido. Tente novamente em alguns minutos.. Tentando novamente em 1000ms...

      81 |         // Exponential backoff: 1s, 2s, 4s
      82 |         const backoffTime = Math.pow(2, attempt - 1) * 1000;
    > 83 |         console.warn(`Tentativa ${attempt}/${maxRetries} falhou: ${error.message}. Tentando novamente em ${backoffTime}ms...`);
         |                 ^
      84 |
      85 |         // Wait before retrying
      86 |         await new Promise(resolve => setTimeout(resolve, backoffTime));

      at callWithRetry (src/utils/aiProviders.js:83:17)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:222:7)

  console.log
    Calling OpenAI API with model: gpt-4-turbo

      at callOpenAI (src/utils/aiProviders.js:261:11)

  console.log
    Prompt length: 11 characters

      at callOpenAI (src/utils/aiProviders.js:262:11)

  console.log
    OpenAI API response status: 429

      at callOpenAI (src/utils/aiProviders.js:291:13)

  console.error
    OpenAI API error: { error: { message: 'Rate limit exceeded' } }

      293 |     if (!response.ok) {
      294 |       const errorData = await response.json().catch(() => ({ error: { message: response.statusText } }));
    > 295 |       console.error("OpenAI API error:", errorData);
          |               ^
      296 |
      297 |       // Handle specific error cases with Portuguese messages
      298 |       if (response.status === 429) {

      at callOpenAI (src/utils/aiProviders.js:295:15)
      at callWithRetry (src/utils/aiProviders.js:68:22)

  console.error
    Todas as 3 tentativas falharam. Último erro: Erro: API OpenAI - Limite de taxa excedido. Tente novamente em alguns minutos.

      88 |         // Don't retry - either max attempts reached or non-retryable error
      89 |         if (attempt >= maxRetries) {
    > 90 |           console.error(`Todas as ${maxRetries} tentativas falharam. Último erro: ${error.message}`);
         |                   ^
      91 |         } else {
      92 |           console.error(`Erro não recuperável: ${error.message}`);
      93 |         }

      at callWithRetry (src/utils/aiProviders.js:90:19)

  console.log
    Calling OpenAI API with model: gpt-4-turbo

      at callOpenAI (src/utils/aiProviders.js:261:11)

  console.log
    Prompt length: 4 characters

      at callOpenAI (src/utils/aiProviders.js:262:11)

  console.log
    OpenAI API response status: 429

      at callOpenAI (src/utils/aiProviders.js:291:13)

  console.error
    OpenAI API error: { error: { message: 'Rate limit exceeded' } }

      293 |     if (!response.ok) {
      294 |       const errorData = await response.json().catch(() => ({ error: { message: response.statusText } }));
    > 295 |       console.error("OpenAI API error:", errorData);
          |               ^
      296 |
      297 |       // Handle specific error cases with Portuguese messages
      298 |       if (response.status === 429) {

      at callOpenAI (src/utils/aiProviders.js:295:15)
      at callWithRetry (src/utils/aiProviders.js:68:22)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:222:7)

  console.warn
    Tentativa 2/3 falhou: Erro: API OpenAI - Limite de taxa excedido. Tente novamente em alguns minutos.. Tentando novamente em 2000ms...

      81 |         // Exponential backoff: 1s, 2s, 4s
      82 |         const backoffTime = Math.pow(2, attempt - 1) * 1000;
    > 83 |         console.warn(`Tentativa ${attempt}/${maxRetries} falhou: ${error.message}. Tentando novamente em ${backoffTime}ms...`);
         |                 ^
      84 |
      85 |         // Wait before retrying
      86 |         await new Promise(resolve => setTimeout(resolve, backoffTime));

      at callWithRetry (src/utils/aiProviders.js:83:17)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:222:7)

  console.log
    Calling Claude API with model: claude-3-opus-20240229

      at callClaude (src/utils/aiProviders.js:335:11)

  console.log
    Prompt length: 4 characters

      at callClaude (src/utils/aiProviders.js:336:11)

  console.log
    Claude API response status: 401

      at callClaude (src/utils/aiProviders.js:365:13)

  console.error
    Claude API error: { error: { message: 'Invalid API key' } }

      367 |     if (!response.ok) {
      368 |       const errorData = await response.json().catch(() => ({ error: { message: response.statusText } }));
    > 369 |       console.error("Claude API error:", errorData);
          |               ^
      370 |
      371 |       // Handle specific error cases with Portuguese messages
      372 |       if (response.status === 429) {

      at callClaude (src/utils/aiProviders.js:369:15)
      at callWithRetry (src/utils/aiProviders.js:68:22)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:236:7)

  console.error
    Erro não recuperável: Erro: API Claude - Chave API inválida ou sem permissão. Verifique sua configuração.

      90 |           console.error(`Todas as ${maxRetries} tentativas falharam. Último erro: ${error.message}`);
      91 |         } else {
    > 92 |           console.error(`Erro não recuperável: ${error.message}`);
         |                   ^
      93 |         }
      94 |         throw error;
      95 |       }

      at callWithRetry (src/utils/aiProviders.js:92:19)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:236:7)

  console.log
    Calling Ollama API with model: llama2

      at callOllama (src/utils/aiProviders.js:408:11)

  console.log
    Prompt length: 4 characters

      at callOllama (src/utils/aiProviders.js:409:11)

  console.error
    Erro não recuperável: Erro: Não foi possível conectar ao Ollama. Verifique se está rodando em http://localhost:11434

      90 |           console.error(`Todas as ${maxRetries} tentativas falharam. Último erro: ${error.message}`);
      91 |         } else {
    > 92 |           console.error(`Erro não recuperável: ${error.message}`);
         |                   ^
      93 |         }
      94 |         throw error;
      95 |       }

      at callWithRetry (src/utils/aiProviders.js:92:19)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:246:7)

  console.log
    Calling OpenAI API with model: gpt-4-turbo

      at callOpenAI (src/utils/aiProviders.js:261:11)

  console.log
    Prompt length: 4 characters

      at callOpenAI (src/utils/aiProviders.js:262:11)

  console.log
    OpenAI API response status: 500

      at callOpenAI (src/utils/aiProviders.js:291:13)

  console.error
    OpenAI API error: { error: { message: 'Server error' } }

      293 |     if (!response.ok) {
      294 |       const errorData = await response.json().catch(() => ({ error: { message: response.statusText } }));
    > 295 |       console.error("OpenAI API error:", errorData);
          |               ^
      296 |
      297 |       // Handle specific error cases with Portuguese messages
      298 |       if (response.status === 429) {

      at callOpenAI (src/utils/aiProviders.js:295:15)
      at callWithRetry (src/utils/aiProviders.js:68:22)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:260:7)

  console.warn
    Tentativa 1/3 falhou: Erro: API OpenAI - Erro no servidor (500). Tente novamente mais tarde.. Tentando novamente em 1000ms...

      81 |         // Exponential backoff: 1s, 2s, 4s
      82 |         const backoffTime = Math.pow(2, attempt - 1) * 1000;
    > 83 |         console.warn(`Tentativa ${attempt}/${maxRetries} falhou: ${error.message}. Tentando novamente em ${backoffTime}ms...`);
         |                 ^
      84 |
      85 |         // Wait before retrying
      86 |         await new Promise(resolve => setTimeout(resolve, backoffTime));

      at callWithRetry (src/utils/aiProviders.js:83:17)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:260:7)

  console.log
    Calling OpenAI API with model: gpt-4-turbo

      at callOpenAI (src/utils/aiProviders.js:261:11)

  console.log
    Prompt length: 4 characters

      at callOpenAI (src/utils/aiProviders.js:262:11)

  console.log
    OpenAI API response status: 500

      at callOpenAI (src/utils/aiProviders.js:291:13)

  console.error
    OpenAI API error: { error: { message: 'Server error' } }

      293 |     if (!response.ok) {
      294 |       const errorData = await response.json().catch(() => ({ error: { message: response.statusText } }));
    > 295 |       console.error("OpenAI API error:", errorData);
          |               ^
      296 |
      297 |       // Handle specific error cases with Portuguese messages
      298 |       if (response.status === 429) {

      at callOpenAI (src/utils/aiProviders.js:295:15)
      at callWithRetry (src/utils/aiProviders.js:68:22)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:222:7)

  console.error
    Todas as 3 tentativas falharam. Último erro: Erro: API OpenAI - Erro no servidor (500). Tente novamente mais tarde.

      88 |         // Don't retry - either max attempts reached or non-retryable error
      89 |         if (attempt >= maxRetries) {
    > 90 |           console.error(`Todas as ${maxRetries} tentativas falharam. Último erro: ${error.message}`);
         |                   ^
      91 |         } else {
      92 |           console.error(`Erro não recuperável: ${error.message}`);
      93 |         }

      at callWithRetry (src/utils/aiProviders.js:90:19)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:222:7)

  console.log
    Calling OpenAI API with model: gpt-4-turbo

      at callOpenAI (src/utils/aiProviders.js:261:11)

  console.log
    Prompt length: 4 characters

      at callOpenAI (src/utils/aiProviders.js:262:11)

  console.log
    OpenAI API response status: 500

      at callOpenAI (src/utils/aiProviders.js:291:13)

  console.error
    OpenAI API error: { error: { message: 'Server error' } }

      293 |     if (!response.ok) {
      294 |       const errorData = await response.json().catch(() => ({ error: { message: response.statusText } }));
    > 295 |       console.error("OpenAI API error:", errorData);
          |               ^
      296 |
      297 |       // Handle specific error cases with Portuguese messages
      298 |       if (response.status === 429) {

      at callOpenAI (src/utils/aiProviders.js:295:15)
      at callWithRetry (src/utils/aiProviders.js:68:22)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:260:7)

  console.warn
    Tentativa 2/3 falhou: Erro: API OpenAI - Erro no servidor (500). Tente novamente mais tarde.. Tentando novamente em 2000ms...

      81 |         // Exponential backoff: 1s, 2s, 4s
      82 |         const backoffTime = Math.pow(2, attempt - 1) * 1000;
    > 83 |         console.warn(`Tentativa ${attempt}/${maxRetries} falhou: ${error.message}. Tentando novamente em ${backoffTime}ms...`);
         |                 ^
      84 |
      85 |         // Wait before retrying
      86 |         await new Promise(resolve => setTimeout(resolve, backoffTime));

      at callWithRetry (src/utils/aiProviders.js:83:17)
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:260:7)

  console.log
    Calling OpenAI API with model: gpt-4-turbo

      at callOpenAI (src/utils/aiProviders.js:261:11)

  console.log
    Prompt length: 11 characters

      at callOpenAI (src/utils/aiProviders.js:262:11)

  console.log
    OpenAI API response status: undefined

      at callOpenAI (src/utils/aiProviders.js:291:13)

  console.log
    OpenAI API returned success response

      at callOpenAI (src/utils/aiProviders.js:312:13)

  console.log
    Calling Claude API with model: claude-3-opus-20240229

      at callClaude (src/utils/aiProviders.js:335:11)

  console.log
    Prompt length: 11 characters

      at callClaude (src/utils/aiProviders.js:336:11)

  console.log
    Claude API response status: undefined

      at callClaude (src/utils/aiProviders.js:365:13)

  console.log
    Claude API returned success response

      at callClaude (src/utils/aiProviders.js:386:13)

  console.log
    Calling Ollama API with model: llama2

      at callOllama (src/utils/aiProviders.js:408:11)

  console.log
    Prompt length: 11 characters

      at callOllama (src/utils/aiProviders.js:409:11)

  console.log
    Ollama API response status: undefined

      at callOllama (src/utils/aiProviders.js:434:13)

  console.log
    Ollama API returned success response

      at callOllama (src/utils/aiProviders.js:453:13)

  console.log
    Calling Gemini API with model: gemini-1.5-pro-latest

      at callGemini (src/utils/aiProviders.js:115:11)

  console.log
    Prompt length: 4 characters

      at callGemini (src/utils/aiProviders.js:116:11)

  console.log
    Calling OpenAI API with model: gpt-4-turbo

      at callOpenAI (src/utils/aiProviders.js:261:11)

  console.log
    Prompt length: 4 characters

      at callOpenAI (src/utils/aiProviders.js:262:11)

FAIL src/__tests__/integration/aiProviders.integration.test.js (83.425 s)
  AI Providers Integration Tests
    Timeout Handling
      ✕ OpenAI provider should timeout after 60 seconds (10003 ms)
      ✕ Claude provider should timeout after 60 seconds (10001 ms)
      ✕ Ollama provider should timeout after 120 seconds (10002 ms)
    Retry Logic
      ✕ Should retry on timeout error up to 3 times (10010 ms)
      ✕ Should retry on 429 rate limit error (10007 ms)
      ✓ Should NOT retry on 401 authentication error (25 ms)
      ✕ Should use exponential backoff (1s, 2s, 4s) (13 ms)
    Error Messages (Portuguese)
      ✕ OpenAI should return Portuguese error for rate limit (10007 ms)
      ✓ Claude should return Portuguese error for invalid API key (8 ms)
      ✓ Ollama should return helpful error when not running (5 ms)
      ✕ Should include provider name in error messages (10007 ms)
    Successful Responses
      ✓ OpenAI should parse response correctly (4 ms)
      ✓ Claude should parse response correctly (5 ms)
      ✓ Ollama should parse response correctly (5 ms)
    Provider Configuration
      ✓ All providers should have retry-wrapped callFunction (3 ms)
      ✕ Gemini should have 60s timeout (10001 ms)
      ✓ All providers should have correct API URLs (2 ms)

  ● AI Providers Integration Tests › Timeout Handling › OpenAI provider should timeout after 60 seconds

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      21 |
      22 |   describe('Timeout Handling', () => {
    > 23 |     test('OpenAI provider should timeout after 60 seconds', async () => {
         |     ^
      24 |       // Mock a hanging request
      25 |       global.fetch.mockImplementation(() => new Promise(() => {}));
      26 |

      at src/__tests__/integration/aiProviders.integration.test.js:23:5
      at src/__tests__/integration/aiProviders.integration.test.js:22:3
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:11:1)

  ● AI Providers Integration Tests › Timeout Handling › Claude provider should timeout after 60 seconds

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      39 |     });
      40 |
    > 41 |     test('Claude provider should timeout after 60 seconds', async () => {
         |     ^
      42 |       global.fetch.mockImplementation(() => new Promise(() => {}));
      43 |
      44 |       const provider = AI_PROVIDERS.claude;

      at src/__tests__/integration/aiProviders.integration.test.js:41:5
      at src/__tests__/integration/aiProviders.integration.test.js:22:3
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:11:1)

  ● AI Providers Integration Tests › Timeout Handling › Ollama provider should timeout after 120 seconds

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      55 |     });
      56 |
    > 57 |     test('Ollama provider should timeout after 120 seconds', async () => {
         |     ^
      58 |       global.fetch.mockImplementation(() => new Promise(() => {}));
      59 |
      60 |       const provider = AI_PROVIDERS.ollama;

      at src/__tests__/integration/aiProviders.integration.test.js:57:5
      at src/__tests__/integration/aiProviders.integration.test.js:22:3
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:11:1)

  ● AI Providers Integration Tests › Retry Logic › Should retry on timeout error up to 3 times

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      73 |
      74 |   describe('Retry Logic', () => {
    > 75 |     test('Should retry on timeout error up to 3 times', async () => {
         |     ^
      76 |       let callCount = 0;
      77 |
      78 |       global.fetch.mockImplementation(() => {

      at src/__tests__/integration/aiProviders.integration.test.js:75:5
      at src/__tests__/integration/aiProviders.integration.test.js:74:3
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:11:1)

  ● AI Providers Integration Tests › Retry Logic › Should retry on 429 rate limit error

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      110 |     });
      111 |
    > 112 |     test('Should retry on 429 rate limit error', async () => {
          |     ^
      113 |       let callCount = 0;
      114 |
      115 |       global.fetch.mockImplementation(() => {

      at src/__tests__/integration/aiProviders.integration.test.js:112:5
      at src/__tests__/integration/aiProviders.integration.test.js:74:3
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:11:1)

  ● AI Providers Integration Tests › Retry Logic › Should use exponential backoff (1s, 2s, 4s)

    TypeError: jest.advanceTimersByTimeAsync is not a function

      201 |       // Advance timers to simulate backoff delays
      202 |       for (let i = 0; i < 3; i++) {
    > 203 |         await jest.advanceTimersByTimeAsync(Math.pow(2, i) * 1000 + 100);
          |                    ^
      204 |       }
      205 |
      206 |       await promise;

      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:203:20)

  ● AI Providers Integration Tests › Error Messages (Portuguese) › OpenAI should return Portuguese error for rate limit

    Erro: API OpenAI - Limite de taxa excedido. Tente novamente em alguns minutos.

      297 |       // Handle specific error cases with Portuguese messages
      298 |       if (response.status === 429) {
    > 299 |         throw new Error(`Erro: API OpenAI - Limite de taxa excedido. Tente novamente em alguns minutos.`);
          |               ^
      300 |       } else if (response.status === 401 || response.status === 403) {
      301 |         throw new Error(`Erro: API OpenAI - Chave API inválida ou sem permissão. Verifique sua configuração.`);
      302 |       } else if (response.status === 400) {

      at callOpenAI (src/utils/aiProviders.js:299:15)
      at callWithRetry (src/utils/aiProviders.js:68:22)

  ● AI Providers Integration Tests › Error Messages (Portuguese) › OpenAI should return Portuguese error for rate limit

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      211 |
      212 |   describe('Error Messages (Portuguese)', () => {
    > 213 |     test('OpenAI should return Portuguese error for rate limit', async () => {
          |     ^
      214 |       global.fetch.mockResolvedValue({
      215 |         ok: false,
      216 |         status: 429,

      at src/__tests__/integration/aiProviders.integration.test.js:213:5
      at src/__tests__/integration/aiProviders.integration.test.js:212:3
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:11:1)

  ● AI Providers Integration Tests › Error Messages (Portuguese) › Should include provider name in error messages

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      249 |     });
      250 |
    > 251 |     test('Should include provider name in error messages', async () => {
          |     ^
      252 |       global.fetch.mockResolvedValue({
      253 |         ok: false,
      254 |         status: 500,

      at src/__tests__/integration/aiProviders.integration.test.js:251:5
      at src/__tests__/integration/aiProviders.integration.test.js:212:3
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:11:1)

  ● AI Providers Integration Tests › Provider Configuration › Gemini should have 60s timeout

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      335 |     });
      336 |
    > 337 |     test('Gemini should have 60s timeout', async () => {
          |     ^
      338 |       global.fetch.mockImplementation(() => new Promise(() => {}));
      339 |
      340 |       const provider = AI_PROVIDERS.gemini;

      at src/__tests__/integration/aiProviders.integration.test.js:337:5
      at src/__tests__/integration/aiProviders.integration.test.js:329:3
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:11:1)

FAIL src/__tests__/services/financial/FinancialCalculationService.test.js (93.528 s)
  FinancialCalculationService
    Initialization
      ✓ should initialize worker on first calculation (8 ms)
      ✓ should handle worker initialization errors (141 ms)
    NPV Calculations
      ✓ should calculate NPV correctly (3 ms)
      ✕ should handle NPV calculation errors (6 ms)
    IRR Calculations
      ✓ should calculate IRR correctly (3 ms)
      ✓ should handle non-converging IRR (3 ms)
    Payback Period Calculations
      ✓ should calculate payback period with exact period (3 ms)
      ✓ should handle projects that never pay back (2 ms)
    Break-even Analysis
      ✓ should calculate break-even point correctly (4 ms)
      ✓ should handle negative contribution margin (3 ms)
    Cash Flow Projections
      ✓ should project cash flows with growth (3 ms)
    Batch Calculations
      ✓ should process multiple calculations in batch (3 ms)
      ✓ should handle partial batch failures (6 ms)
    Scenario Analysis
      ✓ should calculate NPV for multiple scenarios (4 ms)
    Monte Carlo Simulation
      ✕ should perform Monte Carlo simulation (10006 ms)
    Error Handling and Timeouts
      ✕ should timeout long-running calculations (20001 ms)
      ✕ should handle worker errors (10005 ms)
    Resource Management
      ✕ should clean up resources properly (20003 ms)
      ✕ should get service status (10004 ms)
    Legacy Support
      ✕ should support processFinancialData (20003 ms)

  ● FinancialCalculationService › NPV Calculations › should handle NPV calculation errors

    Invalid cash flows

      32 |             pending.resolve(data);
      33 |           } else {
    > 34 |             pending.reject(new Error(error));
         |                            ^
      35 |           }
      36 |           this.pendingCalculations.delete(id);
      37 |         }

      at MockWorker.onmessage (src/services/financial/FinancialCalculationService.js:34:28)
      at src/__tests__/services/financial/FinancialCalculationService.test.js:18:14
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:516:19)

  ● FinancialCalculationService › Monte Carlo Simulation › should perform Monte Carlo simulation

    TypeError: Cannot destructure property 'id' of '((cov_21d5mi7486(...).s[9]++) , event.data)' as it is undefined.

      25 |       
      26 |       this.worker.onmessage = (event) => {
    > 27 |         const { id, success, error, ...data } = event.data;
         |                 ^
      28 |         const pending = this.pendingCalculations.get(id);
      29 |         
      30 |         if (pending) {

      at MockWorker.onmessage (src/services/financial/FinancialCalculationService.js:27:17)
      at src/__tests__/services/financial/FinancialCalculationService.test.js:18:14
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:516:19)

  ● FinancialCalculationService › Monte Carlo Simulation › should perform Monte Carlo simulation

    thrown: "Exceeded timeout of 10000 ms for a hook.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      52 |   });
      53 |
    > 54 |   afterEach(async () => {
         |   ^
      55 |     await service.cleanup();
      56 |     jest.clearAllMocks();
      57 |   });

      at src/__tests__/services/financial/FinancialCalculationService.test.js:54:3
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:38:1)

  ● FinancialCalculationService › Error Handling and Timeouts › should timeout long-running calculations

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      465 |
      466 |   describe('Error Handling and Timeouts', () => {
    > 467 |     it('should timeout long-running calculations', async () => {
          |     ^
      468 |       // Don't set mockResponse to simulate no response
      469 |       MockWorker.mockResponse = null;
      470 |

      at src/__tests__/services/financial/FinancialCalculationService.test.js:467:5
      at src/__tests__/services/financial/FinancialCalculationService.test.js:466:3
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:38:1)

  ● FinancialCalculationService › Error Handling and Timeouts › should timeout long-running calculations

    thrown: "Exceeded timeout of 10000 ms for a hook.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      52 |   });
      53 |
    > 54 |   afterEach(async () => {
         |   ^
      55 |     await service.cleanup();
      56 |     jest.clearAllMocks();
      57 |   });

      at src/__tests__/services/financial/FinancialCalculationService.test.js:54:3
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:38:1)

  ● FinancialCalculationService › Error Handling and Timeouts › should handle worker errors

    thrown: "Exceeded timeout of 10000 ms for a hook.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      52 |   });
      53 |
    > 54 |   afterEach(async () => {
         |   ^
      55 |     await service.cleanup();
      56 |     jest.clearAllMocks();
      57 |   });

      at src/__tests__/services/financial/FinancialCalculationService.test.js:54:3
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:38:1)

  ● FinancialCalculationService › Resource Management › should clean up resources properly

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      496 |
      497 |   describe('Resource Management', () => {
    > 498 |     it('should clean up resources properly', async () => {
          |     ^
      499 |       await service.initialize();
      500 |       
      501 |       expect(MockWorker.instances.length).toBe(1);

      at src/__tests__/services/financial/FinancialCalculationService.test.js:498:5
      at src/__tests__/services/financial/FinancialCalculationService.test.js:497:3
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:38:1)

  ● FinancialCalculationService › Resource Management › should clean up resources properly

    thrown: "Exceeded timeout of 10000 ms for a hook.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      52 |   });
      53 |
    > 54 |   afterEach(async () => {
         |   ^
      55 |     await service.cleanup();
      56 |     jest.clearAllMocks();
      57 |   });

      at src/__tests__/services/financial/FinancialCalculationService.test.js:54:3
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:38:1)

  ● FinancialCalculationService › Resource Management › should get service status

    thrown: "Exceeded timeout of 10000 ms for a hook.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      52 |   });
      53 |
    > 54 |   afterEach(async () => {
         |   ^
      55 |     await service.cleanup();
      56 |     jest.clearAllMocks();
      57 |   });

      at src/__tests__/services/financial/FinancialCalculationService.test.js:54:3
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:38:1)

  ● FinancialCalculationService › Legacy Support › should support processFinancialData

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      523 |
      524 |   describe('Legacy Support', () => {
    > 525 |     it('should support processFinancialData', async () => {
          |     ^
      526 |       MockWorker.mockResponse = (data) => ({
      527 |         id: data.id,
      528 |         success: true,

      at src/__tests__/services/financial/FinancialCalculationService.test.js:525:5
      at src/__tests__/services/financial/FinancialCalculationService.test.js:524:3
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:38:1)

  ● FinancialCalculationService › Legacy Support › should support processFinancialData

    thrown: "Exceeded timeout of 10000 ms for a hook.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      52 |   });
      53 |
    > 54 |   afterEach(async () => {
         |   ^
      55 |     await service.cleanup();
      56 |     jest.clearAllMocks();
      57 |   });

      at src/__tests__/services/financial/FinancialCalculationService.test.js:54:3
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:38:1)

---------------------------------------|---------|----------|---------|---------|-----------------------------------------------------------------------------------------------------
File                                   | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                   
---------------------------------------|---------|----------|---------|---------|-----------------------------------------------------------------------------------------------------
All files                              |   18.64 |    16.77 |   14.99 |   19.13 |                                                                                                     
 src                                   |       0 |      100 |     100 |       0 |                                                                                                     
  index.js                             |       0 |      100 |     100 |       0 | 7-8                                                                                                 
 src/components                        |   12.66 |    19.71 |    1.14 |    14.5 |                                                                                                     
  App.jsx                              |       0 |        0 |       0 |       0 | 12-174                                                                                              
  ErrorBoundary.jsx                    |       0 |        0 |       0 |       0 | 6-96                                                                                                
  ExcelUploader.jsx                    |       0 |        0 |       0 |       0 | 11-73                                                                                               
  ReportGeneratorApp.jsx               |   18.68 |    27.18 |    1.92 |    21.5 | 108,123-527                                                                                         
  SessionRecovery.jsx                  |    4.34 |        0 |       0 |    5.55 | 18-44                                                                                               
 src/components/AIPanel                |    2.04 |        0 |       0 |    2.08 |                                                                                                     
  AiAnalysisSection.jsx                |    2.43 |        0 |       0 |     2.5 | 5-164                                                                                               
  AiSummarySection.jsx                 |       0 |        0 |       0 |       0 | 15-28                                                                                               
  AiVarianceSection.jsx                |       0 |        0 |       0 |       0 | 16-28                                                                                               
 src/components/Charts                 |       0 |        0 |       0 |       0 |                                                                                                     
  AssetCompositionChart.jsx            |       0 |        0 |       0 |       0 | 7-69                                                                                                
  BalanceSheetDifferenceTrendChart.jsx |       0 |        0 |       0 |       0 | 8-74                                                                                                
  BaseChart.jsx                        |       0 |        0 |       0 |       0 | 21-104                                                                                              
  CashFlowComponentsChart.jsx          |       0 |        0 |       0 |       0 | 8-71                                                                                                
  CashFlowKeyMetricsTrendChart.jsx     |       0 |        0 |       0 |       0 | 8-69                                                                                                
  FundingStructureChart.jsx            |       0 |        0 |       0 |       0 | 7-68                                                                                                
  MarginTrendChart.jsx                 |       0 |        0 |       0 |       0 | 8-67                                                                                                
  PnlVisualChart.jsx                   |       0 |        0 |       0 |       0 | 7-88                                                                                                
  RechartsWrapper.jsx                  |       0 |        0 |       0 |       0 | 40-67                                                                                               
  WorkingCapitalDaysTrendChart.jsx     |       0 |        0 |       0 |       0 | 9-70                                                                                                
 src/components/Debug                  |      12 |        0 |       0 |   13.33 |                                                                                                     
  DataConsistencyMonitor.jsx           |      12 |        0 |       0 |   13.33 | 6-8,12-24,34-36,65-71,91-131,144-259                                                                
 src/components/ExportPanel            |       0 |        0 |       0 |       0 |                                                                                                     
  ExportPanel.jsx                      |       0 |        0 |       0 |       0 | 11-329                                                                                              
 src/components/FinancialCalculator    |       0 |        0 |       0 |       0 |                                                                                                     
  FinancialCalculatorExample.jsx       |       0 |        0 |       0 |       0 | 29-332                                                                                              
 src/components/InputPanel             |   34.14 |    29.86 |   34.61 |   36.93 |                                                                                                     
  AiProviderSelector.jsx               |       0 |        0 |       0 |       0 | 21-93                                                                                               
  ExcelTemplateSelector.jsx            |       0 |        0 |       0 |       0 | 19-66                                                                                               
  ExcelUploadProgress.jsx              |       0 |        0 |       0 |       0 | 22-94                                                                                               
  ExcelUploader.jsx                    |      50 |    66.66 |      50 |      50 | 29-34                                                                                               
  InputMethodSelector.jsx              |       0 |        0 |       0 |       0 | 24-65                                                                                               
  ManualDataEntry.jsx                  |   90.24 |    84.05 |   89.47 |   97.29 | 196                                                                                                 
  PdfUploader.jsx                      |       0 |        0 |       0 |       0 | 27-112                                                                                              
  PeriodTypeConfirmation.jsx           |       0 |        0 |       0 |       0 | 21-60                                                                                               
 src/components/Monitoring             |       0 |        0 |       0 |       0 |                                                                                                     
  MonitoringDashboard.jsx              |       0 |        0 |       0 |       0 | 10-228                                                                                              
  index.js                             |       0 |        0 |       0 |       0 |                                                                                                     
 src/components/ReportPanel            |    1.29 |        0 |       0 |    1.53 |                                                                                                     
  BalanceSheetEquation.jsx             |    9.67 |        0 |       0 |    9.67 | 7,16-41,55-90                                                                                       
  ExecutiveSummaryCards.jsx            |       0 |        0 |       0 |       0 | 12-200                                                                                              
  FinancialTables.jsx                  |       0 |        0 |       0 |       0 | 15-221                                                                                              
  FundingReconciliation.jsx            |       0 |        0 |       0 |       0 | 12-58                                                                                               
  KpiCards.jsx                         |       0 |        0 |       0 |       0 | 11-61                                                                                               
  PowerOfOneAnalysis.jsx               |       0 |        0 |       0 |       0 | 14-147                                                                                              
  ReportControls.jsx                   |       0 |        0 |       0 |       0 | 36-136                                                                                              
  ReportRenderer.jsx                   |    1.12 |        0 |       0 |    1.42 | 41-254                                                                                              
 src/components/ReportPanel/Charts     |       0 |        0 |       0 |       0 |                                                                                                     
  CashFlowWaterfallChart.jsx           |       0 |        0 |       0 |       0 | 8-108                                                                                               
  FundingStructureChart.jsx            |       0 |        0 |       0 |       0 | 8-85                                                                                                
  PnlWaterfallChart.jsx                |       0 |        0 |       0 |       0 | 8-84                                                                                                
  ProfitWaterfallChart.jsx             |       0 |        0 |       0 |       0 | 8-89                                                                                                
  WorkingCapitalTimeline.jsx           |       0 |        0 |       0 |       0 | 21-74                                                                                               
 src/components/Security               |       0 |        0 |       0 |       0 |                                                                                                     
  ApiKeyConfiguration.jsx              |       0 |        0 |       0 |       0 | 12-286                                                                                              
  index.js                             |       0 |        0 |       0 |       0 |                                                                                                     
 src/components/composite              |   71.42 |    58.92 |   57.89 |   77.77 |                                                                                                     
  Form.jsx                             |   71.42 |    58.92 |   57.89 |   77.77 | 36,42-48,66-68,77,156,184,191,221                                                                   
 src/components/demo                   |       0 |        0 |       0 |       0 |                                                                                                     
  DesignSystemDemo.jsx                 |       0 |        0 |       0 |       0 | 20-422                                                                                              
 src/components/layout                 |   45.83 |    33.33 |   19.04 |   42.42 |                                                                                                     
  Grid.jsx                             |   45.83 |    33.33 |   19.04 |   42.42 | 217-288,357-422,480-496                                                                             
 src/components/ui                     |       0 |        0 |       0 |       0 |                                                                                                     
  Button.jsx                           |       0 |        0 |       0 |       0 | 14-319                                                                                              
  FormField.jsx                        |       0 |        0 |       0 |       0 | 28-341                                                                                              
  Input.jsx                            |       0 |        0 |       0 |       0 | 36-364                                                                                              
 src/context                           |    7.31 |     3.03 |    5.55 |     7.5 |                                                                                                     
  StorageContext.jsx                   |    7.31 |     3.03 |    5.55 |     7.5 | 21,29-229                                                                                           
 src/design-system                     |      20 |        0 |       0 |      20 |                                                                                                     
  tokens.js                            |      20 |        0 |       0 |      20 | 303-332,337-344,348,352-353,357                                                                     
 src/hooks                             |   11.84 |    14.72 |    8.36 |   12.08 |                                                                                                     
  useAccessibility.js                  |       0 |        0 |       0 |       0 | 21-428                                                                                              
  useAiAnalysis.js                     |       0 |        0 |       0 |       0 | 16-105                                                                                              
  useAiDataExtraction.js               |       0 |        0 |       0 |       0 | 17-141                                                                                              
  useAiDocumentExtraction.js           |       0 |        0 |       0 |       0 | 13-313                                                                                              
  useAiService.js                      |      75 |    74.46 |   41.66 |    80.3 | 104-105,130,134-146,151,174-178                                                                     
  useEnhancedAiService.js              |       0 |        0 |       0 |       0 | 13-344                                                                                              
  useExcelParser.js                    |   77.86 |    62.93 |     100 |   78.76 | 49,72-73,104,160-162,205,211,224,311-342                                                            
  useExportService.js                  |       0 |        0 |       0 |       0 | 11-215                                                                                              
  useFinancialCalculations.js          |       0 |        0 |       0 |       0 | 8-313                                                                                               
  useFinancialCalculator.js            |       0 |      100 |       0 |       0 | 6-23                                                                                                
  useGeminiApi.js                      |       0 |        0 |       0 |       0 | 7-145                                                                                               
  useLibrary.js                        |       0 |        0 |       0 |       0 | 5-66                                                                                                
  usePdfParser.js                      |   76.59 |    42.85 |     100 |      75 | 66-94                                                                                               
  useSecureFinancialData.js            |       0 |        0 |       0 |       0 | 14-352                                                                                              
  useSmartExcelParser.js               |       0 |        0 |       0 |       0 | 35-388                                                                                              
  useStorage.js                        |       0 |        0 |       0 |       0 | 14-366                                                                                              
 src/services                          |       0 |        0 |       0 |       0 |                                                                                                     
  index.js                             |       0 |        0 |       0 |       0 | 44-94                                                                                               
 src/services/ai                       |   48.85 |       25 |   51.02 |    48.8 |                                                                                                     
  AIService.js                         |   98.09 |      100 |   92.59 |      98 | 254,266                                                                                             
  DocumentExtractor.js                 |       0 |        0 |       0 |       0 | 11-364                                                                                              
  index.js                             |       0 |        0 |       0 |       0 |                                                                                                     
  types.js                             |     100 |      100 |     100 |     100 |                                                                                                     
 src/services/ai/providers             |   12.17 |    10.46 |   20.31 |   12.12 |                                                                                                     
  AIProviderFactory.js                 |    7.69 |        0 |       0 |    7.69 | 23-65                                                                                               
  BaseProvider.js                      |    92.5 |    87.87 |   92.85 |   94.59 | 159-160                                                                                             
  ClaudeProvider.js                    |       0 |        0 |       0 |       0 | 7-206                                                                                               
  GeminiProvider.js                    |       0 |        0 |       0 |       0 | 7-238                                                                                               
  OllamaProvider.js                    |       0 |        0 |       0 |       0 | 6-201                                                                                               
  OpenAIProvider.js                    |       0 |        0 |       0 |       0 | 7-207                                                                                               
  index.js                             |       0 |        0 |       0 |       0 |                                                                                                     
 src/services/ai/templates             |     2.7 |        0 |       0 |    2.77 |                                                                                                     
  PromptTemplates.js                   |     2.7 |        0 |       0 |    2.77 | 10-300,355-363                                                                                      
 src/services/ai/utils                 |       0 |        0 |       0 |       0 |                                                                                                     
  ResponseParser.js                    |       0 |        0 |       0 |       0 | 13-358                                                                                              
  index.js                             |       0 |        0 |       0 |       0 |                                                                                                     
 src/services/export                   |   13.59 |    10.85 |   20.35 |   14.14 |                                                                                                     
  BaseExportService.js                 |    20.4 |     6.66 |   30.76 |    20.4 | 40-59,79-188,215-222                                                                                
  BatchExportService.js                |    2.17 |        0 |    3.44 |    2.27 | 45-499                                                                                              
  ExcelExportService.js                |    9.24 |      6.8 |      12 |   10.09 | 144-650                                                                                             
  ExportService.js                     |    60.2 |    48.48 |   60.86 |    60.2 | 44-45,66-70,75,81-82,112-142,173-182,201-210,253,267-273,319,325-335,368,396                        
  PDFExportService.js                  |    0.99 |        0 |    4.34 |       1 | 46-542                                                                                              
  index.js                             |       0 |        0 |       0 |       0 |                                                                                                     
  types.js                             |     100 |      100 |     100 |     100 |                                                                                                     
 src/services/export/templates         |   20.13 |        6 |   24.48 |   20.58 |                                                                                                     
  TemplateManager.js                   |    19.7 |     6.12 |   27.27 |   19.84 | 36-42,54,114-148,161,186-451,468-497                                                                
  defaultTemplates.js                  |   28.57 |        0 |       0 |      40 | 314,592-601                                                                                         
 src/services/export/utils             |    1.42 |     0.96 |      10 |    1.47 |                                                                                                     
  BrandingManager.js                   |    1.72 |     1.49 |   13.63 |     1.8 | 62-603,624-633,644                                                                                  
  ChartExporter.js                     |    0.84 |        0 |    5.55 |    0.84 | 28-415                                                                                              
 src/services/financial                |   86.13 |     62.5 |   93.54 |   86.31 |                                                                                                     
  FinancialCalculationService.js       |   86.13 |     62.5 |   93.54 |   86.31 | 171-176,190,253-260,322-330                                                                         
 src/services/monitoring               |       0 |        0 |       0 |       0 |                                                                                                     
  auditLogger.js                       |       0 |        0 |       0 |       0 | 10-386                                                                                              
  errorTracker.js                      |       0 |        0 |       0 |       0 | 11-230                                                                                              
  index.js                             |       0 |        0 |       0 |       0 | 15-153                                                                                              
  loggingService.js                    |       0 |        0 |       0 |       0 | 10-191                                                                                              
  metricsCollector.js                  |       0 |        0 |       0 |       0 | 8-394                                                                                               
  performanceMonitor.js                |       0 |        0 |       0 |       0 | 8-297                                                                                               
  securityMonitor.js                   |       0 |        0 |       0 |       0 | 10-583                                                                                              
 src/services/security                 |       0 |        0 |       0 |       0 |                                                                                                     
  apiKeyManager.js                     |       0 |        0 |       0 |       0 | 11-466                                                                                              
  dataValidator.js                     |       0 |        0 |       0 |       0 | 10-526                                                                                              
  index.js                             |       0 |        0 |       0 |       0 |                                                                                                     
  securityHeaders.js                   |       0 |        0 |       0 |       0 | 8-374                                                                                               
 src/services/storage                  |   10.22 |    11.59 |    8.64 |   10.78 |                                                                                                     
  AutoSaveService.js                   |       0 |        0 |       0 |       0 | 12-564                                                                                              
  DataExportService.js                 |    0.38 |     4.16 |    1.25 |    0.46 | 29-623                                                                                              
  DataImportService.js                 |    1.82 |     2.74 |    5.88 |       2 | 35-737                                                                                              
  EncryptionService.js                 |    7.29 |    32.43 |       4 |    7.52 | 26-375,403-406                                                                                      
  IndexedDBService.js                  |    3.26 |     1.88 |    2.85 |    3.44 | 73-535                                                                                              
  LocalStorageService.js               |    2.22 |     5.17 |     3.7 |    2.25 | 24-509                                                                                              
  StorageManager.js                    |   51.16 |    45.71 |   48.71 |   50.95 | 331,348-684                                                                                         
  StorageService.js                    |   36.36 |    16.66 |   16.66 |   36.36 | 13,29-121                                                                                           
  index.js                             |       0 |        0 |       0 |       0 | 21-118                                                                                              
 src/services/storage/models           |   13.79 |        0 |       0 |   16.66 |                                                                                                     
  index.js                             |   13.79 |        0 |       0 |   16.66 | 297-366                                                                                             
 src/utils                             |   55.99 |    52.39 |    43.2 |   57.23 |                                                                                                     
  aiAnalysisTypes.js                   |     100 |      100 |     100 |     100 |                                                                                                     
  aiPromptEngine.js                    |   56.91 |    32.87 |   58.82 |   59.82 | 153-254,362,471,488-495,504-607                                                                     
  aiProviders.js                       |   55.86 |    40.41 |   73.07 |   54.87 | 100,111-112,139,148-248,257-258,303,308,331-332,373,376-382,391,395-396,437-449,458-459,463,568-643 
  calculations.js                      |   96.38 |    89.44 |     100 |   97.08 | 168-169,490,586-588,617                                                                             
  constants.js                         |     100 |      100 |     100 |     100 |                                                                                                     
  dataConsistencyValidator.js          |       0 |        0 |       0 |       0 | 23-80                                                                                               
  dataValidation.js                    |   78.33 |    56.44 |   67.56 |   79.04 | 154-155,165,272,281-282,294,356-364,469-592                                                         
  excelTemplateGenerator.js            |    1.28 |        0 |       0 |    1.48 | 41-282                                                                                              
  fieldDefinitions.js                  |   26.66 |     9.85 |   14.28 |   26.74 | 55-56,60,64-67,71-74,78-81,89-149,192-196,201-205,210-211,215-216,220-267                           
  financialValidators.js               |     100 |    88.88 |     100 |     100 | 47,67-71,75,110-117,132                                                                             
  formatters.js                        |     100 |    98.01 |     100 |     100 | 47-48                                                                                               
  performanceOptimizations.js          |       0 |        0 |       0 |       0 | 11-416                                                                                              
 src/workers                           |   42.04 |    17.47 |   63.63 |   39.88 |                                                                                                     
  financialCalculator.worker.js        |   42.04 |    17.47 |   63.63 |   39.88 | 159-177,182-234,239-414,421-424                                                                     
---------------------------------------|---------|----------|---------|---------|-----------------------------------------------------------------------------------------------------
Summary of all failing tests
FAIL src/__tests__/workers/financialCalculator.worker.test.js
  ● Financial Calculator Worker › Basic Worker Functionality › should handle successful calculation messages

    TypeError: mockWorkerScope.onmessage is not a function

      52 |       };
      53 |
    > 54 |       mockWorkerScope.onmessage({ data: messageData });
         |                       ^
      55 |
      56 |       // Verify response
      57 |       expect(mockPostMessage).toHaveBeenCalledWith({

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:54:23)

  ● Financial Calculator Worker › Basic Worker Functionality › should handle calculation errors gracefully

    TypeError: mockWorkerScope.onmessage is not a function

      80 |       };
      81 |
    > 82 |       mockWorkerScope.onmessage({ data: messageData });
         |                       ^
      83 |
      84 |       // Verify error response
      85 |       expect(mockPostMessage).toHaveBeenCalledWith({

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:82:23)

  ● Financial Calculator Worker › Advanced Financial Calculations › should handle NPV calculation message

    TypeError: mockWorkerScope.onmessage is not a function

      103 |       };
      104 |
    > 105 |       mockWorkerScope.onmessage({ data: messageData });
          |                       ^
      106 |
      107 |       // Verify NPV calculation
      108 |       expect(mockPostMessage).toHaveBeenCalledWith(

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:105:23)

  ● Financial Calculator Worker › Advanced Financial Calculations › should handle IRR calculation message

    TypeError: mockWorkerScope.onmessage is not a function

      126 |       };
      127 |
    > 128 |       mockWorkerScope.onmessage({ data: messageData });
          |                       ^
      129 |
      130 |       // Verify IRR calculation
      131 |       expect(mockPostMessage).toHaveBeenCalledWith(

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:128:23)

  ● Financial Calculator Worker › Advanced Financial Calculations › should handle payback period calculation

    TypeError: mockWorkerScope.onmessage is not a function

      150 |       };
      151 |
    > 152 |       mockWorkerScope.onmessage({ data: messageData });
          |                       ^
      153 |
      154 |       // Verify payback calculation
      155 |       expect(mockPostMessage).toHaveBeenCalledWith(

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:152:23)

  ● Financial Calculator Worker › Advanced Financial Calculations › should handle break-even analysis

    TypeError: mockWorkerScope.onmessage is not a function

      175 |       };
      176 |
    > 177 |       mockWorkerScope.onmessage({ data: messageData });
          |                       ^
      178 |
      179 |       // Verify break-even calculation
      180 |       expect(mockPostMessage).toHaveBeenCalledWith(

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:177:23)

  ● Financial Calculator Worker › Advanced Financial Calculations › should handle cash flow projections

    TypeError: mockWorkerScope.onmessage is not a function

      202 |       };
      203 |
    > 204 |       mockWorkerScope.onmessage({ data: messageData });
          |                       ^
      205 |
      206 |       // Verify projection calculation
      207 |       expect(mockPostMessage).toHaveBeenCalledWith(

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:204:23)

  ● Financial Calculator Worker › Performance and Large Dataset Handling › should handle large dataset calculations efficiently

    TypeError: mockWorkerScope.onmessage is not a function

      235 |       const startTime = Date.now();
      236 |
    > 237 |       mockWorkerScope.onmessage({
          |                       ^
      238 |         data: {
      239 |           periodsInputDataRaw: largeDataset,
      240 |           periodTypeLabel: 'MONTHLY',

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:237:23)

  ● Financial Calculator Worker › Performance and Large Dataset Handling › should batch process multiple calculation types

    TypeError: mockWorkerScope.onmessage is not a function

      285 |       };
      286 |
    > 287 |       mockWorkerScope.onmessage({ data: messageData });
          |                       ^
      288 |
      289 |       expect(mockPostMessage).toHaveBeenCalledWith(
      290 |         expect.objectContaining({

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:287:23)

  ● Financial Calculator Worker › Error Handling and Validation › should validate NPV inputs

    TypeError: mockWorkerScope.onmessage is not a function

      325 |       invalidMessages.forEach((messageData) => {
      326 |         mockPostMessage.mockClear();
    > 327 |         mockWorkerScope.onmessage({ data: messageData });
          |                         ^
      328 |
      329 |         expect(mockPostMessage).toHaveBeenCalledWith(
      330 |           expect.objectContaining({

      at forEach (src/__tests__/workers/financialCalculator.worker.test.js:327:25)
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:325:23)

  ● Financial Calculator Worker › Error Handling and Validation › should handle unknown calculation types

    TypeError: mockWorkerScope.onmessage is not a function

      344 |       };
      345 |
    > 346 |       mockWorkerScope.onmessage({ data: messageData });
          |                       ^
      347 |
      348 |       expect(mockPostMessage).toHaveBeenCalledWith(
      349 |         expect.objectContaining({

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:346:23)

  ● Financial Calculator Worker › Error Handling and Validation › should handle thread safety for concurrent calculations

    TypeError: mockWorkerScope.onmessage is not a function

      373 |       // Send multiple messages quickly
      374 |       messages.forEach((msg) => {
    > 375 |         mockWorkerScope.onmessage({ data: msg });
          |                         ^
      376 |       });
      377 |
      378 |       // Verify both calculations completed

      at forEach (src/__tests__/workers/financialCalculator.worker.test.js:375:25)
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:374:16)

  ● Financial Calculator Worker › Memory Management › should clean up resources after calculation

    TypeError: mockWorkerScope.onmessage is not a function

      401 |       };
      402 |
    > 403 |       mockWorkerScope.onmessage({ data: largeCalculation });
          |                       ^
      404 |
      405 |       // Verify calculation completed
      406 |       expect(mockPostMessage).toHaveBeenCalledWith(

      at Object.<anonymous> (src/__tests__/workers/financialCalculator.worker.test.js:403:23)

FAIL src/utils/__tests__/calculations.test.js
  ● Financial Calculations Engine › calculateIncomeStatement › should calculate income statement with all provided values

    expect(received).toEqual(expected) // deep equality

    - Expected  -  3
    + Received  + 78

      Object {
    +   "auditTrail": Object {
    +     "calculationSteps": Array [
    +       Object {
    +         "formula": "data.revenue",
    +         "step": "revenue",
    +         "value": 1000000,
    +       },
    +       Object {
    +         "formula": "data.cogs",
    +         "source": "input",
    +         "step": "cogs",
    +         "value": 600000,
    +       },
    +       Object {
    +         "formula": "revenue - cogs = 1000000 - 600000",
    +         "metric": "grossProfit",
    +         "value": 400000,
    +       },
    +       Object {
    +         "formula": "(grossProfit / revenue) * 100 = (400000 / 1000000) * 100",
    +         "metric": "grossMarginPercent",
    +         "value": 40,
    +       },
    +       Object {
    +         "formula": "grossProfit - operatingExpenses = 400000 - 200000",
    +         "metric": "ebitda",
    +         "source": "calculated",
    +         "value": 200000,
    +       },
    +       Object {
    +         "formula": "ebitda - depreciation = 200000 - 50000",
    +         "metric": "ebit",
    +         "value": 150000,
    +       },
    +       Object {
    +         "formula": "ebit + netFinancialResult = 150000 + -20000",
    +         "metric": "ebt",
    +         "value": 130000,
    +       },
    +       Object {
    +         "detail": "IRPJ: 19500 base + 0 surtax",
    +         "formula": "IRPJ (19500) + CSLL (11700)",
    +         "metric": "taxes",
    +         "value": 31200,
    +       },
    +       Object {
    +         "formula": "ebt - taxes = 130000 - 31200",
    +         "metric": "netIncome",
    +         "value": 98800,
    +       },
    +     ],
    +     "originalValues": Object {
    +       "cogs": 600000,
    +       "depreciation": 50000,
    +       "financialExpenses": 30000,
    +       "financialRevenue": 10000,
    +       "operatingExpenses": 200000,
    +       "revenue": 1000000,
    +     },
    +     "overrides": null,
    +     "system": "EnterpriseCashFlow",
    +     "timestamp": "2025-11-04T01:42:45.008Z",
    +     "validationResults": Object {
    +       "errors": Array [],
    +       "warnings": Array [],
    +     },
    +     "version": "1.0",
    +   },
        "cogs": 600000,
        "depreciation": 50000,
        "ebit": 150000,
        "ebitMargin": 15,
        "ebitda": 200000,
        "ebitdaMargin": 20,
        "ebt": 130000,
    +   "effectiveTaxRate": 24,
        "grossMarginPercent": 40,
        "grossProfit": 400000,
        "netFinancialResult": -20000,
    -   "netIncome": 85800,
    -   "netMargin": 8.58,
    +   "netIncome": 98800,
    +   "netMargin": 9.88,
        "operatingExpenses": 200000,
        "revenue": 1000000,
    -   "taxes": 44200,
    +   "taxBreakdown": Object {
    +     "csll": 11700,
    +     "irpj": 19500,
    +     "irpjBase": 19500,
    +     "irpjSurtax": 0,
    +   },
    +   "taxes": 31200,
      }

      25 |       const result = calculateIncomeStatement(input);
      26 |
    > 27 |       expect(result).toEqual({
         |                      ^
      28 |         revenue: 1000000,
      29 |         cogs: 600000,
      30 |         grossProfit: 400000,

      at Object.<anonymous> (src/utils/__tests__/calculations.test.js:27:22)

  ● Financial Calculations Engine › calculateCashFlow › should handle first period without previous data

    expect(received).toBe(expected) // Object.is equality

    Expected: 120000
    Received: -50000

      136 |       const result = calculateCashFlow(currentPeriod, null);
      137 |
    > 138 |       expect(result.operatingCashFlow).toBe(120000); // Net income + depreciation
          |                                        ^
      139 |       expect(result.workingCapitalChange).toBe(0);
      140 |     });
      141 |

      at Object.<anonymous> (src/utils/__tests__/calculations.test.js:138:40)

  ● Financial Calculations Engine › calculateBalanceSheet › should estimate balance sheet components

    expect(received).toBe(expected) // Object.is equality

    Expected: 410000
    Received: 400000

      358 |       expect(result.currentAssets).toBeGreaterThan(0);
      359 |       expect(result.nonCurrentAssets).toBeGreaterThan(0);
    > 360 |       expect(result.totalAssets).toBe(result.currentAssets + result.nonCurrentAssets);
          |                                  ^
      361 |       expect(result.currentLiabilities).toBe(130000); // AP (80000) + Short-term debt (50000)
      362 |       expect(result.totalLiabilitiesEquity).toBe(result.totalAssets);
      363 |     });

      at Object.<anonymous> (src/utils/__tests__/calculations.test.js:360:34)

  ● Financial Calculations Engine › calculateBalanceSheet › should calculate balance sheet check

    expect(received).toBeLessThan(expected)

    Expected: < 0.01
    Received:   NaN

      367 |
      368 |       const balanceCheck = Math.abs(result.totalAssets - result.totalLiabilitiesEquity);
    > 369 |       expect(balanceCheck).toBeLessThan(0.01); // Should balance
          |                            ^
      370 |     });
      371 |
      372 |     it('should handle missing data with estimates', () => {

      at Object.<anonymous> (src/utils/__tests__/calculations.test.js:369:28)

FAIL src/utils/__tests__/calculations.comprehensive.test.js
  ● Financial Calculations - Comprehensive Tests › calculateIncomeStatement › Tax calculations › should calculate taxes on positive income

    expect(received).toBe(expected) // Object.is equality

    Expected: 95200
    Received: 65200

      110 |         
      111 |         expect(result.ebt).toBeGreaterThan(0);
    > 112 |         expect(result.taxes).toBe(Math.round(result.ebt * 0.34 * 100) / 100);
          |                              ^
      113 |       });
      114 |
      115 |       it('should not apply taxes on negative income', () => {

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:112:30)

  ● Financial Calculations - Comprehensive Tests › calculateCashFlow › Operating cash flow calculations › should calculate OCF for first period (no WC change)

    expect(received).toBe(expected) // Object.is equality

    Expected: 120000
    Received: -50000

      205 |         const result = calculateCashFlow(basePeriod, null);
      206 |         
    > 207 |         expect(result.operatingCashFlow).toBe(120000); // NI + Depreciation
          |                                          ^
      208 |         expect(result.workingCapitalChange).toBe(0);
      209 |       });
      210 |

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:207:42)

  ● Financial Calculations - Comprehensive Tests › calculateCashFlow › Investing and free cash flow › should calculate investing cash flow with provided capex

    expect(received).toBe(expected) // Object.is equality

    Expected: 70000
    Received: -100000

      250 |         expect(result.capex).toBe(50000);
      251 |         expect(result.investingCashFlow).toBe(-50000);
    > 252 |         expect(result.freeCashFlow).toBe(70000); // 120k - 50k
          |                                     ^
      253 |       });
      254 |
      255 |       it('should use default capex rate when not provided', () => {

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:252:37)

  ● Financial Calculations - Comprehensive Tests › calculateCashFlow › Financing cash flow › should calculate financing cash flow correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 190000
    Received: 20000

      278 |         
      279 |         expect(result.financingCashFlow).toBe(120000); // 100k + 50k - 30k
    > 280 |         expect(result.netCashFlow).toBe(190000); // 120k - 50k + 120k
          |                                    ^
      281 |       });
      282 |
      283 |       it('should handle debt repayment and dividend payments', () => {

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:280:36)

  ● Financial Calculations - Comprehensive Tests › calculateCashFlow › Cash conversion metrics › should calculate cash conversion rate correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 120
    Received: -50

      299 |         const result = calculateCashFlow(basePeriod, null);
      300 |         
    > 301 |         expect(result.cashConversionRate).toBe(120); // (120k / 100k) * 100
          |                                           ^
      302 |       });
      303 |
      304 |       it('should handle negative net income', () => {

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:301:43)

  ● Financial Calculations - Comprehensive Tests › calculateCashFlow › Cash conversion metrics › should handle negative net income

    expect(received).toBe(expected) // Object.is equality

    Expected: -30000
    Received: -200000

      313 |         const result = calculateCashFlow(lossmaking, null);
      314 |         
    > 315 |         expect(result.operatingCashFlow).toBe(-30000); // -50k + 20k
          |                                          ^
      316 |         expect(result.cashConversionRate).toBe(60); // (-30k / -50k) * 100
      317 |       });
      318 |     });

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:315:42)

  ● Financial Calculations - Comprehensive Tests › calculateWorkingCapitalMetrics › Cash conversion cycle › should handle negative CCC (good cash management)

    expect(received).toBeLessThan(expected)

    Expected: < 0
    Received:   16438.35

      411 |         
      412 |         expect(result.cashConversionCycle).toBe(-10); // 30 + 20 - 60
    > 413 |         expect(result.workingCapitalValue).toBeLessThan(0); // Negative WC is good!
          |                                            ^
      414 |       });
      415 |     });
      416 |

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:413:44)

  ● Financial Calculations - Comprehensive Tests › calculateWorkingCapitalMetrics › Edge cases › should handle zero revenue

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 45

      458 |         
      459 |         expect(result.accountsReceivableValue).toBe(0);
    > 460 |         expect(result.dso).toBe(0);
          |                            ^
      461 |         expect(result.workingCapitalValue).toBe(0);
      462 |       });
      463 |

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:460:28)

  ● Financial Calculations - Comprehensive Tests › calculateBalanceSheet › Asset calculations › should estimate cash and current assets

    expect(received).toBe(expected) // Object.is equality

    Expected: 100000
    Received: 0

      626 |         const result = calculateBalanceSheet(baseData);
      627 |         
    > 628 |         expect(result.cash).toBe(100000); // Max of 10% revenue or net cash flow
          |                             ^
      629 |         expect(result.accountsReceivable).toBe(150000);
      630 |         expect(result.inventory).toBe(100000);
      631 |         expect(result.currentAssets).toBe(350000); // 100k + 150k + 100k

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:628:29)

  ● Financial Calculations - Comprehensive Tests › calculateBalanceSheet › Asset calculations › should calculate non-current assets to balance

    expect(received).toBe(expected) // Object.is equality

    Expected: 800000
    Received: 400000

      635 |         const result = calculateBalanceSheet(baseData);
      636 |         
    > 637 |         expect(result.totalAssets).toBe(800000);
          |                                    ^
      638 |         expect(result.nonCurrentAssets).toBe(450000); // 800k - 350k
      639 |       });
      640 |

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:637:36)

  ● Financial Calculations - Comprehensive Tests › calculateBalanceSheet › Asset calculations › should use revenue-based estimation when total assets not provided

    expect(received).toBe(expected) // Object.is equality

    Expected: 800000
    Received: 400000

      649 |         const result = calculateBalanceSheet(data);
      650 |         
    > 651 |         expect(result.totalAssets).toBe(800000); // 80% of revenue
          |                                    ^
      652 |       });
      653 |     });
      654 |

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:651:36)

  ● Financial Calculations - Comprehensive Tests › calculateBalanceSheet › Liability calculations › should calculate current liabilities

    expect(received).toBe(expected) // Object.is equality

    Expected: 130000
    Received: 150000

      659 |         expect(result.accountsPayable).toBe(80000);
      660 |         expect(result.shortTermDebt).toBe(50000); // 5% of revenue
    > 661 |         expect(result.currentLiabilities).toBe(130000); // 80k + 50k
          |                                           ^
      662 |       });
      663 |
      664 |       it('should balance with appropriate debt/equity ratio', () => {

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:661:43)

  ● Financial Calculations - Comprehensive Tests › calculateBalanceSheet › Edge cases › should handle missing working capital data

    expect(received).toBe(expected) // Object.is equality

    Expected: 0
    Received: 96000

      705 |         const result = calculateBalanceSheet(data);
      706 |         
    > 707 |         expect(result.accountsReceivable).toBe(0);
          |                                           ^
      708 |         expect(result.inventory).toBe(0);
      709 |         expect(result.accountsPayable).toBe(0);
      710 |         expect(result.currentAssets).toBeGreaterThan(0); // At least cash

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:707:43)

  ● Financial Calculations - Comprehensive Tests › calculateBalanceSheet › Edge cases › should handle negative net cash flow

    expect(received).toBe(expected) // Object.is equality

    Expected: 100000
    Received: 0

      721 |         const result = calculateBalanceSheet(data);
      722 |         
    > 723 |         expect(result.cash).toBe(100000); // Uses 10% of revenue minimum
          |                             ^
      724 |       });
      725 |     });
      726 |   });

      at Object.<anonymous> (src/utils/__tests__/calculations.comprehensive.test.js:723:29)

FAIL src/services/export/__tests__/ExcelExportService.test.js
  ● ExcelExportService › export › should throw error on validation failure

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"error": {"context": "Excel Export", "message": "Invalid data format", "timestamp": "2025-11-04T01:42:45.427Z"}, "success": false}

      146 |       }));
      147 |
    > 148 |       await expect(service.export(validData)).rejects.toThrow('Invalid data format');
          |             ^
      149 |     });
      150 |
      151 |     it('should set workbook properties', async () => {

      at expect (node_modules/expect/build/index.js:178:15)
      at Object.<anonymous> (src/services/export/__tests__/ExcelExportService.test.js:148:13)

  ● ExcelExportService › error handling › should handle workbook creation errors

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"error": {"context": "Excel Export", "message": "Failed to create workbook", "timestamp": "2025-11-04T01:42:45.440Z"}, "success": false}

      263 |       };
      264 |
    > 265 |       await expect(service.export(validData)).rejects.toThrow('Failed to create workbook');
          |             ^
      266 |     });
      267 |
      268 |     it('should handle invalid data gracefully', async () => {

      at expect (node_modules/expect/build/index.js:178:15)
      at Object.<anonymous> (src/services/export/__tests__/ExcelExportService.test.js:265:13)

  ● ExcelExportService › error handling › should handle invalid data gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: {"error": {"context": "Excel Export", "message": "Missing required fields; Invalid data structure", "timestamp": "2025-11-04T01:42:45.443Z"}, "success": false}

      272 |       }));
      273 |
    > 274 |       await expect(service.export({})).rejects.toThrow('Missing required fields; Invalid data structure');
          |             ^
      275 |     });
      276 |   });
      277 |

      at expect (node_modules/expect/build/index.js:178:15)
      at Object.<anonymous> (src/services/export/__tests__/ExcelExportService.test.js:274:13)

FAIL src/services/ai/__tests__/AIService.test.js
  ● AIService › categorizeInsight › should categorize growth insights

    expect(received).toBe(expected) // Object.is equality

    Expected: "growth"
    Received: "opportunity"

      444 |     it('should categorize growth insights', () => {
      445 |       const service = new AIService();
    > 446 |       expect(service.categorizeInsight('Significant growth potential')).toBe('growth');
          |                                                                         ^
      447 |       expect(service.categorizeInsight('Oportunidade de crescimento')).toBe('growth');
      448 |     });
      449 |

      at Object.<anonymous> (src/services/ai/__tests__/AIService.test.js:446:73)

  ● AIService › prioritizeInsight › should identify high priority insights

    expect(received).toBe(expected) // Object.is equality

    Expected: "high"
    Received: "low"

      464 |       const service = new AIService();
      465 |       expect(service.prioritizeInsight('This is critical and urgent')).toBe('high');
    > 466 |       expect(service.prioritizeInsight('Ação imediata necessária')).toBe('high');
          |                                                                     ^
      467 |     });
      468 |
      469 |     it('should identify medium priority insights', () => {

      at Object.<anonymous> (src/services/ai/__tests__/AIService.test.js:466:69)

FAIL src/utils/__tests__/financialValidators.test.js
  ● FinancialConstraintValidator › validateCashFlowConstraints › should handle missing optional fields

    expect(received).toHaveLength(expected)

    Expected length: 0
    Received length: 1
    Received array:  [{"fields": ["netCashFlowBeforeFinancing", "cashFlowFromFinancing", "netChangeInCash"], "message": "ERRO INTERNO DFC: Variação Líquida de Caixa Armazenada (R$ 50.000,00) não confere com soma de seus componentes (FCL+FCF = R$ 70.000,00).", "severity": "critical", "type": "DFC_NET_CHANGE_CALC_ERROR"}]

      471 |
      472 |       const result = FinancialConstraintValidator.validateCashFlowConstraints(data);
    > 473 |       expect(result.errors).toHaveLength(0);
          |                             ^
      474 |     });
      475 |   });
      476 |

      at Object.<anonymous> (src/utils/__tests__/financialValidators.test.js:473:29)

  ● OverrideValidator › validateOverrideConsistency › should handle null revenue

    expect(received).toHaveLength(expected)

    Expected length: 0
    Received length: 1
    Received array:  [{"message": "Overrides de CPV (R$ 550.000,00) e Lucro Bruto (R$ 450.000,00) são matematicamente inconsistentes com a Receita (R$ 0,00).", "severity": "error", "type": "PL_OVERRIDE_INCONSISTENT"}]

      814 |
      815 |       const result = OverrideValidator.validateOverrideConsistency(periodInput);
    > 816 |       expect(result.errors).toHaveLength(0);
          |                             ^
      817 |     });
      818 |
      819 |     it('should handle undefined revenue', () => {

      at Object.<anonymous> (src/utils/__tests__/financialValidators.test.js:816:29)

  ● OverrideValidator › validateOverrideConsistency › should handle undefined revenue

    expect(received).toHaveLength(expected)

    Expected length: 0
    Received length: 1
    Received array:  [{"message": "Overrides de CPV (R$ 550.000,00) e Lucro Bruto (R$ 450.000,00) são matematicamente inconsistentes com a Receita (R$ 0,00).", "severity": "error", "type": "PL_OVERRIDE_INCONSISTENT"}]

      825 |
      826 |       const result = OverrideValidator.validateOverrideConsistency(periodInput);
    > 827 |       expect(result.errors).toHaveLength(0);
          |                             ^
      828 |     });
      829 |
      830 |     it('should handle empty string revenue', () => {

      at Object.<anonymous> (src/utils/__tests__/financialValidators.test.js:827:29)

  ● OverrideValidator › validateOverrideConsistency › should handle empty string revenue

    expect(received).toHaveLength(expected)

    Expected length: 0
    Received length: 1
    Received array:  [{"message": "Overrides de CPV (R$ 550.000,00) e Lucro Bruto (R$ 450.000,00) são matematicamente inconsistentes com a Receita (R$ 0,00).", "severity": "error", "type": "PL_OVERRIDE_INCONSISTENT"}]

      836 |
      837 |       const result = OverrideValidator.validateOverrideConsistency(periodInput);
    > 838 |       expect(result.errors).toHaveLength(0);
          |                             ^
      839 |     });
      840 |
      841 |     it('should handle string revenue', () => {

      at Object.<anonymous> (src/utils/__tests__/financialValidators.test.js:838:29)

FAIL src/services/storage/__tests__/StorageManager.test.js
  ● StorageManager › project management › deleteProject › should delete associated scenarios and reports

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "scenarios", "scen-1"
    Received: "projects", "proj-1"

    Number of calls: 1

      279 |         await manager.deleteProject('proj-1');
      280 |
    > 281 |         expect(mockIndexedDB.remove).toHaveBeenCalledWith('scenarios', 'scen-1');
          |                                      ^
      282 |         expect(mockIndexedDB.remove).toHaveBeenCalledWith('reports', 'rep-1');
      283 |       });
      284 |     });

      at Object.<anonymous> (src/services/storage/__tests__/StorageManager.test.js:281:38)

FAIL src/services/export/__tests__/ExportService.test.js
  ● ExportService › Data Validation › should detect invalid data

    TypeError: Cannot read properties of null (reading 'charts')

      322 |     // Format-specific validation
      323 |     if (format === ExportFormat.PDF) {
    > 324 |       if (data.charts && !Array.isArray(data.charts)) {
          |                ^
      325 |         errors.push('Charts must be an array');
      326 |       }
      327 |     } else if (format === ExportFormat.EXCEL) {

      at ExportService.validateData (src/services/export/ExportService.js:324:16)
      at Object.<anonymous> (src/services/export/__tests__/ExportService.test.js:56:36)

  ● ExportService › Branding › should update branding configuration

    expect(received).toBe(expected) // Object.is equality

    Expected: "#ff0000"
    Received: "#007bff"

      138 |       const updated = exportService.getBranding();
      139 |       
    > 140 |       expect(updated.colors.primary).toBe('#ff0000');
          |                                      ^
      141 |       expect(updated.watermark.text).toBe('CONFIDENTIAL');
      142 |     });
      143 |   });

      at Object.<anonymous> (src/services/export/__tests__/ExportService.test.js:140:38)

  ● ExportService › Cross-browser Compatibility › should handle missing URL API

    expect(received).not.toThrow()

    Error name:    "TypeError"
    Error message: "Cannot read properties of undefined (reading 'createObjectURL')"

          264 |    */
          265 |   download(blob, fileName) {
        > 266 |     const url = URL.createObjectURL(blob);
              |                     ^
          267 |     const link = document.createElement('a');
          268 |     link.href = url;
          269 |     link.download = fileName;

      at ExportService.download (src/services/export/ExportService.js:266:21)
      at src/services/export/__tests__/ExportService.test.js:209:28
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:83:11)
      at Object.toThrow (node_modules/expect/build/index.js:382:21)
      at Object.<anonymous> (src/services/export/__tests__/ExportService.test.js:209:74)
      at Object.<anonymous> (src/services/export/__tests__/ExportService.test.js:209:74)

FAIL src/__tests__/utils/customMatchers.js
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:175:18)
      at node_modules/@jest/core/build/TestScheduler.js:316:17
      at node_modules/emittery/index.js:260:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:258:23)

FAIL src/__tests__/utils/accessibilityUtils.js
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:175:18)
      at node_modules/@jest/core/build/TestScheduler.js:316:17
      at node_modules/emittery/index.js:260:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:258:23)

FAIL src/__tests__/utils/testDataFactories.js
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:175:18)
      at node_modules/@jest/core/build/TestScheduler.js:316:17
      at node_modules/emittery/index.js:260:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:258:23)

FAIL src/__tests__/utils/testDataFactories.comprehensive.js
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/TestScheduler.js:175:18)
      at node_modules/@jest/core/build/TestScheduler.js:316:17
      at node_modules/emittery/index.js:260:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:258:23)

FAIL src/__tests__/integration/pdfParser.integration.test.js (5.054 s)
  ● PDF Parser Integration Tests › File Validation › should validate PDF file type

    expect(received).toBeTruthy()

    Received: null

      60 |       }).rejects.toThrow('Arquivo inválido');
      61 |
    > 62 |       expect(result.current.parsingError).toBeTruthy();
         |                                           ^
      63 |       expect(result.current.parsingError.message).toContain('PDF válido');
      64 |     });
      65 |

      at Object.<anonymous> (src/__tests__/integration/pdfParser.integration.test.js:62:43)

  ● PDF Parser Integration Tests › File Validation › should accept valid PDF files

    TypeError: Cannot read properties of undefined (reading '5')

      62 |         // Group text items by their vertical position to maintain lines
      63 |         textContent.items.forEach(item => {
    > 64 |           const y = Math.round(item.transform[5]); // Vertical position
         |                                              ^
      65 |           
      66 |           if (lastY !== null && Math.abs(y - lastY) > 5) {
      67 |             // New line detected

      at forEach (src/hooks/usePdfParser.js:64:46)
          at Array.forEach (<anonymous>)
      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:63:27)
      at src/__tests__/integration/pdfParser.integration.test.js:90:25

  ● PDF Parser Integration Tests › PDF.js Library Integration › should use PDF.js to load document

    TypeError: Cannot read properties of undefined (reading '5')

      62 |         // Group text items by their vertical position to maintain lines
      63 |         textContent.items.forEach(item => {
    > 64 |           const y = Math.round(item.transform[5]); // Vertical position
         |                                              ^
      65 |           
      66 |           if (lastY !== null && Math.abs(y - lastY) > 5) {
      67 |             // New line detected

      at forEach (src/hooks/usePdfParser.js:64:46)
          at Array.forEach (<anonymous>)
      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:63:27)
      at src/__tests__/integration/pdfParser.integration.test.js:126:9

  ● PDF Parser Integration Tests › Text Extraction › should extract text from all pages

    TypeError: Cannot read properties of undefined (reading '5')

      62 |         // Group text items by their vertical position to maintain lines
      63 |         textContent.items.forEach(item => {
    > 64 |           const y = Math.round(item.transform[5]); // Vertical position
         |                                              ^
      65 |           
      66 |           if (lastY !== null && Math.abs(y - lastY) > 5) {
      67 |             // New line detected

      at forEach (src/hooks/usePdfParser.js:64:46)
          at Array.forEach (<anonymous>)
      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:63:27)
      at src/__tests__/integration/pdfParser.integration.test.js:150:25

  ● PDF Parser Integration Tests › Text Extraction › should preserve text structure and spacing

    TypeError: Cannot read properties of undefined (reading '5')

      62 |         // Group text items by their vertical position to maintain lines
      63 |         textContent.items.forEach(item => {
    > 64 |           const y = Math.round(item.transform[5]); // Vertical position
         |                                              ^
      65 |           
      66 |           if (lastY !== null && Math.abs(y - lastY) > 5) {
      67 |             // New line detected

      at forEach (src/hooks/usePdfParser.js:64:46)
          at Array.forEach (<anonymous>)
      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:63:27)
      at src/__tests__/integration/pdfParser.integration.test.js:174:25

  ● PDF Parser Integration Tests › Text Extraction › should handle PDFs with many pages

    TypeError: Cannot read properties of undefined (reading '5')

      62 |         // Group text items by their vertical position to maintain lines
      63 |         textContent.items.forEach(item => {
    > 64 |           const y = Math.round(item.transform[5]); // Vertical position
         |                                              ^
      65 |           
      66 |           if (lastY !== null && Math.abs(y - lastY) > 5) {
      67 |             // New line detected

      at forEach (src/hooks/usePdfParser.js:64:46)
          at Array.forEach (<anonymous>)
      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:63:27)
      at src/__tests__/integration/pdfParser.integration.test.js:204:25

  ● PDF Parser Integration Tests › Text Extraction › should handle empty pages

    TypeError: Cannot read properties of undefined (reading '5')

      62 |         // Group text items by their vertical position to maintain lines
      63 |         textContent.items.forEach(item => {
    > 64 |           const y = Math.round(item.transform[5]); // Vertical position
         |                                              ^
      65 |           
      66 |           if (lastY !== null && Math.abs(y - lastY) > 5) {
      67 |             // New line detected

      at forEach (src/hooks/usePdfParser.js:64:46)
          at Array.forEach (<anonymous>)
      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:63:27)
      at src/__tests__/integration/pdfParser.integration.test.js:232:25

  ● PDF Parser Integration Tests › Error Handling › should handle PDF loading errors

    expect(received).toBeTruthy()

    Received: null

      257 |       }).rejects.toThrow('Invalid PDF structure');
      258 |
    > 259 |       expect(result.current.parsingError).toBeTruthy();
          |                                           ^
      260 |       expect(result.current.isParsing).toBe(false);
      261 |     });
      262 |

      at Object.<anonymous> (src/__tests__/integration/pdfParser.integration.test.js:259:43)

  ● PDF Parser Integration Tests › Error Handling › should handle page extraction errors

    expect(received).rejects.toThrow(expected)

    Expected substring: "Page extraction failed"
    Received message:   "Cannot read properties of undefined (reading '5')"

          62 |         // Group text items by their vertical position to maintain lines
          63 |         textContent.items.forEach(item => {
        > 64 |           const y = Math.round(item.transform[5]); // Vertical position
             |                                              ^
          65 |           
          66 |           if (lastY !== null && Math.abs(y - lastY) > 5) {
          67 |             // New line detected

      at forEach (src/hooks/usePdfParser.js:64:46)
                at Array.forEach (<anonymous>)
      at Object.extractTextFromPdf (src/hooks/usePdfParser.js:63:27)
      at src/__tests__/integration/pdfParser.integration.test.js:285:11
      at Object.toThrow (node_modules/expect/build/index.js:285:22)
      at Object.<anonymous> (src/__tests__/integration/pdfParser.integration.test.js:287:18)

  ● PDF Parser Integration Tests › Loading State Management › should manage isParsing state correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: true
    Received: false

      336 |
      337 |       // Check loading state immediately
    > 338 |       expect(result.current.isParsing).toBe(true);
          |                                        ^
      339 |
      340 |       // Resolve the document loading
      341 |       resolveDocument(mockDocument);

      at Object.<anonymous> (src/__tests__/integration/pdfParser.integration.test.js:338:40)

  ● PDF Parser Integration Tests › Loading State Management › should reset error state on new extraction

    TypeError: Cannot read properties of null (reading 'parsingError')

      360 |       }
      361 |
    > 362 |       expect(result.current.parsingError).toBeTruthy();
          |                             ^
      363 |
      364 |       // Now try with valid file
      365 |       const validFile = new File(['%PDF-1.4'], 'test.pdf', { type: 'application/pdf' });

      at Object.<anonymous> (src/__tests__/integration/pdfParser.integration.test.js:362:29)

  ● PDF Parser Integration Tests › Financial Data Extraction Scenarios › should extract Brazilian financial statements

    TypeError: Cannot read properties of null (reading 'extractTextFromPdf')

      397 |       let extractedData;
      398 |       await act(async () => {
    > 399 |         extractedData = await result.current.extractTextFromPdf(pdfFile);
          |                                              ^
      400 |       });
      401 |
      402 |       expect(extractedData.text).toContain('DEMONSTRAÇÃO DE RESULTADOS');

      at src/__tests__/integration/pdfParser.integration.test.js:399:46
      at node_modules/@testing-library/react/dist/act-compat.js:64:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at Object.<anonymous> (src/__tests__/integration/pdfParser.integration.test.js:398:16)

  ● PDF Parser Integration Tests › Financial Data Extraction Scenarios › should extract financial tables and preserve structure

    TypeError: Cannot read properties of null (reading 'extractTextFromPdf')

      429 |       let extractedData;
      430 |       await act(async () => {
    > 431 |         extractedData = await result.current.extractTextFromPdf(pdfFile);
          |                                              ^
      432 |       });
      433 |
      434 |       expect(extractedData.text).toContain('Q1 2024');

      at src/__tests__/integration/pdfParser.integration.test.js:431:46
      at node_modules/@testing-library/react/dist/act-compat.js:64:24
      at act (node_modules/react/cjs/react.development.js:2512:16)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at Object.<anonymous> (src/__tests__/integration/pdfParser.integration.test.js:430:16)

FAIL src/__tests__/integration/excelParser.integration.test.js (5.122 s)
  ● Excel Parser Integration Tests › Worksheet Detection › should find worksheet with financial headers

    expect(received).toBeNull()

    Received: "Nenhum dado financeiro encontrado na planilha."

      57 |       });
      58 |
    > 59 |       expect(result.current.parsingError).toBeNull();
         |                                           ^
      60 |       expect(parsedData).toBeDefined();
      61 |     });
      62 |

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:59:43)

  ● Excel Parser Integration Tests › Worksheet Detection › should fallback to sheet with "Dados" in name

    expect(jest.fn()).not.toHaveBeenCalled()

    Expected number of calls: 0
    Received number of calls: 1

    1: 1

      88 |
      89 |       expect(dataSheet.getRow).toHaveBeenCalled();
    > 90 |       expect(instructionSheet.getRow).not.toHaveBeenCalled();
         |                                           ^
      91 |     });
      92 |
      93 |     it('should handle worksheets without proper headers', async () => {

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:90:43)

  ● Excel Parser Integration Tests › Period Detection › should detect periods with strict "Período X" pattern

    expect(received).toHaveLength(expected)

    Matcher error: received value must have a length property whose value must be a number

    Received has value: null

      129 |       });
      130 |
    > 131 |       expect(parsedData).toHaveLength(4);
          |                          ^
      132 |     });
      133 |
      134 |     it('should detect periods with loose patterns (P1, P2, etc)', async () => {

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:131:26)

  ● Excel Parser Integration Tests › Period Detection › should detect periods with loose patterns (P1, P2, etc)

    expect(received).toHaveLength(expected)

    Matcher error: received value must have a length property whose value must be a number

    Received has value: null

      153 |       });
      154 |
    > 155 |       expect(parsedData).toHaveLength(4);
          |                          ^
      156 |     });
      157 |
      158 |     it('should detect periods by column position between Description and Notes', async () => {

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:155:26)

  ● Excel Parser Integration Tests › Period Detection › should detect periods by column position between Description and Notes

    expect(received).toHaveLength(expected)

    Matcher error: received value must have a length property whose value must be a number

    Received has value: null

      177 |       });
      178 |
    > 179 |       expect(parsedData).toHaveLength(4);
          |                          ^
      180 |     });
      181 |
      182 |     it('should limit detected periods to MAX_PERIODS', async () => {

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:179:26)

  ● Excel Parser Integration Tests › Period Detection › should limit detected periods to MAX_PERIODS

    expect(received).toHaveLength(expected)

    Matcher error: received value must have a length property whose value must be a number

    Received has value: null

      209 |       });
      210 |
    > 211 |       expect(parsedData).toHaveLength(6); // MAX_PERIODS is 6
          |                          ^
      212 |     });
      213 |   });
      214 |

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:211:26)

  ● Excel Parser Integration Tests › Data Extraction › should extract revenue data correctly

    TypeError: Cannot read properties of null (reading '0')

      237 |       });
      238 |
    > 239 |       expect(parsedData[0].revenue).toBe(1000000);
          |                        ^
      240 |       expect(parsedData[1].revenue).toBe(1100000);
      241 |       expect(parsedData[0].grossMarginPercent).toBe(45);
      242 |       expect(parsedData[0].operatingExpenses).toBe(300000);

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:239:24)

  ● Excel Parser Integration Tests › Data Extraction › should handle working capital days fields

    TypeError: Cannot read properties of null (reading '0')

      266 |       });
      267 |
    > 268 |       expect(parsedData[0].accountsReceivableDays).toBe(45);
          |                        ^
      269 |       expect(parsedData[0].inventoryDays).toBe(30);
      270 |       expect(parsedData[0].accountsPayableDays).toBe(60);
      271 |     });

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:268:24)

  ● Excel Parser Integration Tests › Data Extraction › should handle percentage values correctly

    TypeError: Cannot read properties of null (reading '0')

      295 |       });
      296 |
    > 297 |       expect(parsedData[0].grossMarginPercent).toBe(45); // Converted from 0.45
          |                        ^
      298 |     });
      299 |
      300 |     it('should skip grey-filled cells', async () => {

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:297:24)

  ● Excel Parser Integration Tests › Data Extraction › should skip grey-filled cells

    TypeError: Cannot read properties of null (reading '0')

      325 |       });
      326 |
    > 327 |       expect(parsedData[0].revenue).toBeUndefined(); // Grey cell skipped
          |                        ^
      328 |       expect(parsedData[1].revenue).toBe(1100000);
      329 |     });
      330 |   });

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:327:24)

  ● Excel Parser Integration Tests › Error Handling › should handle empty worksheets

    expect(received).toContain(expected) // indexOf

    Expected substring: "dados encontrados"
    Received string:    "Cannot read properties of undefined (reading 'values')"

      359 |       });
      360 |
    > 361 |       expect(result.current.parsingError).toContain('dados encontrados');
          |                                           ^
      362 |     });
      363 |
      364 |     it('should handle missing required fields', async () => {

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:361:43)

  ● Excel Parser Integration Tests › Error Handling › should handle missing required fields

    TypeError: Cannot read properties of null (reading '0')

      385 |       });
      386 |
    > 387 |       expect(parsedData[0].revenue).toBeUndefined();
          |                        ^
      388 |     });
      389 |   });
      390 |

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:387:24)

  ● Excel Parser Integration Tests › Data Validation › should validate numeric values

    TypeError: Cannot read properties of null (reading '0')

      412 |       });
      413 |
    > 414 |       expect(parsedData[0].revenue).toBeUndefined(); // Invalid value skipped
          |                        ^
      415 |     });
      416 |
      417 |     it('should handle formula results', async () => {

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:414:24)

  ● Excel Parser Integration Tests › Data Validation › should handle formula results

    TypeError: Cannot read properties of null (reading '0')

      439 |       });
      440 |
    > 441 |       expect(parsedData[0].revenue).toBe(1000000); // Extracts result from formula
          |                        ^
      442 |     });
      443 |   });
      444 |

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:441:24)

  ● Excel Parser Integration Tests › Performance Tests › should handle large Excel files efficiently

    expect(received).toHaveLength(expected)

    Matcher error: received value must have a length property whose value must be a number

    Received has value: null

      477 |
      478 |       expect(executionTime).toBeLessThan(5000); // Should complete within 5 seconds
    > 479 |       expect(parsedData).toHaveLength(4);
          |                          ^
      480 |     });
      481 |   });
      482 |

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:479:26)

  ● Excel Parser Integration Tests › Edge Cases › should handle merged cells

    expect(received).toHaveLength(expected)

    Matcher error: received value must have a length property whose value must be a number

    Received has value: null

      503 |       });
      504 |
    > 505 |       expect(parsedData).toHaveLength(2);
          |                          ^
      506 |       expect(parsedData[0].revenue).toBe(1000000);
      507 |       expect(parsedData[1].revenue).toBe(1100000);
      508 |     });

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:505:26)

  ● Excel Parser Integration Tests › Edge Cases › should handle hidden rows and columns

    TypeError: Cannot read properties of null (reading '0')

      533 |
      534 |       // Hidden rows should still be processed in this implementation
    > 535 |       expect(parsedData[0].revenue).toBe(1000000);
          |                        ^
      536 |       expect(parsedData[0].operatingExpenses).toBe(300000);
      537 |     });
      538 |

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:535:24)

  ● Excel Parser Integration Tests › Edge Cases › should handle special characters in field names

    TypeError: Cannot read properties of null (reading '0')

      560 |       });
      561 |
    > 562 |       expect(parsedData[0].revenue).toBe(1000000);
          |                        ^
      563 |       expect(parsedData[0].grossMarginPercent).toBe(45);
      564 |       expect(parsedData[0].depreciation).toBe(20000);
      565 |     });

      at Object.<anonymous> (src/__tests__/integration/excelParser.integration.test.js:562:24)

FAIL src/__tests__/integration/aiService.integration.test.js (5.221 s)
  ● AI Service Integration Tests › API Key Validation › should not require API key for local providers

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:146:20

  ● AI Service Integration Tests › Analysis Types › should handle executive summary analysis

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:163:20

  ● AI Service Integration Tests › Analysis Types › should handle variance analysis

    Falha na análise variance_analysis. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:181:20

  ● AI Service Integration Tests › Analysis Types › should handle financial data extraction from PDF

    Falha na análise financial_data_extraction. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:203:20

  ● AI Service Integration Tests › Analysis Types › should handle risk assessment analysis

    Falha na análise risk_assessment. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:220:20

  ● AI Service Integration Tests › Request Options › should apply temperature settings correctly

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:340:9

  ● AI Service Integration Tests › Request Options › should respect max tokens limit

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:361:9

  ● AI Service Integration Tests › Request Options › should use provider-specific model when specified

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:382:9

  ● AI Service Integration Tests › Analysis History › should track analysis history

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:406:9

  ● AI Service Integration Tests › Analysis History › should provide provider insights

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:433:9

  ● AI Service Integration Tests › Multi-Provider Support › should format requests correctly for different providers

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:456:11

  ● AI Service Integration Tests › Response Validation › should validate and standardize AI responses

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:476:20

  ● AI Service Integration Tests › Response Validation › should handle responses with missing fields

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:504:20

  ● AI Service Integration Tests › Performance and Optimization › should handle concurrent requests

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)

  ● AI Service Integration Tests › Performance and Optimization › should handle concurrent requests

    Falha na análise variance_analysis. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)

  ● AI Service Integration Tests › Performance and Optimization › should handle concurrent requests

    Falha na análise risk_assessment. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)

  ● AI Service Integration Tests › Performance and Optimization › should handle concurrent requests

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)

  ● AI Service Integration Tests › Performance and Optimization › should handle large financial datasets

    Falha na análise executive_summary. Por favor, verifique sua conexão e tente novamente.

      155 |       
      156 |       // Create user-friendly error message without exposing system internals
    > 157 |       const userFriendlyError = new Error(
          |                                 ^
      158 |         `Falha na análise ${analysisType}. Por favor, verifique sua conexão e tente novamente.`
      159 |       );
      160 |       setError(userFriendlyError);

      at Object.callAiAnalysis (src/hooks/useAiService.js:157:33)
      at src/__tests__/integration/aiService.integration.test.js:556:20

FAIL src/components/__tests__/ExcelUploader.test.js (5.87 s)
  ● ExcelUploader Component › File Upload › should handle file selection via input

    TestingLibraryElementError: Unable to find an accessible element with the role "button" and name `/carregar planilha excel/i`

    Here are the accessible roles:

      heading:

      Name "Entrada de Dados via Excel (Upload Adaptativo)":
      [36m<h2[39m
        [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
      [36m/>[39m

      Name "Ou Carregue seu Arquivo Preenchido:":
      [36m<h3[39m
        [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
      [36m/>[39m

      --------------------------------------------------
      button:

      Name "Baixar Modelo Excel":
      [36m<button[39m
        [33mdata-testid[39m=[32m"template-download-button"[39m
      [36m/>[39m

      --------------------------------------------------

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<section[39m
          [33mclass[39m=[32m"mb-8 p-6 bg-white rounded-xl shadow-xl border border-slate-200"[39m
        [36m>[39m
          [36m<h2[39m
            [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
          [36m>[39m
            [0mEntrada de Dados via Excel (Upload Adaptativo)[0m
          [36m</h2>[39m
          [36m<div[39m
            [33mdata-testid[39m=[32m"excel-template-selector"[39m
          [36m>[39m
            [36m<button[39m
              [33mdata-testid[39m=[32m"template-download-button"[39m
            [36m>[39m
              [0mBaixar Modelo Excel[0m
            [36m</button>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-8 border-t border-slate-200 pt-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
            [36m>[39m
              [0mOu Carregue seu Arquivo Preenchido:[0m
            [36m</h3>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex justify-center"[39m
            [36m>[39m
              [36m<label[39m
                [33mclass[39m=[32m"w-full sm:w-auto px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 text-center cursor-pointer"[39m
              [36m>[39m
                [36m<span[39m
                  [33mclass[39m=[32m"flex items-center justify-center"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-5 w-5 mr-2"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [0mCarregar Planilha Excel (.xlsx)[0m
                [36m</span>[39m
                [36m<input[39m
                  [33maccept[39m=[32m".xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"[39m
                  [33mclass[39m=[32m"hidden"[39m
                  [33mtype[39m=[32m"file"[39m
                [36m/>[39m
              [36m</label>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-4 text-center"[39m
          [36m>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-xs text-slate-500 mt-2"[39m
            [36m>[39m
              [0mA plataforma tentará identificar automaticamente o formato do template e o número de períodos do seu arquivo. Recomendamos usar o "Template Inteligente".[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</section>[39m
      [36m</div>[39m
    [36m</body>[39m

      73 |       });
      74 |
    > 75 |       const input = screen.getByRole('button', { name: /carregar planilha excel/i }).querySelector('input');
         |                            ^
      76 |       await user.upload(input, file);
      77 |
      78 |       expect(defaultProps.onFileUpload).toHaveBeenCalledWith(file);

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at getByRole (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19)
      at Object.<anonymous> (src/components/__tests__/ExcelUploader.test.js:75:28)

  ● ExcelUploader Component › File Upload › should clear input after file selection

    TestingLibraryElementError: Unable to find an accessible element with the role "button" and name `/carregar planilha excel/i`

    Here are the accessible roles:

      heading:

      Name "Entrada de Dados via Excel (Upload Adaptativo)":
      [36m<h2[39m
        [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
      [36m/>[39m

      Name "Ou Carregue seu Arquivo Preenchido:":
      [36m<h3[39m
        [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
      [36m/>[39m

      --------------------------------------------------
      button:

      Name "Baixar Modelo Excel":
      [36m<button[39m
        [33mdata-testid[39m=[32m"template-download-button"[39m
      [36m/>[39m

      --------------------------------------------------

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<section[39m
          [33mclass[39m=[32m"mb-8 p-6 bg-white rounded-xl shadow-xl border border-slate-200"[39m
        [36m>[39m
          [36m<h2[39m
            [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
          [36m>[39m
            [0mEntrada de Dados via Excel (Upload Adaptativo)[0m
          [36m</h2>[39m
          [36m<div[39m
            [33mdata-testid[39m=[32m"excel-template-selector"[39m
          [36m>[39m
            [36m<button[39m
              [33mdata-testid[39m=[32m"template-download-button"[39m
            [36m>[39m
              [0mBaixar Modelo Excel[0m
            [36m</button>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-8 border-t border-slate-200 pt-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
            [36m>[39m
              [0mOu Carregue seu Arquivo Preenchido:[0m
            [36m</h3>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex justify-center"[39m
            [36m>[39m
              [36m<label[39m
                [33mclass[39m=[32m"w-full sm:w-auto px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 text-center cursor-pointer"[39m
              [36m>[39m
                [36m<span[39m
                  [33mclass[39m=[32m"flex items-center justify-center"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-5 w-5 mr-2"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [0mCarregar Planilha Excel (.xlsx)[0m
                [36m</span>[39m
                [36m<input[39m
                  [33maccept[39m=[32m".xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"[39m
                  [33mclass[39m=[32m"hidden"[39m
                  [33mtype[39m=[32m"file"[39m
                [36m/>[39m
              [36m</label>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-4 text-center"[39m
          [36m>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-xs text-slate-500 mt-2"[39m
            [36m>[39m
              [0mA plataforma tentará identificar automaticamente o formato do template e o número de períodos do seu arquivo. Recomendamos usar o "Template Inteligente".[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</section>[39m
      [36m</div>[39m
    [36m</body>[39m

      87 |       });
      88 |
    > 89 |       const input = screen.getByRole('button', { name: /carregar planilha excel/i }).querySelector('input');
         |                            ^
      90 |       await user.upload(input, file);
      91 |
      92 |       expect(input.value).toBe('');

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at getByRole (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19)
      at Object.<anonymous> (src/components/__tests__/ExcelUploader.test.js:89:28)

  ● ExcelUploader Component › File Upload › should disable upload when loading

    TestingLibraryElementError: Unable to find an accessible element with the role "button" and name `/carregar planilha excel/i`

    Here are the accessible roles:

      heading:

      Name "Entrada de Dados via Excel (Upload Adaptativo)":
      [36m<h2[39m
        [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
      [36m/>[39m

      Name "Ou Carregue seu Arquivo Preenchido:":
      [36m<h3[39m
        [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
      [36m/>[39m

      --------------------------------------------------
      button:

      Name "Baixar Modelo Excel":
      [36m<button[39m
        [33mdata-testid[39m=[32m"template-download-button"[39m
      [36m/>[39m

      --------------------------------------------------

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<section[39m
          [33mclass[39m=[32m"mb-8 p-6 bg-white rounded-xl shadow-xl border border-slate-200"[39m
        [36m>[39m
          [36m<h2[39m
            [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
          [36m>[39m
            [0mEntrada de Dados via Excel (Upload Adaptativo)[0m
          [36m</h2>[39m
          [36m<div[39m
            [33mdata-testid[39m=[32m"excel-template-selector"[39m
          [36m>[39m
            [36m<button[39m
              [33mdata-testid[39m=[32m"template-download-button"[39m
            [36m>[39m
              [0mBaixar Modelo Excel[0m
            [36m</button>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-8 border-t border-slate-200 pt-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
            [36m>[39m
              [0mOu Carregue seu Arquivo Preenchido:[0m
            [36m</h3>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex justify-center"[39m
            [36m>[39m
              [36m<label[39m
                [33mclass[39m=[32m"w-full sm:w-auto px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 text-center opacity-50 cursor-not-allowed"[39m
              [36m>[39m
                [36m<span[39m
                  [33mclass[39m=[32m"flex items-center justify-center"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-5 w-5 mr-2"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [0mCarregar Planilha Excel (.xlsx)[0m
                [36m</span>[39m
                [36m<input[39m
                  [33maccept[39m=[32m".xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"[39m
                  [33mclass[39m=[32m"hidden"[39m
                  [33mdisabled[39m=[32m""[39m
                  [33mtype[39m=[32m"file"[39m
                [36m/>[39m
              [36m</label>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-4 text-center"[39m
          [36m>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-xs text-slate-500 mt-2"[39m
            [36m>[39m
              [0mA plataforma tentará identificar automaticamente o formato do template e o número de períodos do seu arquivo. Recomendamos usar o "Template Inteligente".[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</section>[39m
      [36m</div>[39m
    [36m</body>[39m

       96 |       render(<ExcelUploader {...defaultProps} isLoading={true} />);
       97 |       
    >  98 |       const input = screen.getByRole('button', { name: /carregar planilha excel/i }).querySelector('input');
          |                            ^
       99 |       expect(input).toBeDisabled();
      100 |     });
      101 |

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at getByRole (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19)
      at Object.<anonymous> (src/components/__tests__/ExcelUploader.test.js:98:28)

  ● ExcelUploader Component › File Upload › should disable upload when ExcelJS is loading

    TestingLibraryElementError: Unable to find an accessible element with the role "button" and name `/carregar planilha excel/i`

    Here are the accessible roles:

      heading:

      Name "Entrada de Dados via Excel (Upload Adaptativo)":
      [36m<h2[39m
        [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
      [36m/>[39m

      Name "Ou Carregue seu Arquivo Preenchido:":
      [36m<h3[39m
        [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
      [36m/>[39m

      --------------------------------------------------
      button:

      Name "Baixar Modelo Excel":
      [36m<button[39m
        [33mdata-testid[39m=[32m"template-download-button"[39m
        [33mdisabled[39m=[32m""[39m
      [36m/>[39m

      --------------------------------------------------

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<section[39m
          [33mclass[39m=[32m"mb-8 p-6 bg-white rounded-xl shadow-xl border border-slate-200"[39m
        [36m>[39m
          [36m<h2[39m
            [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
          [36m>[39m
            [0mEntrada de Dados via Excel (Upload Adaptativo)[0m
          [36m</h2>[39m
          [36m<div[39m
            [33mdata-testid[39m=[32m"excel-template-selector"[39m
          [36m>[39m
            [36m<button[39m
              [33mdata-testid[39m=[32m"template-download-button"[39m
              [33mdisabled[39m=[32m""[39m
            [36m>[39m
              [0mBaixar Modelo Excel[0m
            [36m</button>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-8 border-t border-slate-200 pt-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
            [36m>[39m
              [0mOu Carregue seu Arquivo Preenchido:[0m
            [36m</h3>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex justify-center"[39m
            [36m>[39m
              [36m<label[39m
                [33mclass[39m=[32m"w-full sm:w-auto px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 text-center opacity-50 cursor-not-allowed"[39m
              [36m>[39m
                [36m<span[39m
                  [33mclass[39m=[32m"flex items-center justify-center"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-5 w-5 mr-2"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [0mCarregar Planilha Excel (.xlsx)[0m
                [36m</span>[39m
                [36m<input[39m
                  [33maccept[39m=[32m".xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"[39m
                  [33mclass[39m=[32m"hidden"[39m
                  [33mdisabled[39m=[32m""[39m
                  [33mtype[39m=[32m"file"[39m
                [36m/>[39m
              [36m</label>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-4 text-center"[39m
          [36m>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-xs text-slate-500 mt-2"[39m
            [36m>[39m
              [0mA plataforma tentará identificar automaticamente o formato do template e o número de períodos do seu arquivo. Recomendamos usar o "Template Inteligente".[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</section>[39m
      [36m</div>[39m
    [36m</body>[39m

      103 |       render(<ExcelUploader {...defaultProps} isExcelJsLoading={true} />);
      104 |       
    > 105 |       const input = screen.getByRole('button', { name: /carregar planilha excel/i }).querySelector('input');
          |                            ^
      106 |       expect(input).toBeDisabled();
      107 |     });
      108 |

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at getByRole (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19)
      at Object.<anonymous> (src/components/__tests__/ExcelUploader.test.js:105:28)

  ● ExcelUploader Component › File Upload › should accept Excel file types

    TestingLibraryElementError: Unable to find an accessible element with the role "button" and name `/carregar planilha excel/i`

    Here are the accessible roles:

      heading:

      Name "Entrada de Dados via Excel (Upload Adaptativo)":
      [36m<h2[39m
        [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
      [36m/>[39m

      Name "Ou Carregue seu Arquivo Preenchido:":
      [36m<h3[39m
        [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
      [36m/>[39m

      --------------------------------------------------
      button:

      Name "Baixar Modelo Excel":
      [36m<button[39m
        [33mdata-testid[39m=[32m"template-download-button"[39m
      [36m/>[39m

      --------------------------------------------------

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<section[39m
          [33mclass[39m=[32m"mb-8 p-6 bg-white rounded-xl shadow-xl border border-slate-200"[39m
        [36m>[39m
          [36m<h2[39m
            [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
          [36m>[39m
            [0mEntrada de Dados via Excel (Upload Adaptativo)[0m
          [36m</h2>[39m
          [36m<div[39m
            [33mdata-testid[39m=[32m"excel-template-selector"[39m
          [36m>[39m
            [36m<button[39m
              [33mdata-testid[39m=[32m"template-download-button"[39m
            [36m>[39m
              [0mBaixar Modelo Excel[0m
            [36m</button>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-8 border-t border-slate-200 pt-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
            [36m>[39m
              [0mOu Carregue seu Arquivo Preenchido:[0m
            [36m</h3>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex justify-center"[39m
            [36m>[39m
              [36m<label[39m
                [33mclass[39m=[32m"w-full sm:w-auto px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 text-center cursor-pointer"[39m
              [36m>[39m
                [36m<span[39m
                  [33mclass[39m=[32m"flex items-center justify-center"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-5 w-5 mr-2"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [0mCarregar Planilha Excel (.xlsx)[0m
                [36m</span>[39m
                [36m<input[39m
                  [33maccept[39m=[32m".xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"[39m
                  [33mclass[39m=[32m"hidden"[39m
                  [33mtype[39m=[32m"file"[39m
                [36m/>[39m
              [36m</label>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-4 text-center"[39m
          [36m>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-xs text-slate-500 mt-2"[39m
            [36m>[39m
              [0mA plataforma tentará identificar automaticamente o formato do template e o número de períodos do seu arquivo. Recomendamos usar o "Template Inteligente".[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</section>[39m
      [36m</div>[39m
    [36m</body>[39m

      110 |       render(<ExcelUploader {...defaultProps} />);
      111 |       
    > 112 |       const input = screen.getByRole('button', { name: /carregar planilha excel/i }).querySelector('input');
          |                            ^
      113 |       expect(input).toHaveAttribute('accept', '.xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
      114 |     });
      115 |   });

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at getByRole (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19)
      at Object.<anonymous> (src/components/__tests__/ExcelUploader.test.js:112:28)

  ● ExcelUploader Component › Template Download › should disable template download when processing

    expect(element).toBeDisabled()

    Received element is not disabled:
      <button data-testid="template-download-button" />

      137 |       
      138 |       const downloadButton = screen.getByTestId('template-download-button');
    > 139 |       expect(downloadButton).toBeDisabled();
          |                              ^
      140 |     });
      141 |   });
      142 |

      at Object.<anonymous> (src/components/__tests__/ExcelUploader.test.js:139:30)

  ● ExcelUploader Component › Accessibility › should have accessible file input

    TestingLibraryElementError: Unable to find an accessible element with the role "button" and name `/carregar planilha excel/i`

    Here are the accessible roles:

      heading:

      Name "Entrada de Dados via Excel (Upload Adaptativo)":
      [36m<h2[39m
        [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
      [36m/>[39m

      Name "Ou Carregue seu Arquivo Preenchido:":
      [36m<h3[39m
        [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
      [36m/>[39m

      --------------------------------------------------
      button:

      Name "Baixar Modelo Excel":
      [36m<button[39m
        [33mdata-testid[39m=[32m"template-download-button"[39m
      [36m/>[39m

      --------------------------------------------------

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<section[39m
          [33mclass[39m=[32m"mb-8 p-6 bg-white rounded-xl shadow-xl border border-slate-200"[39m
        [36m>[39m
          [36m<h2[39m
            [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
          [36m>[39m
            [0mEntrada de Dados via Excel (Upload Adaptativo)[0m
          [36m</h2>[39m
          [36m<div[39m
            [33mdata-testid[39m=[32m"excel-template-selector"[39m
          [36m>[39m
            [36m<button[39m
              [33mdata-testid[39m=[32m"template-download-button"[39m
            [36m>[39m
              [0mBaixar Modelo Excel[0m
            [36m</button>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-8 border-t border-slate-200 pt-6"[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-medium text-slate-700 mb-4 text-center"[39m
            [36m>[39m
              [0mOu Carregue seu Arquivo Preenchido:[0m
            [36m</h3>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex justify-center"[39m
            [36m>[39m
              [36m<label[39m
                [33mclass[39m=[32m"w-full sm:w-auto px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 text-center cursor-pointer"[39m
              [36m>[39m
                [36m<span[39m
                  [33mclass[39m=[32m"flex items-center justify-center"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-5 w-5 mr-2"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                  [0mCarregar Planilha Excel (.xlsx)[0m
                [36m</span>[39m
                [36m<input[39m
                  [33maccept[39m=[32m".xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"[39m
                  [33mclass[39m=[32m"hidden"[39m
                  [33mtype[39m=[32m"file"[39m
                [36m/>[39m
              [36m</label>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mt-4 text-center"[39m
          [36m>[39m
            [36m<p[39m
              [33mclass[39m=[32m"text-xs text-slate-500 mt-2"[39m
            [36m>[39m
              [0mA plataforma tentará identificar automaticamente o formato do template e o número de períodos do seu arquivo. Recomendamos usar o "Template Inteligente".[0m
            [36m</p>[39m
          [36m</div>[39m
        [36m</section>[39m
      [36m</div>[39m
    [36m</body>[39m

      175 |       render(<ExcelUploader {...defaultProps} />);
      176 |       
    > 177 |       const input = screen.getByRole('button', { name: /carregar planilha excel/i }).querySelector('input');
          |                            ^
      178 |       expect(input).toHaveAttribute('type', 'file');
      179 |       expect(input).toHaveClass('hidden');
      180 |     });

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at getByRole (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19)
      at Object.<anonymous> (src/components/__tests__/ExcelUploader.test.js:177:28)

FAIL src/__tests__/utils/testUtils.js
  ● Test suite failed to run

    Cannot find module 'react-router-dom' from 'src/__tests__/utils/testUtils.js'

       6 | import React from 'react';
       7 | import { render } from '@testing-library/react';
    >  8 | import { BrowserRouter } from 'react-router-dom';
         | ^
       9 |
      10 | /**
      11 |  * Custom render function that wraps components with necessary providers

      at Resolver.resolveModule (node_modules/jest-resolve/build/resolver.js:324:11)
      at Object.<anonymous> (src/__tests__/utils/testUtils.js:8:1)

FAIL src/components/__tests__/ManualDataEntry.test.js (6.31 s)
  ● ManualDataEntry Component › User Interactions › should handle period type change

    TestingLibraryElementError: Value "QUARTERLY" not found in options

    Ignored nodes: comments, script, style
    [36m<select[39m
      [33mclass[39m=[32m"w-full p-2.5 border border-slate-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"[39m
      [33mid[39m=[32m"periodTypeEntry"[39m
    [36m>[39m
      [36m<option[39m
        [33mvalue[39m=[32m"anos"[39m
      [36m>[39m
        [0mAnos[0m
      [36m</option>[39m
      [36m<option[39m
        [33mvalue[39m=[32m"trimestres"[39m
      [36m>[39m
        [0mTrimestres[0m
      [36m</option>[39m
      [36m<option[39m
        [33mvalue[39m=[32m"meses"[39m
      [36m>[39m
        [0mMeses[0m
      [36m</option>[39m
    [36m</select>[39m

      73 |       
      74 |       const typeSelect = screen.getByLabelText(/Tipo de Período/i);
    > 75 |       await user.selectOptions(typeSelect, 'QUARTERLY');
         |                  ^
      76 |       
      77 |       expect(defaultProps.onPeriodTypeChange).toHaveBeenCalledWith('QUARTERLY');
      78 |     });

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/user-event/dist/cjs/utility/selectOptions.js:39:39
          at Array.map (<anonymous>)
      at Object.selectOptionsBase (node_modules/@testing-library/user-event/dist/cjs/utility/selectOptions.js:31:38)
      at Object.selectOptions (node_modules/@testing-library/user-event/dist/cjs/utility/selectOptions.js:18:30)
      at node_modules/@testing-library/user-event/dist/cjs/setup/setup.js:85:45
      at Object.asyncWrapper (node_modules/@testing-library/dom/dist/config.js:23:23)
      at Object.wrapAsync (node_modules/@testing-library/user-event/dist/cjs/setup/wrapAsync.js:8:28)
      at Object.selectOptions (node_modules/@testing-library/user-event/dist/cjs/setup/setup.js:85:26)
      at Object.<anonymous> (src/components/__tests__/ManualDataEntry.test.js:75:18)

  ● ManualDataEntry Component › Submit functionality › should show loading state

    TestingLibraryElementError: Found multiple elements with the role "button"

    Here are the matching elements:

    Ignored nodes: comments, script, style
    [36m<button[39m
      [33mclass[39m=[32m"flex items-center justify-between w-full p-3 bg-sky-100 hover:bg-sky-200 rounded-lg transition-colors mb-3 shadow-sm"[39m
      [33mtype[39m=[32m"button"[39m
    [36m>[39m
      [36m<div[39m
        [33mclass[39m=[32m"flex items-center space-x-2"[39m
      [36m>[39m
        [36m<span[39m
          [33mclass[39m=[32m"text-lg font-medium text-sky-700"[39m
        [36m>[39m
          [0m�� DRE - Itens de Resultado (Overrides Opcionais)[0m
        [36m</span>[39m
        [36m<span[39m
          [33mclass[39m=[32m"text-xs bg-sky-200 text-sky-800 px-2 py-0.5 rounded-full"[39m
        [36m>[39m
          [0mOpcional Avançado[0m
        [36m</span>[39m
      [36m</div>[39m
      [36m<div[39m
        [33mclass[39m=[32m"flex items-center space-x-2"[39m
      [36m>[39m
        [36m<svg[39m
          [33mclass[39m=[32m"w-5 h-5 text-sky-600 transition-transform "[39m
          [33mfill[39m=[32m"none"[39m
          [33mstroke[39m=[32m"currentColor"[39m
          [33mviewBox[39m=[32m"0 0 24 24"[39m
        [36m>[39m
          [36m<path[39m
            [33md[39m=[32m"M19 9l-7 7-7-7"[39m
            [33mstroke-linecap[39m=[32m"round"[39m
            [33mstroke-linejoin[39m=[32m"round"[39m
            [33mstroke-width[39m=[32m"2"[39m
          [36m/>[39m
        [36m</svg>[39m
      [36m</div>[39m
    [36m</button>[39m

    Ignored nodes: comments, script, style
    [36m<button[39m
      [33mclass[39m=[32m"flex items-center justify-between w-full p-3 bg-sky-100 hover:bg-sky-200 rounded-lg transition-colors mb-3 shadow-sm"[39m
      [33mtype[39m=[32m"button"[39m
    [36m>[39m
      [36m<div[39m
        [33mclass[39m=[32m"flex items-center space-x-2"[39m
      [36m>[39m
        [36m<span[39m
          [33mclass[39m=[32m"text-lg font-medium text-sky-700"[39m
        [36m>[39m
          [0m�� Balanço Patrimonial (Overrides Opcionais)[0m
        [36m</span>[39m
        [36m<span[39m
          [33mclass[39m=[32m"text-xs bg-sky-200 text-sky-800 px-2 py-0.5 rounded-full"[39m
        [36m>[39m
          [0mOpcional Avançado[0m
        [36m</span>[39m
      [36m</div>[39m
      [36m<div[39m
        [33mclass[39m=[32m"flex items-center space-x-2"[39m
      [36m>[39m
        [36m<svg[39m
          [33mclass[39m=[32m"w-5 h-5 text-sky-600 transition-transform "[39m
          [33mfill[39m=[32m"none"[39m
          [33mstroke[39m=[32m"currentColor"[39m
          [33mviewBox[39m=[32m"0 0 24 24"[39m
        [36m>[39m
          [36m<path[39m
            [33md[39m=[32m"M19 9l-7 7-7-7"[39m
            [33mstroke-linecap[39m=[32m"round"[39m
            [33mstroke-linejoin[39m=[32m"round"[39m
            [33mstroke-width[39m=[32m"2"[39m
          [36m/>[39m
        [36m</svg>[39m
      [36m</div>[39m
    [36m</button>[39m

    Ignored nodes: comments, script, style
    [36m<button[39m
      [33mclass[39m=[32m"flex items-center justify-between w-full p-3 bg-sky-100 hover:bg-sky-200 rounded-lg transition-colors mb-3 shadow-sm"[39m
      [33mtype[39m=[32m"button"[39m
    [36m>[39m
      [36m<div[39m
        [33mclass[39m=[32m"flex items-center space-x-2"[39m
      [36m>[39m
        [36m<span[39m
          [33mclass[39m=[32m"text-lg font-medium text-sky-700"[39m
        [36m>[39m
          [0m�� Fluxo de Caixa (Overrides Opcionais)[0m
        [36m</span>[39m
        [36m<span[39m
          [33mclass[39m=[32m"text-xs bg-sky-200 text-sky-800 px-2 py-0.5 rounded-full"[39m
        [36m>[39m
          [0mOpcional Avançado[0m
        [36m</span>[39m
      [36m</div>[39m
      [36m<div[39m
        [33mclass[39m=[32m"flex items-center space-x-2"[39m
      [36m>[39m
        [36m<svg[39m
          [33mclass[39m=[32m"w-5 h-5 text-sky-600 transition-transform "[39m
          [33mfill[39m=[32m"none"[39m
          [33mstroke[39m=[32m"currentColor"[39m
          [33mviewBox[39m=[32m"0 0 24 24"[39m
        [36m>[39m
          [36m<path[39m
            [33md[39m=[32m"M19 9l-7 7-7-7"[39m
            [33mstroke-linecap[39m=[32m"round"[39m
            [33mstroke-linejoin[39m=[32m"round"[39m
            [33mstroke-width[39m=[32m"2"[39m
          [36m/>[39m
        [36m</svg>[39m
      [36m</div>[39m
    [36m</button>[39m

    Ignored nodes: comments, script, style
    [36m<button[39m
      [33mclass[39m=[32m"px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 disabled:opacity-50 disabled:cursor-not-allowed"[39m
      [33mdisabled[39m=[32m""[39m
    [36m>[39m
      [36m<div[39m
        [33mclass[39m=[32m"flex items-center justify-center space-x-2"[39m
      [36m>[39m
        [36m<svg[39m
          [33mclass[39m=[32m"animate-spin h-4 w-4 text-white"[39m
          [33mfill[39m=[32m"none"[39m
          [33mviewBox[39m=[32m"0 0 24 24"[39m
          [33mxmlns[39m=[32m"http://www.w3.org/2000/svg"[39m
        [36m>[39m
          [36m<circle[39m
            [33mclass[39m=[32m"opacity-25"[39m
            [33mcx[39m=[32m"12"[39m
            [33mcy[39m=[32m"12"[39m
            [33mr[39m=[32m"10"[39m
            [33mstroke[39m=[32m"currentColor"[39m
            [33mstroke-width[39m=[32m"4"[39m
          [36m/>[39m
          [36m<path[39m
            [33mclass[39m=[32m"opacity-75"[39m
            [33md[39m=[32m"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"[39m
            [33mfill[39m=[32m"currentColor"[39m
          [36m/>[39m
        [36m</svg>[39m
        [36m<span>[39m
          [0mProcessando...[0m
        [36m</span>[39m
      [36m</div>[39m
    [36m</button>[39m

    (If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<section[39m
          [33mclass[39m=[32m"mb-8 p-6 bg-white rounded-xl shadow-lg border border-slate-200"[39m
        [36m>[39m
          [36m<h2[39m
            [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
          [36m>[39m
            [0mEntrada Manual de Dados - Modo Adaptativo[0m
          [36m</h2>[39m
          [36m<div[39m
            [33mclass[39m=[32m"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"[39m
          [36m>[39m
            [36m<div>[39m
              [36m<label[39m
                [33mclass[39m=[32m"block text-sm font-medium text-slate-700 mb-1"[39m
                [33mfor[39m=[32m"numberOfPeriodsEntry"[39m
              [36m>[39m
                [0mNúmero de Períodos ([0m
                [0m2[0m
                [0m-[0m
                [0m6[0m
                [0m):[0m
              [36m</label>[39m
              [36m<select[39m
                [33mclass[39m=[32m"w-full p-2.5 border border-slate-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"[39m
                [33mid[39m=[32m"numberOfPeriodsEntry"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"2"[39m
                [36m>[39m
                  [0m2[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"3"[39m
                [36m>[39m
                  [0m3[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"4"[39m
                [36m>[39m
                  [0m4[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"5"[39m
                [36m>[39m
                  [0m5[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"6"[39m
                [36m>[39m
                  [0m6[0m
                  [0m Períodos[0m
                [36m</option>[39m
              [36m</select>[39m
            [36m</div>[39m
            [36m<div>[39m
              [36m<label[39m
                [33mclass[39m=[32m"block text-sm font-medium text-slate-700 mb-1"[39m
                [33mfor[39m=[32m"periodTypeEntry"[39m
              [36m>[39m
                [0mTipo de Período:[0m
              [36m</label>[39m
              [36m<select[39m
                [33mclass[39m=[32m"w-full p-2.5 border border-slate-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"[39m
                [33mid[39m=[32m"periodTypeEntry"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"anos"[39m
                [36m>[39m
                  [0mAnos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"trimestres"[39m
                [36m>[39m
                  [0mTrimestres[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"meses"[39m
                [36m>[39m
                  [0mMeses[0m
                [36m</option>[39m
              [36m</select>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"bg-sky-50 p-4 rounded-lg mb-6 border border-sky-200 text-sm text-sky-700"[39m
          [36m>[39m
            [36m<h4[39m
              [33mclass[39m=[32m"font-semibold text-sky-800 mb-2 flex items-center"[39m
            [36m>[39m
              [36m<span[39m
                [33mclass[39m=[32m"text-lg mr-2"[39m
              [36m>[39m
                [0m��[0m
              [36m</span>[39m
              [0m Como Funciona o Modo Adaptativo:[0m
            [36m</h4>[39m
            [36m<ul[39m
              [33mclass[39m=[32m"list-disc list-inside space-y-1 pl-2"[39m
            [36m>[39m
              [36m<li>[39m
                [0mPreencha os **Dados Principais / Drivers** para que o sistema calcule automaticamente as demonstrações.[0m
              [36m</li>[39m
              [36m<li>[39m
                [0mSe possuir valores reais para itens específicos da DRE, Balanço ou Fluxo de Caixa, expanda as seções de **Overrides Opcionais** e insira esses valores.[0m
              [36m</li>[39m
              [36m<li>[39m
                [0mValores inseridos nos campos de **Override (��)** terão prioridade sobre os cálculos automáticos do sistema para aquele item específico.[0m
              [36m</li>[39m
              [36m<li>[39m
                [0mA "Diferença de Balanço" e as "Validações de Dados" ajudarão a identificar possíveis inconsistências.[0m
              [36m</li>[39m
            [36m</ul>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mb-6 "[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-semibold text-slate-700 mb-4"[39m
            [36m>[39m
              [0m�� Dados Principais / Drivers Essenciais[0m
            [36m</h3>[39m
            [36m<div[39m
              [33mclass[39m=[32m"overflow-x-auto border border-slate-300 rounded-lg mt-2 animation-fade-in"[39m
            [36m>[39m
              [36m<table[39m
                [33mclass[39m=[32m"min-w-full border-collapse"[39m
              [36m>[39m
                [36m<thead>[39m
                  [36m<tr[39m
                    [33mclass[39m=[32m"bg-slate-100"[39m
                  [36m>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-left text-sm font-semibold text-slate-700 sticky left-0 bg-slate-100 z-10 min-w-[250px] md:min-w-[300px]"[39m
                    [36m>[39m
                      [0mItem Financeiro[0m
                    [36m</th>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-center text-sm font-semibold text-slate-700 min-w-[120px]"[39m
                    [36m>[39m
                      [0mPeríodo [0m
                      [0m1[0m
                      [36m<span[39m
                        [33mclass[39m=[32m"font-normal text-xs block"[39m
                      [36m>[39m
                        [0m([0m
                        [0mMONTHLY[0m
                        [0m)[0m
                      [36m</span>[39m
                    [36m</th>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-center text-sm font-semibold text-slate-700 min-w-[120px]"[39m
                    [36m>[39m
                      [0mPeríodo [0m
                      [0m2[0m
                      [36m<span[39m
                        [33mclass[39m=[32m"font-normal text-xs block"[39m
                      [36m>[39m
                        [0m([0m
                        [0mMONTHLY[0m
                        [0m)[0m
                      [36m</span>[39m
                    [36m</th>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-center text-sm font-semibold text-slate-700 min-w-[120px]"[39m
                   ...

      108 |       
      109 |       expect(screen.getByText('Processando...')).toBeInTheDocument();
    > 110 |       expect(screen.getByRole('button')).toBeDisabled();
          |                     ^
      111 |     });
      112 |   });
      113 |

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:20:35)
      at getMultipleElementsFoundError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:23:10)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:55:13
      at getByRole (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19)
      at Object.<anonymous> (src/components/__tests__/ManualDataEntry.test.js:110:21)

  ● ManualDataEntry Component › Override sections › should render override sections as collapsed by default

    TestingLibraryElementError: Found multiple elements with the text: /Fluxo de Caixa/

    Here are the matching elements:

    Ignored nodes: comments, script, style
    [36m<li>[39m
      [0mSe possuir valores reais para itens específicos da DRE, Balanço ou Fluxo de Caixa, expanda as seções de **Overrides Opcionais** e insira esses valores.[0m
    [36m</li>[39m

    Ignored nodes: comments, script, style
    [36m<span[39m
      [33mclass[39m=[32m"text-lg font-medium text-sky-700"[39m
    [36m>[39m
      [0m�� Fluxo de Caixa (Overrides Opcionais)[0m
    [36m</span>[39m

    (If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<section[39m
          [33mclass[39m=[32m"mb-8 p-6 bg-white rounded-xl shadow-lg border border-slate-200"[39m
        [36m>[39m
          [36m<h2[39m
            [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
          [36m>[39m
            [0mEntrada Manual de Dados - Modo Adaptativo[0m
          [36m</h2>[39m
          [36m<div[39m
            [33mclass[39m=[32m"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"[39m
          [36m>[39m
            [36m<div>[39m
              [36m<label[39m
                [33mclass[39m=[32m"block text-sm font-medium text-slate-700 mb-1"[39m
                [33mfor[39m=[32m"numberOfPeriodsEntry"[39m
              [36m>[39m
                [0mNúmero de Períodos ([0m
                [0m2[0m
                [0m-[0m
                [0m6[0m
                [0m):[0m
              [36m</label>[39m
              [36m<select[39m
                [33mclass[39m=[32m"w-full p-2.5 border border-slate-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"[39m
                [33mid[39m=[32m"numberOfPeriodsEntry"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"2"[39m
                [36m>[39m
                  [0m2[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"3"[39m
                [36m>[39m
                  [0m3[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"4"[39m
                [36m>[39m
                  [0m4[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"5"[39m
                [36m>[39m
                  [0m5[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"6"[39m
                [36m>[39m
                  [0m6[0m
                  [0m Períodos[0m
                [36m</option>[39m
              [36m</select>[39m
            [36m</div>[39m
            [36m<div>[39m
              [36m<label[39m
                [33mclass[39m=[32m"block text-sm font-medium text-slate-700 mb-1"[39m
                [33mfor[39m=[32m"periodTypeEntry"[39m
              [36m>[39m
                [0mTipo de Período:[0m
              [36m</label>[39m
              [36m<select[39m
                [33mclass[39m=[32m"w-full p-2.5 border border-slate-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"[39m
                [33mid[39m=[32m"periodTypeEntry"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"anos"[39m
                [36m>[39m
                  [0mAnos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"trimestres"[39m
                [36m>[39m
                  [0mTrimestres[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"meses"[39m
                [36m>[39m
                  [0mMeses[0m
                [36m</option>[39m
              [36m</select>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"bg-sky-50 p-4 rounded-lg mb-6 border border-sky-200 text-sm text-sky-700"[39m
          [36m>[39m
            [36m<h4[39m
              [33mclass[39m=[32m"font-semibold text-sky-800 mb-2 flex items-center"[39m
            [36m>[39m
              [36m<span[39m
                [33mclass[39m=[32m"text-lg mr-2"[39m
              [36m>[39m
                [0m��[0m
              [36m</span>[39m
              [0m Como Funciona o Modo Adaptativo:[0m
            [36m</h4>[39m
            [36m<ul[39m
              [33mclass[39m=[32m"list-disc list-inside space-y-1 pl-2"[39m
            [36m>[39m
              [36m<li>[39m
                [0mPreencha os **Dados Principais / Drivers** para que o sistema calcule automaticamente as demonstrações.[0m
              [36m</li>[39m
              [36m<li>[39m
                [0mSe possuir valores reais para itens específicos da DRE, Balanço ou Fluxo de Caixa, expanda as seções de **Overrides Opcionais** e insira esses valores.[0m
              [36m</li>[39m
              [36m<li>[39m
                [0mValores inseridos nos campos de **Override (��)** terão prioridade sobre os cálculos automáticos do sistema para aquele item específico.[0m
              [36m</li>[39m
              [36m<li>[39m
                [0mA "Diferença de Balanço" e as "Validações de Dados" ajudarão a identificar possíveis inconsistências.[0m
              [36m</li>[39m
            [36m</ul>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mb-6 "[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-semibold text-slate-700 mb-4"[39m
            [36m>[39m
              [0m�� Dados Principais / Drivers Essenciais[0m
            [36m</h3>[39m
            [36m<div[39m
              [33mclass[39m=[32m"overflow-x-auto border border-slate-300 rounded-lg mt-2 animation-fade-in"[39m
            [36m>[39m
              [36m<table[39m
                [33mclass[39m=[32m"min-w-full border-collapse"[39m
              [36m>[39m
                [36m<thead>[39m
                  [36m<tr[39m
                    [33mclass[39m=[32m"bg-slate-100"[39m
                  [36m>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-left text-sm font-semibold text-slate-700 sticky left-0 bg-slate-100 z-10 min-w-[250px] md:min-w-[300px]"[39m
                    [36m>[39m
                      [0mItem Financeiro[0m
                    [36m</th>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-center text-sm font-semibold text-slate-700 min-w-[120px]"[39m
                    [36m>[39m
                      [0mPeríodo [0m
                      [0m1[0m
                      [36m<span[39m
                        [33mclass[39m=[32m"font-normal text-xs block"[39m
                      [36m>[39m
                        [0m([0m
                        [0mMONTHLY[0m
                        [0m)[0m
                      [36m</span>[39m
                    [36m</th>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-center text-sm font-semibold text-slate-700 min-w-[120px]"[39m
                    [36m>[39m
                      [0mPeríodo [0m
                      [0m2[0m
                      [36m<span[39m
                        [33mclass[39m=[32m"font-normal text-xs block"[39m
                      [36m>[39m
                        [0m([0m
                        [0mMONTHLY[0m
                        [0m)[0m
                      [36m</span>[39m
                    [36m</th>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-center text-sm font-semibold text-slate-700 min-w-[120px]"[39m
                   ...

      118 |       expect(screen.getByText(/DRE - Itens de Resultado/)).toBeInTheDocument();
      119 |       expect(screen.getByText(/Balanço Patrimonial/)).toBeInTheDocument();
    > 120 |       expect(screen.getByText(/Fluxo de Caixa/)).toBeInTheDocument();
          |                     ^
      121 |     });
      122 |
      123 |     it('should expand override sections when clicked', async () => {

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:20:35)
      at getMultipleElementsFoundError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:23:10)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:55:13
      at getByText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19)
      at Object.<anonymous> (src/components/__tests__/ManualDataEntry.test.js:120:21)

  ● ManualDataEntry Component › Override sections › should expand override sections when clicked

    TestingLibraryElementError: Found multiple elements with the text: /Override/

    Here are the matching elements:

    Ignored nodes: comments, script, style
    [36m<li>[39m
      [0mSe possuir valores reais para itens específicos da DRE, Balanço ou Fluxo de Caixa, expanda as seções de **Overrides Opcionais** e insira esses valores.[0m
    [36m</li>[39m

    Ignored nodes: comments, script, style
    [36m<li>[39m
      [0mValores inseridos nos campos de **Override (��)** terão prioridade sobre os cálculos automáticos do sistema para aquele item específico.[0m
    [36m</li>[39m

    Ignored nodes: comments, script, style
    [36m<span[39m
      [33mclass[39m=[32m"text-lg font-medium text-sky-700"[39m
    [36m>[39m
      [0m�� DRE - Itens de Resultado (Overrides Opcionais)[0m
    [36m</span>[39m

    Ignored nodes: comments, script, style
    [36m<th[39m
      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-left text-sm font-semibold text-slate-700 sticky left-0 bg-slate-100 z-10 min-w-[250px] md:min-w-[300px]"[39m
    [36m>[39m
      [0m�� Item Financeiro (Override)[0m
    [36m</th>[39m

    Ignored nodes: comments, script, style
    [36m<div[39m
      [33mclass[39m=[32m"font-medium"[39m
    [36m>[39m
      [0m�� CPV/CSV (Override)[0m
    [36m</div>[39m

    Ignored nodes: comments, script, style
    [36m<div[39m
      [33mclass[39m=[32m"font-medium"[39m
    [36m>[39m
      [0m�� Lucro Bruto (Override)[0m
    [36m</div>[39m

    Ignored nodes: comments, script, style
    [36m<div[39m
      [33mclass[39m=[32m"font-medium"[39m
    [36m>[39m
      [0m�� EBITDA (Override)[0m
    [36m</div>[39m

    Ignored nodes: comments, script, style
    [36m<div[39m
      [33mclass[39m=[32m"font-medium"[39m
    [36m>[39m
      [0m�� EBIT (Override)[0m
    [36m</div>[39m

    Ignored nodes: comments, script, style
    [36m<div[39m
      [33mclass[39m=[32m"font-medium"[39m
    [36m>[39m
      [0m�� LAIR/PBT (Override)[0m
    [36m</div>[39m

    Ignored nodes: comments, script, style
    [36m<div[39m
      [33mclass[39m=[32m"font-medium"[39m
    [36m>[39m
      [0m�� Imposto de Renda (Override)[0m
    [36m</div>[39m

    Ignored nodes: comments, script, style
    [36m<div[39m
      [33mclass[39m=[32m"font-medium"[39m
    [36m>[39m
      [0m�� Lucro Líquido (Override)[0m
    [36m</div>[39m

    Ignored nodes: comments, script, style
    [36m<span[39m
      [33mclass[39m=[32m"text-lg font-medium text-sky-700"[39m
    [36m>[39m
      [0m�� Balanço Patrimonial (Overrides Opcionais)[0m
    [36m</span>[39m

    Ignored nodes: comments, script, style
    [36m<span[39m
      [33mclass[39m=[32m"text-lg font-medium text-sky-700"[39m
    [36m>[39m
      [0m�� Fluxo de Caixa (Overrides Opcionais)[0m
    [36m</span>[39m

    (If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<section[39m
          [33mclass[39m=[32m"mb-8 p-6 bg-white rounded-xl shadow-lg border border-slate-200"[39m
        [36m>[39m
          [36m<h2[39m
            [33mclass[39m=[32m"text-xl font-semibold text-slate-700 mb-6 text-center"[39m
          [36m>[39m
            [0mEntrada Manual de Dados - Modo Adaptativo[0m
          [36m</h2>[39m
          [36m<div[39m
            [33mclass[39m=[32m"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"[39m
          [36m>[39m
            [36m<div>[39m
              [36m<label[39m
                [33mclass[39m=[32m"block text-sm font-medium text-slate-700 mb-1"[39m
                [33mfor[39m=[32m"numberOfPeriodsEntry"[39m
              [36m>[39m
                [0mNúmero de Períodos ([0m
                [0m2[0m
                [0m-[0m
                [0m6[0m
                [0m):[0m
              [36m</label>[39m
              [36m<select[39m
                [33mclass[39m=[32m"w-full p-2.5 border border-slate-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"[39m
                [33mid[39m=[32m"numberOfPeriodsEntry"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"2"[39m
                [36m>[39m
                  [0m2[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"3"[39m
                [36m>[39m
                  [0m3[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"4"[39m
                [36m>[39m
                  [0m4[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"5"[39m
                [36m>[39m
                  [0m5[0m
                  [0m Períodos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"6"[39m
                [36m>[39m
                  [0m6[0m
                  [0m Períodos[0m
                [36m</option>[39m
              [36m</select>[39m
            [36m</div>[39m
            [36m<div>[39m
              [36m<label[39m
                [33mclass[39m=[32m"block text-sm font-medium text-slate-700 mb-1"[39m
                [33mfor[39m=[32m"periodTypeEntry"[39m
              [36m>[39m
                [0mTipo de Período:[0m
              [36m</label>[39m
              [36m<select[39m
                [33mclass[39m=[32m"w-full p-2.5 border border-slate-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"[39m
                [33mid[39m=[32m"periodTypeEntry"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"anos"[39m
                [36m>[39m
                  [0mAnos[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"trimestres"[39m
                [36m>[39m
                  [0mTrimestres[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"meses"[39m
                [36m>[39m
                  [0mMeses[0m
                [36m</option>[39m
              [36m</select>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"bg-sky-50 p-4 rounded-lg mb-6 border border-sky-200 text-sm text-sky-700"[39m
          [36m>[39m
            [36m<h4[39m
              [33mclass[39m=[32m"font-semibold text-sky-800 mb-2 flex items-center"[39m
            [36m>[39m
              [36m<span[39m
                [33mclass[39m=[32m"text-lg mr-2"[39m
              [36m>[39m
                [0m��[0m
              [36m</span>[39m
              [0m Como Funciona o Modo Adaptativo:[0m
            [36m</h4>[39m
            [36m<ul[39m
              [33mclass[39m=[32m"list-disc list-inside space-y-1 pl-2"[39m
            [36m>[39m
              [36m<li>[39m
                [0mPreencha os **Dados Principais / Drivers** para que o sistema calcule automaticamente as demonstrações.[0m
              [36m</li>[39m
              [36m<li>[39m
                [0mSe possuir valores reais para itens específicos da DRE, Balanço ou Fluxo de Caixa, expanda as seções de **Overrides Opcionais** e insira esses valores.[0m
              [36m</li>[39m
              [36m<li>[39m
                [0mValores inseridos nos campos de **Override (��)** terão prioridade sobre os cálculos automáticos do sistema para aquele item específico.[0m
              [36m</li>[39m
              [36m<li>[39m
                [0mA "Diferença de Balanço" e as "Validações de Dados" ajudarão a identificar possíveis inconsistências.[0m
              [36m</li>[39m
            [36m</ul>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mb-6 "[39m
          [36m>[39m
            [36m<h3[39m
              [33mclass[39m=[32m"text-lg font-semibold text-slate-700 mb-4"[39m
            [36m>[39m
              [0m�� Dados Principais / Drivers Essenciais[0m
            [36m</h3>[39m
            [36m<div[39m
              [33mclass[39m=[32m"overflow-x-auto border border-slate-300 rounded-lg mt-2 animation-fade-in"[39m
            [36m>[39m
              [36m<table[39m
                [33mclass[39m=[32m"min-w-full border-collapse"[39m
              [36m>[39m
                [36m<thead>[39m
                  [36m<tr[39m
                    [33mclass[39m=[32m"bg-slate-100"[39m
                  [36m>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-left text-sm font-semibold text-slate-700 sticky left-0 bg-slate-100 z-10 min-w-[250px] md:min-w-[300px]"[39m
                    [36m>[39m
                      [0mItem Financeiro[0m
                    [36m</th>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-center text-sm font-semibold text-slate-700 min-w-[120px]"[39m
                    [36m>[39m
                      [0mPeríodo [0m
                      [0m1[0m
                      [36m<span[39m
                        [33mclass[39m=[32m"font-normal text-xs block"[39m
                      [36m>[39m
                        [0m([0m
                        [0mMONTHLY[0m
                        [0m)[0m
                      [36m</span>[39m
                    [36m</th>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-center text-sm font-semibold text-slate-700 min-w-[120px]"[39m
                    [36m>[39m
                      [0mPeríodo [0m
                      [0m2[0m
                      [36m<span[39m
                        [33mclass[39m=[32m"font-normal text-xs block"[39m
                      [36m>[39m
                        [0m([0m
                        [0mMONTHLY[0m
                        [0m)[0m
                      [36m</span>[39m
                    [36m</th>[39m
                    [36m<th[39m
                      [33mclass[39m=[32m"p-3 border-x border-slate-300 text-center text-sm font-semibold text-slate-700 min-w-[120px]"[39m
                   ...

      129 |       
      130 |       // Section should expand and show additional content
    > 131 |       expect(screen.getByText(/Override/)).toBeInTheDocument();
          |                     ^
      132 |     });
      133 |   });
      134 | });

      at Object.getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/config.js:37:19)
      at getElementError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:20:35)
      at getMultipleElementsFoundError (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:23:10)
      at node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:55:13
      at getByText (node_modules/@testing-library/react/node_modules/@testing-library/dom/dist/query-helpers.js:95:19)
      at Object.<anonymous> (src/components/__tests__/ManualDataEntry.test.js:131:21)

FAIL src/components/__tests__/Charts.test.js
  ● Test suite failed to run

    Cannot find module '../Charts' from 'src/components/__tests__/Charts.test.js'

       7 | import { render, screen, fireEvent, waitFor } from '@testing-library/react';
       8 | import userEvent from '@testing-library/user-event';
    >  9 | import { 
         | ^
      10 |   CashFlowWaterfallChart,
      11 |   ProfitWaterfallChart,
      12 |   FundingStructureChart,

      at Resolver.resolveModule (node_modules/jest-resolve/build/resolver.js:324:11)
      at Object.<anonymous> (src/components/__tests__/Charts.test.js:9:1)

FAIL src/__tests__/integration/phase2-components.integration.test.js (7.28 s)
  ● Phase 2 Components Integration Tests › ReportGeneratorApp Integration › App renders without crashing

    useStorage must be used within StorageProvider

      17 |   const context = useContext(StorageContext);
      18 |   if (!context) {
    > 19 |     throw new Error('useStorage must be used within StorageProvider');
         |           ^
      20 |   }
      21 |   return context;
      22 | };

      at useStorage (src/context/StorageContext.jsx:19:11)
      at ReportGeneratorApp (src/components/ReportGeneratorApp.jsx:120:92)
      at renderWithHooks (node_modules/react-dom/cjs/react-dom.development.js:15486:18)
      at mountIndeterminateComponent (node_modules/react-dom/cjs/react-dom.development.js:20103:13)
      at beginWork (node_modules/react-dom/cjs/react-dom.development.js:21626:16)
      at beginWork$1 (node_modules/react-dom/cjs/react-dom.development.js:27465:14)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26599:12)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26505:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26473:7)
      at recoverFromConcurrentError (node_modules/react-dom/cjs/react-dom.development.js:25889:20)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25789:22)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/__tests__/integration/phase2-components.integration.test.js:327:13)

  ● Phase 2 Components Integration Tests › ReportGeneratorApp Integration › App switches between input methods correctly

    useStorage must be used within StorageProvider

      17 |   const context = useContext(StorageContext);
      18 |   if (!context) {
    > 19 |     throw new Error('useStorage must be used within StorageProvider');
         |           ^
      20 |   }
      21 |   return context;
      22 | };

      at useStorage (src/context/StorageContext.jsx:19:11)
      at ReportGeneratorApp (src/components/ReportGeneratorApp.jsx:120:92)
      at renderWithHooks (node_modules/react-dom/cjs/react-dom.development.js:15486:18)
      at mountIndeterminateComponent (node_modules/react-dom/cjs/react-dom.development.js:20103:13)
      at beginWork (node_modules/react-dom/cjs/react-dom.development.js:21626:16)
      at beginWork$1 (node_modules/react-dom/cjs/react-dom.development.js:27465:14)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26599:12)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26505:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26473:7)
      at recoverFromConcurrentError (node_modules/react-dom/cjs/react-dom.development.js:25889:20)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25789:22)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/__tests__/integration/phase2-components.integration.test.js:334:13)

  ● Phase 2 Components Integration Tests › ReportGeneratorApp Integration › App maintains state consistency across method switches

    useStorage must be used within StorageProvider

      17 |   const context = useContext(StorageContext);
      18 |   if (!context) {
    > 19 |     throw new Error('useStorage must be used within StorageProvider');
         |           ^
      20 |   }
      21 |   return context;
      22 | };

      at useStorage (src/context/StorageContext.jsx:19:11)
      at ReportGeneratorApp (src/components/ReportGeneratorApp.jsx:120:92)
      at renderWithHooks (node_modules/react-dom/cjs/react-dom.development.js:15486:18)
      at mountIndeterminateComponent (node_modules/react-dom/cjs/react-dom.development.js:20103:13)
      at beginWork (node_modules/react-dom/cjs/react-dom.development.js:21626:16)
      at beginWork$1 (node_modules/react-dom/cjs/react-dom.development.js:27465:14)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26599:12)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26505:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26473:7)
      at recoverFromConcurrentError (node_modules/react-dom/cjs/react-dom.development.js:25889:20)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25789:22)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at actWithWarning (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1740:10)
      at node_modules/@testing-library/react/dist/act-compat.js:63:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:159:26)
      at render (node_modules/@testing-library/react/dist/pure.js:246:10)
      at Object.<anonymous> (src/__tests__/integration/phase2-components.integration.test.js:349:13)

FAIL src/__tests__/integration/aiProviders.integration.test.js (83.425 s)
  ● AI Providers Integration Tests › Timeout Handling › OpenAI provider should timeout after 60 seconds

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      21 |
      22 |   describe('Timeout Handling', () => {
    > 23 |     test('OpenAI provider should timeout after 60 seconds', async () => {
         |     ^
      24 |       // Mock a hanging request
      25 |       global.fetch.mockImplementation(() => new Promise(() => {}));
      26 |

      at src/__tests__/integration/aiProviders.integration.test.js:23:5
      at src/__tests__/integration/aiProviders.integration.test.js:22:3
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:11:1)

  ● AI Providers Integration Tests › Timeout Handling › Claude provider should timeout after 60 seconds

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      39 |     });
      40 |
    > 41 |     test('Claude provider should timeout after 60 seconds', async () => {
         |     ^
      42 |       global.fetch.mockImplementation(() => new Promise(() => {}));
      43 |
      44 |       const provider = AI_PROVIDERS.claude;

      at src/__tests__/integration/aiProviders.integration.test.js:41:5
      at src/__tests__/integration/aiProviders.integration.test.js:22:3
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:11:1)

  ● AI Providers Integration Tests › Timeout Handling › Ollama provider should timeout after 120 seconds

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      55 |     });
      56 |
    > 57 |     test('Ollama provider should timeout after 120 seconds', async () => {
         |     ^
      58 |       global.fetch.mockImplementation(() => new Promise(() => {}));
      59 |
      60 |       const provider = AI_PROVIDERS.ollama;

      at src/__tests__/integration/aiProviders.integration.test.js:57:5
      at src/__tests__/integration/aiProviders.integration.test.js:22:3
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:11:1)

  ● AI Providers Integration Tests › Retry Logic › Should retry on timeout error up to 3 times

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      73 |
      74 |   describe('Retry Logic', () => {
    > 75 |     test('Should retry on timeout error up to 3 times', async () => {
         |     ^
      76 |       let callCount = 0;
      77 |
      78 |       global.fetch.mockImplementation(() => {

      at src/__tests__/integration/aiProviders.integration.test.js:75:5
      at src/__tests__/integration/aiProviders.integration.test.js:74:3
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:11:1)

  ● AI Providers Integration Tests › Retry Logic › Should retry on 429 rate limit error

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      110 |     });
      111 |
    > 112 |     test('Should retry on 429 rate limit error', async () => {
          |     ^
      113 |       let callCount = 0;
      114 |
      115 |       global.fetch.mockImplementation(() => {

      at src/__tests__/integration/aiProviders.integration.test.js:112:5
      at src/__tests__/integration/aiProviders.integration.test.js:74:3
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:11:1)

  ● AI Providers Integration Tests › Retry Logic › Should use exponential backoff (1s, 2s, 4s)

    TypeError: jest.advanceTimersByTimeAsync is not a function

      201 |       // Advance timers to simulate backoff delays
      202 |       for (let i = 0; i < 3; i++) {
    > 203 |         await jest.advanceTimersByTimeAsync(Math.pow(2, i) * 1000 + 100);
          |                    ^
      204 |       }
      205 |
      206 |       await promise;

      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:203:20)

  ● AI Providers Integration Tests › Error Messages (Portuguese) › OpenAI should return Portuguese error for rate limit

    Erro: API OpenAI - Limite de taxa excedido. Tente novamente em alguns minutos.

      297 |       // Handle specific error cases with Portuguese messages
      298 |       if (response.status === 429) {
    > 299 |         throw new Error(`Erro: API OpenAI - Limite de taxa excedido. Tente novamente em alguns minutos.`);
          |               ^
      300 |       } else if (response.status === 401 || response.status === 403) {
      301 |         throw new Error(`Erro: API OpenAI - Chave API inválida ou sem permissão. Verifique sua configuração.`);
      302 |       } else if (response.status === 400) {

      at callOpenAI (src/utils/aiProviders.js:299:15)
      at callWithRetry (src/utils/aiProviders.js:68:22)

  ● AI Providers Integration Tests › Error Messages (Portuguese) › OpenAI should return Portuguese error for rate limit

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      211 |
      212 |   describe('Error Messages (Portuguese)', () => {
    > 213 |     test('OpenAI should return Portuguese error for rate limit', async () => {
          |     ^
      214 |       global.fetch.mockResolvedValue({
      215 |         ok: false,
      216 |         status: 429,

      at src/__tests__/integration/aiProviders.integration.test.js:213:5
      at src/__tests__/integration/aiProviders.integration.test.js:212:3
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:11:1)

  ● AI Providers Integration Tests › Error Messages (Portuguese) › Should include provider name in error messages

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      249 |     });
      250 |
    > 251 |     test('Should include provider name in error messages', async () => {
          |     ^
      252 |       global.fetch.mockResolvedValue({
      253 |         ok: false,
      254 |         status: 500,

      at src/__tests__/integration/aiProviders.integration.test.js:251:5
      at src/__tests__/integration/aiProviders.integration.test.js:212:3
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:11:1)

  ● AI Providers Integration Tests › Provider Configuration › Gemini should have 60s timeout

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      335 |     });
      336 |
    > 337 |     test('Gemini should have 60s timeout', async () => {
          |     ^
      338 |       global.fetch.mockImplementation(() => new Promise(() => {}));
      339 |
      340 |       const provider = AI_PROVIDERS.gemini;

      at src/__tests__/integration/aiProviders.integration.test.js:337:5
      at src/__tests__/integration/aiProviders.integration.test.js:329:3
      at Object.<anonymous> (src/__tests__/integration/aiProviders.integration.test.js:11:1)

FAIL src/__tests__/services/financial/FinancialCalculationService.test.js (93.528 s)
  ● FinancialCalculationService › NPV Calculations › should handle NPV calculation errors

    Invalid cash flows

      32 |             pending.resolve(data);
      33 |           } else {
    > 34 |             pending.reject(new Error(error));
         |                            ^
      35 |           }
      36 |           this.pendingCalculations.delete(id);
      37 |         }

      at MockWorker.onmessage (src/services/financial/FinancialCalculationService.js:34:28)
      at src/__tests__/services/financial/FinancialCalculationService.test.js:18:14
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:516:19)

  ● FinancialCalculationService › Monte Carlo Simulation › should perform Monte Carlo simulation

    TypeError: Cannot destructure property 'id' of '((cov_21d5mi7486(...).s[9]++) , event.data)' as it is undefined.

      25 |       
      26 |       this.worker.onmessage = (event) => {
    > 27 |         const { id, success, error, ...data } = event.data;
         |                 ^
      28 |         const pending = this.pendingCalculations.get(id);
      29 |         
      30 |         if (pending) {

      at MockWorker.onmessage (src/services/financial/FinancialCalculationService.js:27:17)
      at src/__tests__/services/financial/FinancialCalculationService.test.js:18:14
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:516:19)

  ● FinancialCalculationService › Monte Carlo Simulation › should perform Monte Carlo simulation

    thrown: "Exceeded timeout of 10000 ms for a hook.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      52 |   });
      53 |
    > 54 |   afterEach(async () => {
         |   ^
      55 |     await service.cleanup();
      56 |     jest.clearAllMocks();
      57 |   });

      at src/__tests__/services/financial/FinancialCalculationService.test.js:54:3
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:38:1)

  ● FinancialCalculationService › Error Handling and Timeouts › should timeout long-running calculations

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      465 |
      466 |   describe('Error Handling and Timeouts', () => {
    > 467 |     it('should timeout long-running calculations', async () => {
          |     ^
      468 |       // Don't set mockResponse to simulate no response
      469 |       MockWorker.mockResponse = null;
      470 |

      at src/__tests__/services/financial/FinancialCalculationService.test.js:467:5
      at src/__tests__/services/financial/FinancialCalculationService.test.js:466:3
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:38:1)

  ● FinancialCalculationService › Error Handling and Timeouts › should timeout long-running calculations

    thrown: "Exceeded timeout of 10000 ms for a hook.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      52 |   });
      53 |
    > 54 |   afterEach(async () => {
         |   ^
      55 |     await service.cleanup();
      56 |     jest.clearAllMocks();
      57 |   });

      at src/__tests__/services/financial/FinancialCalculationService.test.js:54:3
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:38:1)

  ● FinancialCalculationService › Error Handling and Timeouts › should handle worker errors

    thrown: "Exceeded timeout of 10000 ms for a hook.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      52 |   });
      53 |
    > 54 |   afterEach(async () => {
         |   ^
      55 |     await service.cleanup();
      56 |     jest.clearAllMocks();
      57 |   });

      at src/__tests__/services/financial/FinancialCalculationService.test.js:54:3
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:38:1)

  ● FinancialCalculationService › Resource Management › should clean up resources properly

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      496 |
      497 |   describe('Resource Management', () => {
    > 498 |     it('should clean up resources properly', async () => {
          |     ^
      499 |       await service.initialize();
      500 |       
      501 |       expect(MockWorker.instances.length).toBe(1);

      at src/__tests__/services/financial/FinancialCalculationService.test.js:498:5
      at src/__tests__/services/financial/FinancialCalculationService.test.js:497:3
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:38:1)

  ● FinancialCalculationService › Resource Management › should clean up resources properly

    thrown: "Exceeded timeout of 10000 ms for a hook.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      52 |   });
      53 |
    > 54 |   afterEach(async () => {
         |   ^
      55 |     await service.cleanup();
      56 |     jest.clearAllMocks();
      57 |   });

      at src/__tests__/services/financial/FinancialCalculationService.test.js:54:3
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:38:1)

  ● FinancialCalculationService › Resource Management › should get service status

    thrown: "Exceeded timeout of 10000 ms for a hook.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      52 |   });
      53 |
    > 54 |   afterEach(async () => {
         |   ^
      55 |     await service.cleanup();
      56 |     jest.clearAllMocks();
      57 |   });

      at src/__tests__/services/financial/FinancialCalculationService.test.js:54:3
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:38:1)

  ● FinancialCalculationService › Legacy Support › should support processFinancialData

    thrown: "Exceeded timeout of 10000 ms for a test.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      523 |
      524 |   describe('Legacy Support', () => {
    > 525 |     it('should support processFinancialData', async () => {
          |     ^
      526 |       MockWorker.mockResponse = (data) => ({
      527 |         id: data.id,
      528 |         success: true,

      at src/__tests__/services/financial/FinancialCalculationService.test.js:525:5
      at src/__tests__/services/financial/FinancialCalculationService.test.js:524:3
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:38:1)

  ● FinancialCalculationService › Legacy Support › should support processFinancialData

    thrown: "Exceeded timeout of 10000 ms for a hook.
    Use jest.setTimeout(newTimeout) to increase the timeout value, if this is a long-running test."

      52 |   });
      53 |
    > 54 |   afterEach(async () => {
         |   ^
      55 |     await service.cleanup();
      56 |     jest.clearAllMocks();
      57 |   });

      at src/__tests__/services/financial/FinancialCalculationService.test.js:54:3
      at Object.<anonymous> (src/__tests__/services/financial/FinancialCalculationService.test.js:38:1)


Test Suites: 22 failed, 7 passed, 29 total
Tests:       120 failed, 523 passed, 643 total
Snapshots:   0 total
Time:        102.543 s
Ran all test suites.
